!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=22)}([function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(e,"__esModule",{value:!0});var o,i=(o=n(21))&&"object"===(void 0===o?"undefined":r(o))&&"default"in o?o.default:o;var a=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},s={firstChild:{},lastChild:{},childCount:{}};a.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,a=0;a<e;i++){var s=this.content[i],c=a+s.nodeSize;if(c>t&&!1!==n(s,r+a,o,i)&&s.content.size){var l=a+1;s.nodesBetween(Math.max(0,t-l),Math.min(s.content.size,e-l),n,r+l)}a=c}},a.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},a.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,function(a,s){a.isText?(o+=a.text.slice(Math.max(t,s)-s,e-s),i=!n):a.isLeaf&&r?(o+=r,i=!n):!i&&a.isBlock&&(o+=n,i=!0)},0),o},a.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new a(r,this.size+t.size)},a.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],c=i+s.nodeSize;c>t&&((i<t||c>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=c}return new a(n,r)},a.prototype.cutByIndex=function(t,e){return t==e?a.empty:0==t&&e==this.content.length?this:new a(this.content.slice(t,e))},a.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new a(r,o)},a.prototype.addToStart=function(t){return new a([t].concat(this.content),this.size+t.nodeSize)},a.prototype.addToEnd=function(t){return new a(this.content.concat(t),this.size+t.nodeSize)},a.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},s.firstChild.get=function(){return this.content.length?this.content[0]:null},s.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},s.childCount.get=function(){return this.content.length},a.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},a.prototype.maybeChild=function(t){return this.content[t]},a.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},a.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),function t(e,n,r){for(var o=0;;o++){if(o==e.childCount||o==n.childCount)return e.childCount==n.childCount?null:r;var i=e.child(o),a=n.child(o);if(i!=a){if(!i.sameMarkup(a))return r;if(i.isText&&i.text!=a.text){for(var s=0;i.text[s]==a.text[s];s++)r++;return r}if(i.content.size||a.content.size){var c=t(i.content,a.content,r+1);if(null!=c)return c}r+=i.nodeSize}else r+=i.nodeSize}}(this,t,e)},a.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),function t(e,n,r,o){for(var i=e.childCount,a=n.childCount;;){if(0==i||0==a)return i==a?null:{a:r,b:o};var s=e.child(--i),c=n.child(--a),l=s.nodeSize;if(s!=c){if(!s.sameMarkup(c))return{a:r,b:o};if(s.isText&&s.text!=c.text){for(var p=0,h=Math.min(s.text.length,c.text.length);p<h&&s.text[s.text.length-p-1]==c.text[c.text.length-p-1];)p++,r--,o--;return{a:r,b:o}}if(s.content.size||c.content.size){var u=t(s.content,c.content,r-1,o-1);if(u)return u}r-=l,o-=l}else r-=l,o-=l}}(this,t,e,n)},a.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return l(0,t);if(t==this.size)return l(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=r+this.child(n).nodeSize;if(o>=t)return o==t||e>0?l(n+1,o):l(n,r);r=o}},a.prototype.toString=function(){return"<"+this.toStringInner()+">"},a.prototype.toStringInner=function(){return this.content.join(", ")},a.prototype.toJSON=function(){return this.content.length?this.content.map(function(t){return t.toJSON()}):null},a.fromJSON=function(t,e){if(!e)return a.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new a(e.map(t.nodeFromJSON))},a.fromArray=function(t){if(!t.length)return a.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new a(e||t,n)},a.from=function(t){return t?t instanceof a?t:Array.isArray(t)?this.fromArray(t):new a([t],t.nodeSize):a.empty},Object.defineProperties(a.prototype,s);var c={index:0,offset:0};function l(t,e){return c.index=t,c.offset=e,c}function p(t,e){if(t===e)return!0;if(!t||"object"!=(void 0===t?"undefined":r(t))||!e||"object"!=(void 0===e?"undefined":r(e)))return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var o=0;o<t.length;o++)if(!p(t[o],e[o]))return!1}else{for(var i in t)if(!(i in e&&p(t[i],e[i])))return!1;for(var a in e)if(!(a in t))return!1}return!0}a.empty=new a([],0);var h=function(t,e){this.type=t,this.attrs=e};function u(t){var e=Error.call(this,t);return e.__proto__=u.prototype,e}h.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},h.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},h.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},h.prototype.eq=function(t){return this==t||this.type==t.type&&p(this.attrs,t.attrs)},h.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},h.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},h.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},h.setFrom=function(t){if(!t||0==t.length)return h.none;if(t instanceof h)return[t];var e=t.slice();return e.sort(function(t,e){return t.type.rank-e.type.rank}),e},h.none=[],u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u.prototype.name="ReplaceError";var f=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},d={size:{}};function m(t,e,n){if(n.openStart>t.depth)throw new u("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new u("Inconsistent open depths");return function t(e,n,r,o){var i=e.index(o),s=e.node(o);if(i==n.index(o)&&o<e.depth-r.openStart){var c=t(e,n,r,o+1);return s.copy(s.content.replaceChild(i,c))}if(r.content.size){if(r.openStart||r.openEnd||e.depth!=o||n.depth!=o){var l=function(t,e){for(var n=e.depth-t.openStart,r=e.node(n).copy(t.content),o=n-1;o>=0;o--)r=e.node(o).copy(a.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}(r,e),p=l.start,h=l.end;return b(s,function t(e,n,r,o,i){var s=e.depth>i&&g(e,n,i+1);var c=o.depth>i&&g(r,o,i+1);var l=[];w(null,e,i,l);s&&c&&n.index(i)==r.index(i)?(v(s,c),y(b(s,t(e,n,r,o,i+1)),l)):(s&&y(b(s,k(e,n,i+1)),l),w(n,r,i,l),c&&y(b(c,k(r,o,i+1)),l));w(o,null,i,l);return new a(l)}(e,p,h,n,o))}var u=e.parent,f=u.content;return b(u,f.cut(0,e.parentOffset).append(r.content).append(f.cut(n.parentOffset)))}return b(s,k(e,n,o))}(t,e,n,0)}function v(t,e){if(!e.type.compatibleContent(t.type))throw new u("Cannot join "+e.type.name+" onto "+t.type.name)}function g(t,e,n){var r=t.node(n);return v(r,e.node(n)),r}function y(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function w(t,e,n,r){var o=(e||t).node(n),i=0,a=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(y(t.nodeAfter,r),i++));for(var s=i;s<a;s++)y(o.child(s),r);e&&e.depth==n&&e.textOffset&&y(e.nodeBefore,r)}function b(t,e){if(!t.type.validContent(e))throw new u("Invalid content for node "+t.type.name);return t.copy(e)}function k(t,e,n){var r=[];(w(null,t,n,r),t.depth>n)&&y(b(g(t,e,n+1),k(t,e,n+1)),r);return w(e,null,n,r),new a(r)}d.size.get=function(){return this.content.size-this.openStart-this.openEnd},f.prototype.insertAt=function(t,e){var n=function t(e,n,r,o){var i=e.findIndex(n);var a=i.index;var s=i.offset;var c=e.maybeChild(a);if(s==n||c.isText)return o&&!o.canReplace(a,a,r)?null:e.cut(0,n).append(r).append(e.cut(n));var l=t(c.content,n-s-1,r);return l&&e.replaceChild(a,c.copy(l))}(this.content,t+this.openStart,e,null);return n&&new f(n,this.openStart,this.openEnd)},f.prototype.removeBetween=function(t,e){return new f(function t(e,n,r){var o=e.findIndex(n);var i=o.index;var a=o.offset;var s=e.maybeChild(i);var c=e.findIndex(r);var l=c.index;var p=c.offset;if(a==n||s.isText){if(p!=r&&!e.child(l).isText)throw new RangeError("Removing non-flat range");return e.cut(0,n).append(e.cut(r))}if(i!=l)throw new RangeError("Removing non-flat range");return e.replaceChild(i,s.copy(t(s.content,n-a-1,r-a-1)))}(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},f.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},f.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},f.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},f.fromJSON=function(t,e){if(!e)return f.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new f(a.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)},f.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new f(t,n,r)},Object.defineProperties(f.prototype,d),f.empty=new f(a.empty,0,0);var S=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},x={parent:{},doc:{},textOffset:{},nodeAfter:{},nodeBefore:{}};S.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},x.parent.get=function(){return this.node(this.depth)},x.doc.get=function(){return this.node(0)},S.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},S.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},S.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},S.prototype.start=function(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1},S.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},S.prototype.before=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},S.prototype.after=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},x.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},x.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},x.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},S.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return h.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,a=0;a<i.length;a++)!1!==i[a].type.spec.inclusive||r&&i[a].isInSet(r.marks)||(i=i[a--].removeFromSet(i));return i},S.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},S.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},S.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new T(this,t,n)},S.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},S.prototype.max=function(t){return t.pos>this.pos?t:this},S.prototype.min=function(t){return t.pos<this.pos?t:this},S.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},S.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var a=i.content.findIndex(o),s=a.index,c=a.offset,l=o-c;if(n.push(i,s,r+c),!l)break;if((i=i.child(s)).isText)break;o=l-1,r+=c+1}return new S(e,n,o)},S.resolveCached=function(t,e){for(var n=0;n<C.length;n++){var r=C[n];if(r.pos==e&&r.doc==t)return r}var o=C[M]=S.resolve(t,e);return M=(M+1)%O,o},Object.defineProperties(S.prototype,x);var C=[],M=0,O=12,T=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},D={start:{},end:{},parent:{},startIndex:{},endIndex:{}};D.start.get=function(){return this.$from.before(this.depth+1)},D.end.get=function(){return this.$to.after(this.depth+1)},D.parent.get=function(){return this.$from.node(this.depth)},D.startIndex.get=function(){return this.$from.index(this.depth)},D.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(T.prototype,D);var N=Object.create(null),A=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||a.empty,this.marks=r||h.none},E={nodeSize:{},childCount:{},textContent:{},firstChild:{},lastChild:{},isBlock:{},isTextblock:{},inlineContent:{},isInline:{},isText:{},isLeaf:{},isAtom:{}};E.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},E.childCount.get=function(){return this.content.childCount},A.prototype.child=function(t){return this.content.child(t)},A.prototype.maybeChild=function(t){return this.content.maybeChild(t)},A.prototype.forEach=function(t){this.content.forEach(t)},A.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},A.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},E.textContent.get=function(){return this.textBetween(0,this.content.size,"")},A.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},E.firstChild.get=function(){return this.content.firstChild},E.lastChild.get=function(){return this.content.lastChild},A.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},A.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},A.prototype.hasMarkup=function(t,e,n){return this.type==t&&p(this.attrs,e||t.defaultAttrs||N)&&h.sameSet(this.marks,n||h.none)},A.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},A.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},A.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},A.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return f.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),a=r.start(i),s=r.node(i).content.cut(r.pos-a,o.pos-a);return new f(s,r.depth-i,o.depth-i)},A.prototype.replace=function(t,e,n){return m(this.resolve(t),this.resolve(e),n)},A.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(!(e=e.maybeChild(r)))return null;if(o==t||e.isText)return e;t-=o+1}},A.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},A.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},A.prototype.resolve=function(t){return S.resolveCached(this,t)},A.prototype.resolveNoCache=function(t){return S.resolve(this,t)},A.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,function(t){return n.isInSet(t.marks)&&(r=!0),!r}),r},E.isBlock.get=function(){return this.type.isBlock},E.isTextblock.get=function(){return this.type.isTextblock},E.inlineContent.get=function(){return this.type.inlineContent},E.isInline.get=function(){return this.type.isInline},E.isText.get=function(){return this.type.isText},E.isLeaf.get=function(){return this.type.isLeaf},E.isAtom.get=function(){return this.type.isAtom},A.prototype.toString=function(){var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),F(this.marks,t)},A.prototype.contentMatchAt=function(t){return this.type.contentMatch.matchFragment(this.content,0,t)},A.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=a.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var c=r;c<o;c++)if(!this.type.allowsMarks(n.child(c).marks))return!1;return!0},A.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},A.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},A.prototype.defaultContentType=function(t){return this.contentMatchAt(t).defaultType},A.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));this.content.forEach(function(t){return t.check()})},A.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(function(t){return t.toJSON()})),t},A.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=a.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(A.prototype,E);var R=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{},nodeSize:{}};return e.prototype.toString=function(){return F(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(A);function F(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var $=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},P={inlineContent:{},defaultType:{},edgeCount:{}};$.parse=function(t,e){var n=new z(t,e);if(null==n.next)return $.empty;var r=_(n);n.next&&n.err("Unexpected trailing text");var o=function(t){var e=Object.create(null);return function n(r){var o=[];r.forEach(function(e){t[e].forEach(function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),a=i>-1&&o[i+1];W(t,r).forEach(function(t){a||o.push(n,a=[]),-1==a.indexOf(t)&&a.push(t)})}})});var i=e[r.join(",")]=new $(r.indexOf(t.length-1)>-1);for(var a=0;a<o.length;a+=2){var s=o[a+1].sort(J);i.next.push(o[a],e[s.join(",")]||n(s))}return i}(W(t,0))}(function(t){var e=[[]];return o(function t(e,i){if("choice"==e.type)return e.exprs.reduce(function(e,n){return e.concat(t(n,i))},[]);if("seq"==e.type)for(var a=0;;a++){var s=t(e.exprs[a],i);if(a==e.exprs.length-1)return s;o(s,i=n())}else{if("star"==e.type){var c=n();return r(i,c),o(t(e.expr,c),c),[r(c)]}if("plus"==e.type){var l=n();return o(t(e.expr,i),l),o(t(e.expr,l),l),[r(l)]}if("opt"==e.type)return[r(i)].concat(t(e.expr,i));if("range"==e.type){for(var p=i,h=0;h<e.min;h++){var u=n();o(t(e.expr,p),u),p=u}if(-1==e.max)o(t(e.expr,p),p);else for(var f=e.min;f<e.max;f++){var d=n();r(p,d),o(t(e.expr,p),d),p=d}return[r(p)]}if("name"==e.type)return[r(i,null,e.value)]}}(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach(function(t){return t.to=e})}}(r));return function(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,a=[],s=0;s<o.next.length;s+=2){var c=o.next[s],l=o.next[s+1];a.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(l)&&r.push(l)}i&&e.err("Only non-generatable nodes ("+a.join(", ")+") in a required position")}}(o,n),o},$.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},$.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},P.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},P.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},$.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},$.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];return function o(i,s){var c=i.matchFragment(t,n);if(c&&(!e||c.validEnd))return a.from(s.map(function(t){return t.createAndFill()}));for(var l=0;l<i.next.length;l+=2){var p=i.next[l],h=i.next[l+1];if(!p.isText&&!p.hasRequiredAttrs()&&-1==r.indexOf(h)){r.push(h);var u=o(h,s.concat(p));if(u)return u}}}(this,[])},$.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},$.prototype.computeWrapping=function(t){for(var e=Object.create(null),n=[{match:this,type:null,via:null}];n.length;){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],a=r;a.type;a=a.via)i.push(a.type);return i.reverse()}for(var s=0;s<o.next.length;s+=2){var c=o.next[s];c.isLeaf||c.name in e||r.type&&!o.next[s+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},P.edgeCount.get=function(){return this.next.length>>1},$.prototype.edge=function(t){var e=t<<1;if(e>this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},$.prototype.toString=function(){var t=[];return function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}(this),t.map(function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r}).join("\n")},Object.defineProperties($.prototype,P),$.empty=new $(!0);var z=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()},I={next:{}};function _(t){var e=[];do{e.push(j(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function j(t){var e=[];do{e.push(B(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function B(t){for(var e=function(t){if(t.eat("(")){var e=_(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=function(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var a=n[i];a.groups.indexOf(e)>-1&&o.push(a)}0==o.length&&t.err("No node type or group '"+e+"' found");return o}(t,t.next).map(function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}});return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=V(t,e)}return e}function L(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function V(t,e){var n=L(t),r=n;return t.eat(",")&&(r="}"!=t.next?L(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function J(t,e){return t-e}function W(t,e){var n=[];return function e(r){var o=t[r];if(1==o.length&&!o[0].term)return e(o[0].to);n.push(r);for(var i=0;i<o.length;i++){var a=o[i],s=a.term,c=a.to;s||-1!=n.indexOf(c)||e(c)}}(e),n.sort(J)}function q(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function H(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function K(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new X(t[n]);return e}I.next.get=function(){return this.tokens[this.pos]},z.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},z.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(z.prototype,I);var U=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=K(n.attrs),this.defaultAttrs=q(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},Q={isInline:{},isTextblock:{},isLeaf:{},isAtom:{}};Q.isInline.get=function(){return!this.isBlock},Q.isTextblock.get=function(){return this.isBlock&&this.inlineContent},Q.isLeaf.get=function(){return this.contentMatch==$.empty},Q.isAtom.get=function(){return this.isLeaf||this.spec.atom},U.prototype.hasRequiredAttrs=function(t){for(var e in this.attrs)if(this.attrs[e].isRequired&&(!t||!(e in t)))return!0;return!1},U.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},U.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:H(this.attrs,t)},U.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new A(this,this.computeAttrs(t),a.from(e),h.setFrom(n))},U.prototype.createChecked=function(t,e,n){if(e=a.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new A(this,this.computeAttrs(t),e,h.setFrom(n))},U.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),(e=a.from(e)).size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(a.empty,!0);return o?new A(this,t,e.append(o),h.setFrom(n)):null},U.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},U.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},U.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},U.prototype.allowedMarks=function(t){var e;if(null==this.markSet)return t;for(var n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:h.empty:t},U.compile=function(t,e){var n=Object.create(null);t.forEach(function(t,r){return n[t]=new U(t,e,r)});var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(U.prototype,Q);var X=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},G={isRequired:{}};G.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(X.prototype,G);var Y=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=K(r.attrs),this.rank=e,this.excluded=null;var o=q(this.attrs);this.instance=o&&new h(this,o)};Y.prototype.create=function(t){return!t&&this.instance?this.instance:new h(this,H(this.attrs,t))},Y.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach(function(t,o){return n[t]=new Y(t,r++,e,o)}),n},Y.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t},Y.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},Y.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var Z=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=i.from(t.nodes),this.spec.marks=i.from(t.marks),this.nodes=U.compile(this.spec.nodes,this),this.marks=Y.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],a=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[a]||(n[a]=$.parse(a,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?tt(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var c in this.marks){var l=this.marks[c],p=l.spec.excludes;l.excluded=null==p?[l]:""==p?[]:tt(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function tt(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],a=i;if(i)n.push(i);else for(var s in t.marks){var c=t.marks[s];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(a=c)}if(!a)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}Z.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof U))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},Z.prototype.text=function(t,e){var n=this.nodes.text;return new R(n,n.defaultAttrs,t,h.setFrom(e))},Z.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},Z.prototype.nodeFromJSON=function(t){return A.fromJSON(this,t)},Z.prototype.markFromJSON=function(t){return h.fromJSON(this,t)},Z.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var et=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach(function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})};et.prototype.parse=function(t,e){void 0===e&&(e={});var n=new lt(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},et.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new lt(this,e,!0);return n.addAll(t,null,e.from,e.to),f.maxOpen(n.finish())},et.prototype.matchTag=function(t,e){for(var n=0;n<this.tags.length;n++){var r=this.tags[n];if(ht(t,r.tag)&&(void 0===r.namespace||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){var o=r.getAttrs(t);if(!1===o)continue;r.attrs=o}return r}}},et.prototype.matchStyle=function(t,e,n){for(var r=0;r<this.styles.length;r++){var o=this.styles[r];if(!(0!=o.style.indexOf(t)||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(61!=o.style.charCodeAt(t.length)||o.style.slice(t.length+1)!=e))){if(o.getAttrs){var i=o.getAttrs(e);if(!1===i)continue;o.attrs=i}return o}}},et.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r];if((null==o.priority?50:o.priority)<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach(function(t){n(t=ut(t)),t.mark=e})};for(var o in t.marks)r(o);var i;for(var a in t.nodes)i=void 0,(i=t.nodes[a].spec.parseDOM)&&i.forEach(function(t){n(t=ut(t)),t.node=a});return e},et.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new et(t,et.schemaRules(t)))};var nt={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},rt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ot={ol:!0,ul:!0},it=1,at=2;function st(t){return(t?it:0)|("full"===t?at:0)}var ct=function(t,e,n,r,o,i){this.type=t,this.attrs=e,this.solid=r,this.match=o||(4&i?null:t.contentMatch),this.options=i,this.content=[],this.marks=n,this.activeMarks=h.none};ct.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(a.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},ct.prototype.finish=function(t){if(!(this.options&it)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/\s+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=a.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(a.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r};var lt=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.pendingMarks=[];var r,o=e.topNode,i=st(e.preserveWhitespace)|(n?4:0);r=o?new ct(o.type,o.attrs,h.none,!0,e.topMatch||o.type.contentMatch,i):new ct(n?null:t.schema.topNodeType,null,h.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},pt={top:{},currentPos:{}};function ht(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function ut(t){var e={};for(var n in t)e[n]=t[n];return e}pt.top.get=function(){return this.nodes[this.open]},lt.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style");if(e){var n=this.readStyles(function(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];for(;e=n.exec(t);)r.push(e[1],e[2].trim());return r}(e));if(null!=n){for(var r=0;r<n.length;r++)this.addPendingMark(n[r]);this.addElement(t);for(var o=0;o<n.length;o++)this.removePendingMark(n[o])}}else this.addElement(t)}},lt.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/\S/.test(e)){if(n.options&it)n.options&at||(e=e.replace(/\r?\n|\r/g," "));else if(e=e.replace(/\s+/g," "),/^\s/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1];(!r||r.isText&&/\s$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},lt.prototype.addElement=function(t){var e=t.nodeName.toLowerCase();ot.hasOwnProperty(e)&&function(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&ot.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}(t);var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:rt.hasOwnProperty(e))this.findInside(t);else if(!n||n.skip){n&&n.skip.nodeType&&(t=n.skip);var r,o=this.top,i=o.activeMarks,a=this.needsBlock;nt.hasOwnProperty(e)&&(r=!0,o.type||(this.needsBlock=!0)),this.addAll(t),r&&this.sync(o),o.activeMarks=i,this.needsBlock=a}else this.addElementByRule(t,n)},lt.prototype.readStyles=function(t){for(var e=h.none,n=0;n<t.length;n+=2){var r=this.parser.matchStyle(t[n],t[n+1],this);if(r){if(r.ignore)return null;e=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(e)}}return e},lt.prototype.addElementByRule=function(t,e){var n,r,o,i=this;e.node?(r=this.parser.schema.nodes[e.node]).isLeaf?this.insertNode(r.create(e.attrs)):n=this.enter(r,e.attrs,e.preserveWhitespace):(o=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(o));var a=this.top;if(r&&r.isLeaf)this.findInside(t);else if(e.getContent)this.findInside(t),e.getContent(t).forEach(function(t){return i.insertNode(t)});else{var s=e.contentElement;"string"==typeof s?s=t.querySelector(s):"function"==typeof s&&(s=s(t)),s||(s=t),this.findAround(t,s,!0),this.addAll(s,n)}return n&&(this.sync(a),this.open--),o&&this.removePendingMark(o),!0},lt.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,a=null==r?null:t.childNodes[r];i!=a;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&nt.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},lt.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var a=0;a<e.length;a++)this.enterInner(e[a],null,!1);return!0},lt.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enter(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;this.applyPendingMarks(n),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));n.content.push(t.mark(r))}},lt.prototype.applyPendingMarks=function(t){for(var e=0;e<this.pendingMarks.length;e++){var n=this.pendingMarks[e];t.type&&!t.type.allowsMarkType(n.type)||n.type.isInSet(t.activeMarks)||(t.activeMarks=n.addToSet(t.activeMarks),this.pendingMarks.splice(e--,1))}},lt.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&(this.applyPendingMarks(this.top),this.enterInner(t,e,!0,n)),r},lt.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.match=o.match&&o.match.matchType(t,e);var i=null==r?-5&o.options:st(r);4&o.options&&0==o.content.length&&(i|=4),this.nodes.push(new ct(t,e,o.activeMarks,n,null,i)),this.open++},lt.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},lt.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},lt.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},lt.prototype.addPendingMark=function(t){this.pendingMarks.push(t)},lt.prototype.removePendingMark=function(t){if(this.pendingMarks.lastIndexOf(t)>-1)this.pendingMarks.splice(t,1);else{var e=this.top;e.activeMarks=t.removeFromSet(e.activeMarks)}},pt.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},lt.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},lt.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},lt.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++){if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node))e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}},lt.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},lt.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!(this.isOpen||r&&r.parent.type!=this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1);return function t(a,s){for(;a>=0;a--){var c=n[a];if(""==c){if(a==n.length-1||0==a)continue;for(;s>=i;s--)if(t(a-1,s))return!0;return!1}var l=s>0||0==s&&o?e.nodes[s].type:r&&s>=i?r.node(s-i).type:null;if(!l||l.name!=c&&-1==l.groups.indexOf(c))return!1;s--}return!0}(n.length-1,this.open)},lt.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},Object.defineProperties(lt.prototype,pt);var ft=function(t,e){this.nodes=t||{},this.marks=e||{}};function dt(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function mt(t){return t.document||window.document}ft.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=mt(e).createDocumentFragment());var o=n,i=null;return t.forEach(function(t){if(i||t.marks.length){i||(i=[]);for(var n=0,a=0;n<i.length&&a<t.marks.length;){var s=t.marks[a];if(r.marks[s.type.name]){if(!s.eq(i[n]))break;n+=2,a++}else a++}for(;n<i.length;)o=i.pop(),i.pop();for(;a<t.marks.length;){var c=t.marks[a++],l=r.serializeMark(c,t.isInline,e);l&&(i.push(c,o),o.appendChild(l.dom),o=l.contentDOM||l.dom)}}o.appendChild(r.serializeNode(t,e))}),n},ft.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=ft.renderSpec(mt(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},ft.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},ft.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&ft.renderSpec(mt(n),r(t,e))},ft.renderSpec=function(t,e){if("string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};var n=t.createElement(e[0]),o=null,i=e[1],a=1;if(i&&"object"==(void 0===i?"undefined":r(i))&&null==i.nodeType&&!Array.isArray(i))for(var s in a=2,i)"style"==s?n.style.cssText=i[s]:null!=i[s]&&n.setAttribute(s,i[s]);for(var c=a;c<e.length;c++){var l=e[c];if(0===l){if(c<e.length-1||c>a)throw new RangeError("Content hole must be the only child of its parent node");return{dom:n,contentDOM:n}}var p=ft.renderSpec(t,l),h=p.dom,u=p.contentDOM;if(n.appendChild(h),u){if(o)throw new RangeError("Multiple content holes");o=u}}return{dom:n,contentDOM:o}},ft.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new ft(this.nodesFromSchema(t),this.marksFromSchema(t)))},ft.nodesFromSchema=function(t){var e=dt(t.nodes);return e.text||(e.text=function(t){return t.text}),e},ft.marksFromSchema=function(t){return dt(t.marks)},e.Node=A,e.ResolvedPos=S,e.NodeRange=T,e.Fragment=a,e.Slice=f,e.ReplaceError=u,e.Mark=h,e.Schema=Z,e.NodeType=U,e.MarkType=Y,e.ContentMatch=$,e.DOMParser=et,e.DOMSerializer=ft},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),i=n(2),a=Object.create(null),s=function(t,e,n){this.ranges=n||[new l(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},c={anchor:{},head:{},from:{},to:{},$from:{},$to:{},empty:{}};c.anchor.get=function(){return this.$anchor.pos},c.head.get=function(){return this.$head.pos},c.from.get=function(){return this.$from.pos},c.to.get=function(){return this.$to.pos},c.$from.get=function(){return this.ranges[0].$from},c.$to.get=function(){return this.ranges[0].$to},c.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0},s.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},s.prototype.replace=function(t,e){void 0===e&&(e=o.Slice.empty);for(var n=e.content.lastChild,r=null,i=0;i<e.openEnd;i++)r=n,n=n.lastChild;for(var a=t.steps.length,s=this.ranges,c=0;c<s.length;c++){var l=s[c],p=l.$from,h=l.$to,u=t.mapping.slice(a);t.replaceRange(u.map(p.pos),u.map(h.pos),c?o.Slice.empty:e),0==c&&g(t,a,(n?n.isInline:r&&r.isTextblock)?-1:1)}},s.prototype.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],a=i.$from,s=i.$to,c=t.mapping.slice(n),l=c.map(a.pos),p=c.map(s.pos);o?t.deleteRange(l,p):(t.replaceRangeWith(l,p,e),g(t,n,e.isInline?-1:1))}},s.findFrom=function(t,e,n){var r=t.parent.inlineContent?new p(t):v(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?v(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):v(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}},s.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new d(t.node(0))},s.atStart=function(t){return v(t,t,0,0,1)||new d(t)},s.atEnd=function(t){return v(t,t,t.content.size,t.childCount,-1)||new d(t)},s.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=a[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},s.jsonID=function(t,e){if(t in a)throw new RangeError("Duplicate use of selection JSON ID "+t);return a[t]=e,e.prototype.jsonID=t,e},s.prototype.getBookmark=function(){return p.between(this.anchor,this.head).getBookmark()},Object.defineProperties(s.prototype,c),s.prototype.visible=!0;var l=function(t,e){this.$from=t,this.$to=e},p=function(t){function e(e,n){void 0===n&&(n=e),t.call(this,e,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={$cursor:{}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));if(!o.parent.inlineContent)return t.near(o);var i=n.resolve(r.map(this.anchor));return new e(i.parent.inlineContent?i:o,o)},e.prototype.replace=function(e,n){if(void 0===n&&(n=o.Slice.empty),t.prototype.replace.call(this,e,n),n==o.Slice.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},e.prototype.getBookmark=function(){return new h(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(n,r,o){var i=n.pos-r.pos;if(o&&!i||(o=i>=0?1:-1),!r.parent.inlineContent){var a=t.findFrom(r,o,!0)||t.findFrom(r,-o,!0);if(!a)return t.near(r,o);r=a.$head}return n.parent.inlineContent||(0==i?n=r:(n=(t.findFrom(n,-o,!0)||t.findFrom(n,o,!0)).$anchor).pos<r.pos!=i<0&&(n=r)),new e(n,r)},Object.defineProperties(e.prototype,n),e}(s);s.jsonID("text",p);var h=function(t,e){this.anchor=t,this.head=e};h.prototype.map=function(t){return new h(t.map(this.anchor),t.map(this.head))},h.prototype.resolve=function(t){return p.between(t.resolve(this.anchor),t.resolve(this.head))};var u=function(t){function e(e){var n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);t.call(this,e,r),this.node=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=r.mapResult(this.anchor),i=o.deleted,a=o.pos,s=n.resolve(a);return i?t.near(s):new e(s)},e.prototype.content=function(){return new o.Slice(o.Fragment.from(this.node),0,0)},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new f(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,e){return new this(t.resolve(e))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(s);u.prototype.visible=!1,s.jsonID("node",u);var f=function(t){this.anchor=t};f.prototype.map=function(t){var e=t.mapResult(this.anchor),n=e.deleted,r=e.pos;return n?new h(r,r):new f(r)},f.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&u.isSelectable(n)?new u(e):s.near(e)};var d=function(t){function e(e){t.call(this,e.resolve(0),e.resolve(e.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},e.prototype.map=function(t){return new e(t)},e.prototype.eq=function(t){return t instanceof e},e.prototype.getBookmark=function(){return m},e}(s);s.jsonID("all",d);var m={map:function(){return this},resolve:function(t){return new d(t)}};function v(t,e,n,r,o,i){if(e.inlineContent)return p.create(t,n);for(var a=r-(o>0?0:1);o>0?a<e.childCount:a>=0;a+=o){var s=e.child(a);if(s.isAtom){if(!i&&u.isSelectable(s))return u.create(t,n-(o<0?s.nodeSize:0))}else{var c=v(t,s,n+o,o<0?s.childCount:0,o,i);if(c)return c}n+=s.nodeSize*o}}function g(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o,a=t.steps[r];if(a instanceof i.ReplaceStep||a instanceof i.ReplaceAroundStep)t.mapping.maps[r].forEach(function(t,e,n,r){null==o&&(o=r)}),t.setSelection(s.near(t.doc.resolve(o),n))}}var y=function(t){function e(e){t.call(this,e.doc),this.time=Date.now(),this.curSelection=e.selection,this.curSelectionFor=0,this.storedMarks=e.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={selection:{},selectionSet:{},storedMarksSet:{},isGeneric:{},scrolledIntoView:{}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(t){return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this},n.selectionSet.get=function(){return(1&this.updated)>0},e.prototype.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=2,this},e.prototype.ensureMarks=function(t){return o.Mark.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},e.prototype.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(2&this.updated)>0},e.prototype.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=-3&this.updated,this.storedMarks=null},e.prototype.setTime=function(t){return this.time=t,this},e.prototype.replaceSelection=function(t){return this.selection.replace(this,t),this},e.prototype.replaceSelectionWith=function(t,e){var n=this.selection;return!1!==e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||o.Mark.none))),n.replaceWith(this,t),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(t,e,n){void 0===n&&(n=e);var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o))},e.prototype.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},e.prototype.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.isGeneric.get=function(){for(var t in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=4,this},n.scrolledIntoView.get=function(){return(4&this.updated)>0},Object.defineProperties(e.prototype,n),e}(i.Transform);function w(t,e){return e&&t?t.bind(e):t}var b=function(t,e,n){this.name=t,this.init=w(e.init,n),this.apply=w(e.apply,n)},k=[new b("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new b("selection",{init:function(t,e){return t.selection||s.atStart(e.doc)},apply:function(t){return t.selection}}),new b("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new b("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],S=function(t,e){var n=this;this.schema=t,this.fields=k.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach(function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new b(t.key,t.spec.state,t))})},x=function(t){this.config=t},C={schema:{},plugins:{},tr:{}};C.schema.get=function(){return this.config.schema},C.plugins.get=function(){return this.config.plugins},x.prototype.apply=function(t){return this.applyTransaction(t).state},x.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},x.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var a=this.config.plugins[i];if(a.spec.appendTransaction){var s=r?r[i].n:0,c=r?r[i].state:this,l=s<e.length&&a.spec.appendTransaction.call(a,s?e.slice(s):e,c,n);if(l&&n.filterTransaction(l,i)){if(l.setMeta("appendedTransaction",l),!r){r=[];for(var p=0;p<this.config.plugins.length;p++)r.push(p<i?{state:n,n:e.length}:{state:this,n:0})}e.push(l),n=n.applyInner(l),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},x.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new x(this.config),n=this.config.fields,r=0;r<n.length;r++){var o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}for(var i=0;i<M.length;i++)M[i](this,t,e);return e},C.tr.get=function(){return new y(this)},x.create=function(t){for(var e=new S(t.schema||t.doc.type.schema,t.plugins),n=new x(e),r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n},x.prototype.reconfigure=function(t){for(var e=new S(t.schema||this.schema,t.plugins),n=e.fields,r=new x(e),o=0;o<n.length;o++){var i=n[o].name;r[i]=this.hasOwnProperty(i)?this[i]:n[o].init(t,r)}return r},x.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(function(t){return t.toJSON()})),t&&"object"==(void 0===t?"undefined":r(t)))for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var o=t[n],i=o.spec.state;i&&i.toJSON&&(e[n]=i.toJSON.call(o,this[o.key]))}return e},x.fromJSON=function(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var r=new S(t.schema,t.plugins),i=new x(r);return r.fields.forEach(function(r){if("doc"==r.name)i.doc=o.Node.fromJSON(t.schema,e.doc);else if("selection"==r.name)i.selection=s.fromJSON(i.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(i.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(var a in n){var c=n[a],l=c.spec.state;if(c.key==r.name&&l&&l.fromJSON&&Object.prototype.hasOwnProperty.call(e,a))return void(i[r.name]=l.fromJSON.call(c,t,e[a],i))}i[r.name]=r.init(t,i)}}),i},x.addApplyListener=function(t){M.push(t)},x.removeApplyListener=function(t){var e=M.indexOf(t);e>-1&&M.splice(e,1)},Object.defineProperties(x.prototype,C);var M=[];var O=function(t){this.props={},t.props&&function t(e,n,r){for(var o in e){var i=e[o];i instanceof Function?i=i.bind(n):"handleDOMEvents"==o&&(i=t(i,n,{})),r[o]=i}return r}(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:D("plugin")};O.prototype.getState=function(t){return t[this.key]};var T=Object.create(null);function D(t){return t in T?t+"$"+ ++T[t]:(T[t]=0,t+"$")}var N=function(t){void 0===t&&(t="key"),this.key=D(t)};N.prototype.get=function(t){return t.config.pluginsByKey[this.key]},N.prototype.getState=function(t){return t[this.key]},e.Selection=s,e.SelectionRange=l,e.TextSelection=p,e.NodeSelection=u,e.AllSelection=d,e.Transaction=y,e.EditorState=x,e.Plugin=O,e.PluginKey=N},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),o=65535,i=Math.pow(2,16);function a(t){return t&o}var s=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.pos=t,this.deleted=e,this.recover=n},c=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};c.prototype.recover=function(t){var e=0,n=a(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+function(t){return(t-(t&o))/i}(t)},c.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},c.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},c.prototype._map=function(t,e,n){for(var r=0,o=this.inverted?2:1,a=this.inverted?1:2,c=0;c<this.ranges.length;c+=3){var l=this.ranges[c]-(this.inverted?r:0);if(l>t)break;var p=this.ranges[c+o],h=this.ranges[c+a],u=l+p;if(t<=u){var f=l+r+((p?t==l?-1:t==u?1:e:e)<0?0:h);if(n)return f;var d=c/3+(t-l)*i;return new s(f,e<0?t!=l:t!=u,d)}r+=h-p}return n?t+r:new s(t+r)},c.prototype.touches=function(t,e){for(var n=0,r=a(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var c=this.ranges[s]-(this.inverted?n:0);if(c>t)break;var l=this.ranges[s+o];if(t<=c+l&&s==3*r)return!0;n+=this.ranges[s+i]-l}return!1},c.prototype.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],a=i-(this.inverted?o:0),s=i+(this.inverted?0:o),c=this.ranges[r+e],l=this.ranges[r+n];t(a,a+c,s,s+l),o+=l-c}},c.prototype.invert=function(){return new c(this.ranges,!this.inverted)},c.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},c.offset=function(t){return 0==t?c.empty:new c(t<0?[0,-t,0]:[0,0,t])},c.empty=new c([]);var l=function(t,e,n,r){this.maps=t||[],this.from=n||0,this.to=null==r?this.maps.length:r,this.mirror=e};function p(t){var e=Error.call(this,t);return e.__proto__=p.prototype,e}l.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new l(this.maps,this.mirror,t,e)},l.prototype.copy=function(){return new l(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},l.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},l.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},l.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},l.prototype.appendMapping=function(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:null)}},l.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:null)}},l.prototype.invert=function(){var t=new l;return t.appendMappingInverted(this),t},l.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t},l.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},l.prototype._map=function(t,e,n){for(var r=!1,o=null,i=this.from;i<this.to;i++){var a=this.maps[i],c=o&&o[i];if(null!=c&&a.touches(t,c))t=a.recover(c);else{var l=a.mapResult(t,e);if(null!=l.recover){var p=this.getMirror(i);if(null!=p&&p>i&&p<this.to){if(l.deleted){i=p,t=this.maps[p].recover(l.recover);continue}(o||(o=Object.create(null)))[p]=l.recover}}l.deleted&&(r=!0),t=l.pos}}return n?t:new s(t,r)},p.prototype=Object.create(Error.prototype),p.prototype.constructor=p,p.prototype.name="TransformError";var h=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new l},u={before:{},docChanged:{}};function f(){throw new Error("Override me")}u.before.get=function(){return this.docs.length?this.docs[0]:this.doc},h.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new p(e.failed);return this},h.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},u.docChanged.get=function(){return this.steps.length>0},h.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(h.prototype,u);var d=Object.create(null),m=function(){};m.prototype.apply=function(t){return f()},m.prototype.getMap=function(){return c.empty},m.prototype.invert=function(t){return f()},m.prototype.map=function(t){return f()},m.prototype.merge=function(t){return null},m.prototype.toJSON=function(){return f()},m.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=d[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},m.jsonID=function(t,e){if(t in d)throw new RangeError("Duplicate use of step JSON ID "+t);return d[t]=e,e.prototype.jsonID=t,e};var v=function(t,e){this.doc=t,this.failed=e};v.ok=function(t){return new v(t,null)},v.fail=function(t){return new v(null,t)},v.fromReplace=function(t,e,n,o){try{return v.ok(t.replace(e,n,o))}catch(t){if(t instanceof r.ReplaceError)return v.fail(t.message);throw t}};var g=function(t){function e(e,n,r,o){t.call(this),this.from=e,this.to=n,this.slice=r,this.structure=!!o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){return this.structure&&w(t,this.from,this.to)?v.fail("Structure replace would overwrite content"):v.fromReplace(t,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new c([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice)},e.prototype.merge=function(t){if(!(t instanceof e)||t.structure!=this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?r.Slice.empty:new r.Slice(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var o=this.slice.size+t.slice.size==0?r.Slice.empty:new r.Slice(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),o,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,r.Slice.fromJSON(t,n.slice),!!n.structure)},e}(m);m.jsonID("replace",g);var y=function(t){function e(e,n,r,o,i,a,s){t.call(this),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=a,this.structure=!!s}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){if(this.structure&&(w(t,this.from,this.gapFrom)||w(t,this.gapTo,this.to)))return v.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return v.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?v.fromReplace(t,this.from,this.to,n):v.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new c([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return n.deleted&&r.deleted||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,r.Slice.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(m);function w(t,e,n){for(var r=t.resolve(e),o=n-e,i=r.depth;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0)for(var a=r.node(i).maybeChild(r.indexAfter(i));o>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,o--}return!1}function b(t,e,n){return(0==e||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function k(t){return{type:t,attrs:null}}function S(t,e){return t&&e&&!t.isLeaf&&t.canAppend(e)}function x(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var a=r.depth-1;a>=0;a--){var s=r.indexAfter(a);if(r.node(a).canReplaceWith(s,s,n))return r.after(a+1);if(s<r.node(a).childCount)return null}}function C(t,e,n){for(var o=[],i=0;i<t.childCount;i++){var a=t.child(i);a.content.size&&(a=a.copy(C(a.content,e,a))),a.isInline&&(a=e(a,n,i)),o.push(a)}return r.Fragment.fromArray(o)}m.jsonID("replaceAround",y),h.prototype.lift=function(t,e){for(var n=t.$from,o=t.$to,i=t.depth,a=n.before(i+1),s=o.after(i+1),c=a,l=s,p=r.Fragment.empty,h=0,u=i,f=!1;u>e;u--)f||n.index(u)>0?(f=!0,p=r.Fragment.from(n.node(u).copy(p)),h++):c--;for(var d=r.Fragment.empty,m=0,v=i,g=!1;v>e;v--)g||o.after(v+1)<o.end(v)?(g=!0,d=r.Fragment.from(o.node(v).copy(d)),m++):l++;return this.step(new y(c,l,a,s,new r.Slice(p.append(d),h,m),p.size-h,!0))},h.prototype.wrap=function(t,e){for(var n=r.Fragment.empty,o=e.length-1;o>=0;o--)n=r.Fragment.from(e[o].type.create(e[o].attrs,n));var i=t.start,a=t.end;return this.step(new y(i,a,i,a,new r.Slice(n,0,0),e.length,!0))},h.prototype.setBlockType=function(t,e,n,o){var i=this;if(void 0===e&&(e=t),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var a=this.steps.length;return this.doc.nodesBetween(t,e,function(t,e){if(t.isTextblock&&!t.hasMarkup(n,o)&&function(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}(i.doc,i.mapping.slice(a).map(e),n)){i.clearIncompatible(i.mapping.slice(a).map(e,1),n);var s=i.mapping.slice(a),c=s.map(e,1),l=s.map(e+t.nodeSize,1);return i.step(new y(c,l,c+1,l-1,new r.Slice(r.Fragment.from(n.create(o,null,t.marks)),0,0),1,!0)),!1}}),this},h.prototype.setNodeMarkup=function(t,e,n,o){var i=this.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");e||(e=i.type);var a=e.create(n,null,o||i.marks);if(i.isLeaf)return this.replaceWith(t,t+i.nodeSize,a);if(!e.validContent(i.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new y(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new r.Slice(r.Fragment.from(a),0,0),1,!0))},h.prototype.split=function(t,e,n){void 0===e&&(e=1);for(var o=this.doc.resolve(t),i=r.Fragment.empty,a=r.Fragment.empty,s=o.depth,c=o.depth-e,l=e-1;s>c;s--,l--){i=r.Fragment.from(o.node(s).copy(i));var p=n&&n[l];a=r.Fragment.from(p?p.type.create(p.attrs,a):o.node(s).copy(a))}return this.step(new g(t,t,new r.Slice(i.append(a),e,e,!0)))},h.prototype.join=function(t,e){void 0===e&&(e=1);var n=new g(t-e,t+e,r.Slice.empty,!0);return this.step(n)};var M=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),o=t.resolve(this.from),i=o.node(o.sharedDepth(this.to)),a=new r.Slice(C(n.content,function(t,n){return n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t},i),n.openStart,n.openEnd);return v.fromReplace(t,this.from,this.to,a)},e.prototype.invert=function(){return new O(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(m);m.jsonID("addMark",M);var O=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),o=new r.Slice(C(n.content,function(t){return t.mark(e.mark.removeFromSet(t.marks))}),n.openStart,n.openEnd);return v.fromReplace(t,this.from,this.to,o)},e.prototype.invert=function(){return new M(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(m);function T(t,e,n,o){if(void 0===n&&(n=e),void 0===o&&(o=r.Slice.empty),e==n&&!o.size)return null;var i=t.resolve(e),a=t.resolve(n);if(A(i,a,o))return new g(e,n,o);var s=function(t,e){var n=function t(e,n,o,i){var a=r.Fragment.empty,s=0,c=o[n];if(e.depth>n){var l=t(e,n+1,o,i||c);s=l.openEnd+1,a=r.Fragment.from(e.node(n+1).copy(l.content))}c&&(a=a.append(c.content),s=c.openEnd);i&&(a=a.append(e.node(n).contentMatchAt(e.indexAfter(n)).fillBefore(r.Fragment.empty,!0)),s=0);return{content:a,openEnd:s}}(t,0,e,!1),o=n.content,i=n.openEnd;return new r.Slice(o,t.depth,i||0)}(i,function(t,e){for(var n=new E(t),r=1;e.size&&r<=3;r++)e=n.placeSlice(e.content,e.openStart,e.openEnd,r);for(;n.open.length;)n.closeNode();return n.placed}(i,o)),c=N(i,a,s);if(!c)return null;if(s.size!=c.size&&function(t,e,n){if(!e.parent.isTextblock)return!1;var r;if(n.openEnd){var o=function(t,e){for(var n=1;n<e;n++)t=t.lastChild.content;return t.lastChild}(n.content,n.openEnd);if(!o.isTextblock)return!1;r=o.contentMatchAt(o.childCount)}else{var i=t.node(t.depth-(n.openStart-n.openEnd));if(!i.isTextblock)return!1;r=i.contentMatchAt(i.childCount),n.size&&(r=r.matchFragment(n.content,n.openStart?1:0))}return(r=r.matchFragment(e.parent.content,e.index()))&&r.validEnd}(i,a,s)){for(var l=a.depth,p=a.after(l);l>1&&p==a.end(--l);)++p;var h=N(i,t.resolve(p),s);if(h)return new y(e,p,n,a.end(),h,s.size)}return c.size||e!=n?new g(e,n,c):null}function D(t,e,n,o,i,a,s){var c,l=t.childCount,p=l-(s>0?1:0);c=a<0?e.contentMatchAt(p):1==l&&s>0?n.node(i).contentMatchAt(a?n.index(i):n.indexAfter(i)):n.node(i).contentMatchAt(n.indexAfter(i)).matchFragment(t,l>0&&a?1:0,p);var h=o.node(i);if(s>0&&i<o.depth){var u=h.content.cutByIndex(o.indexAfter(i)).addToStart(t.lastChild),f=c.fillBefore(u,!0);if(f&&f.size&&a>0&&1==l&&(f=null),f){var d=D(t.lastChild.content,t.lastChild,n,o,i+1,1==l?a-1:-1,s-1);if(d){var m=t.lastChild.copy(d);return f.size?t.cutByIndex(0,l-1).append(f).addToEnd(m):t.replaceChild(l-1,m)}}}s>0&&(c=c.matchType((1==l&&a>0?n.node(i+1):t.lastChild).type));var v=o.index(i);if(v==h.childCount&&!h.type.compatibleContent(e.type))return null;var g=c.fillBefore(h.content,!0,v);if(!g)return null;if(s>0){var y=function t(e,n,o,i,a){var s,c=e.content,l=c.childCount;s=a>=0?o.node(i).contentMatchAt(o.indexAfter(i)).matchFragment(c,a>0?1:0,l):e.contentMatchAt(l);if(n>0){var p=t(c.lastChild,n-1,o,i+1,1==l?a-1:-1);c=c.replaceChild(l-1,p)}return e.copy(c.append(s.fillBefore(r.Fragment.empty,!0)))}(t.lastChild,s-1,n,i+1,1==l?a-1:-1);t=t.replaceChild(l-1,y)}return t=t.append(g),o.depth>i&&(t=t.addToEnd(function t(e,n){var r=e.node(n);var o=r.contentMatchAt(0).fillBefore(r.content,!0,e.index(n));e.depth>n&&(o=o.addToEnd(t(e,n+1)));return r.copy(o)}(o,i+1))),t}function N(t,e,n){var o=D(n.content,t.node(0),t,e,0,n.openStart,n.openEnd);return o?function(t,e,n){for(;e>0&&n>0&&1==t.childCount;)t=t.firstChild.content,e--,n--;return new r.Slice(t,e,n)}(o,n.openStart,e.depth):null}function A(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}m.jsonID("removeMark",O),h.prototype.addMark=function(t,e,n){var r=this,o=[],i=[],a=null,s=null;return this.doc.nodesBetween(t,e,function(r,c,l){if(r.isInline){var p=r.marks;if(!n.isInSet(p)&&l.type.allowsMarkType(n.type)){for(var h=Math.max(c,t),u=Math.min(c+r.nodeSize,e),f=n.addToSet(p),d=0;d<p.length;d++)p[d].isInSet(f)||(a&&a.to==h&&a.mark.eq(p[d])?a.to=u:o.push(a=new O(h,u,p[d])));s&&s.to==h?s.to=u:i.push(s=new M(h,u,n))}}}),o.forEach(function(t){return r.step(t)}),i.forEach(function(t){return r.step(t)}),this},h.prototype.removeMark=function(t,e,n){var o=this;void 0===n&&(n=null);var i=[],a=0;return this.doc.nodesBetween(t,e,function(o,s){if(o.isInline){a++;var c=null;if(n instanceof r.MarkType){var l=n.isInSet(o.marks);l&&(c=[l])}else n?n.isInSet(o.marks)&&(c=[n]):c=o.marks;if(c&&c.length)for(var p=Math.min(s+o.nodeSize,e),h=0;h<c.length;h++){for(var u=c[h],f=void 0,d=0;d<i.length;d++){var m=i[d];m.step==a-1&&u.eq(i[d].style)&&(f=m)}f?(f.to=p,f.step=a):i.push({style:u,from:Math.max(s,t),to:p,step:a})}}}),i.forEach(function(t){return o.step(new O(t.from,t.to,t.style))}),this},h.prototype.clearIncompatible=function(t,e,n){void 0===n&&(n=e.contentMatch);for(var o=this.doc.nodeAt(t),i=[],a=t+1,s=0;s<o.childCount;s++){var c=o.child(s),l=a+c.nodeSize,p=n.matchType(c.type,c.attrs);if(p){n=p;for(var h=0;h<c.marks.length;h++)e.allowsMarkType(c.marks[h].type)||this.step(new O(a,l,c.marks[h]))}else i.push(new g(a,l,r.Slice.empty));a=l}if(!n.validEnd){var u=n.fillBefore(r.Fragment.empty,!0);this.replace(a,a,new r.Slice(u,0,0))}for(var f=i.length-1;f>=0;f--)this.step(i[f]);return this},h.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=r.Slice.empty);var o=T(this.doc,t,e,n);return o&&this.step(o),this},h.prototype.replaceWith=function(t,e,n){return this.replace(t,e,new r.Slice(r.Fragment.from(n),0,0))},h.prototype.delete=function(t,e){return this.replace(t,e,r.Slice.empty)},h.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var E=function(t){this.open=[];for(var e=0;e<=t.depth;e++){var n=t.node(e),o=n.contentMatchAt(t.indexAfter(e));this.open.push({parent:n,match:o,content:r.Fragment.empty,wrapper:!1,openEnd:0,depth:e})}this.placed=[]};function R(t,e,n){var r=t.content;if(e>1){var o=R(t.firstChild,e-1,1==t.childCount?n-1:0);r=t.content.replaceChild(0,o)}var i=t.type.contentMatch.fillBefore(r,0==n);return t.copy(i.append(r))}function F(t,e,n,r,o){if(e<n){var i=t.firstChild;t=t.replaceChild(0,i.copy(F(i.content,e+1,n,r,i)))}return e>r&&(t=o.contentMatchAt(0).fillBefore(t).append(t)),t}function $(t,e){for(var n=[],r=Math.min(t.depth,e.depth);r>=0;r--){var o=t.start(r);if(o<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;o==e.start(r)&&n.push(r)}return n}E.prototype.placeSlice=function(t,e,n,o,i){if(e>0){var a=t.firstChild,s=this.placeSlice(a.content,Math.max(0,e-1),n&&1==t.childCount?n-1:0,o,a);s.content!=a.content&&(s.content.size?(t=t.replaceChild(0,a.copy(s.content)),e=s.openStart+1):(1==t.childCount&&(n=0),t=t.cutByIndex(1),e=0))}var c=this.placeContent(t,e,n,o,i);if(o>2&&c.size&&0==e){for(var l=0;l<c.content.childCount;l++){var p=c.content.child(l);this.placeContent(p.content,0,n&&l==c.content.childCount.length-1?n-1:0,o,p)}c=r.Fragment.empty}return c},E.prototype.placeContent=function(t,e,n,o,i){for(var a=0;a<t.childCount;a++){for(var s=t.child(a),c=!1,l=a==t.childCount-1,p=this.open.length-1;p>=0;p--){var h=this.open[p],u=void 0;if(o>1&&(u=h.match.findWrapping(s.type))&&(!i||!u.length||u[u.length-1]!=i.type)){for(;this.open.length-1>p;)this.closeNode();for(var f=0;f<u.length;f++)h.match=h.match.matchType(u[f]),p++,h={parent:u[f].create(),match:u[f].contentMatch,content:r.Fragment.empty,wrapper:!0,openEnd:0,depth:p+f},this.open.push(h)}var d=h.match.matchType(s.type);if(!d){var m=h.match.fillBefore(r.Fragment.from(s));if(!m){if(i&&h.match.matchType(i.type))break;continue}for(var v=0;v<m.childCount;v++){var g=m.child(v);this.addNode(h,g,0),d=h.match.matchFragment(g)}}for(;this.open.length-1>p;)this.closeNode();s=s.mark(h.parent.type.allowedMarks(s.marks)),e&&(s=R(s,e,l?n:0),e=0),this.addNode(h,s,l?n:0),h.match=d,l&&(n=0),c=!0;break}if(!c)break}return this.open.length>1&&(a>0&&a==t.childCount||i&&this.open[this.open.length-1].parent.type==i.type)&&this.closeNode(),new r.Slice(t.cutByIndex(a),e,n)},E.prototype.addNode=function(t,e,n){var o,i;t.content=(o=t.content,i=t.openEnd,i?o.replaceChild(o.childCount-1,function t(e,n){var o=e.content;if(n>1){var i=t(e.lastChild,n-1);o=e.content.replaceChild(e.childCount-1,i)}var a=e.contentMatchAt(e.childCount).fillBefore(r.Fragment.empty,!0);return e.copy(o.append(a))}(o.lastChild,i)):o).addToEnd(e),t.openEnd=n},E.prototype.closeNode=function(){var t=this.open.pop();0==t.content.size||(t.wrapper?this.addNode(this.open[this.open.length-1],t.parent.copy(t.content),t.openEnd+1):this.placed[t.depth]={depth:t.depth,content:t.content,openEnd:t.openEnd})},h.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var o=this.doc.resolve(t),i=this.doc.resolve(e);if(A(o,i,n))return this.step(new g(t,e,n));var a=$(o,this.doc.resolve(e));0==a[a.length-1]&&a.pop();var s=-(o.depth+1);a.unshift(s);for(var c=o.depth,l=o.pos-1;c>0;c--,l--){var p=o.node(c).type.spec;if(p.defining||p.isolating)break;a.indexOf(c)>-1?s=c:o.before(c)==l&&a.splice(1,0,-c)}for(var h=a.indexOf(s),u=[],f=n.openStart,d=n.content,m=0;;m++){var v=d.firstChild;if(u.push(v),m==n.openStart)break;d=v.content}f>0&&u[f-1].type.spec.defining&&o.node(h).type!=u[f-1].type?f-=1:f>=2&&u[f-1].isTextblock&&u[f-2].type.spec.defining&&o.node(h).type!=u[f-2].type&&(f-=2);for(var y=n.openStart;y>=0;y--){var w=(y+f+1)%(n.openStart+1),b=u[w];if(b)for(var k=0;k<a.length;k++){var S=a[(k+h)%a.length],x=!0;S<0&&(x=!1,S=-S);var C=o.node(S-1),M=o.index(S-1);if(C.canReplaceWith(M,M,b.type,b.marks))return this.replace(o.before(S),x?i.after(S):e,new r.Slice(F(n.content,0,n.openStart,w),w,n.openEnd))}}return this.replace(t,e,n)},h.prototype.replaceRangeWith=function(t,e,n){if(!n.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var o=x(this.doc,t,n.type);null!=o&&(t=e=o)}return this.replaceRange(t,e,new r.Slice(r.Fragment.from(n),0,0))},h.prototype.deleteRange=function(t,e){for(var n=this.doc.resolve(t),r=this.doc.resolve(e),o=$(n,r),i=0;i<o.length;i++){var a=o[i],s=i==o.length-1;if(s&&0==a||n.node(a).type.contentMatch.validEnd)return this.delete(n.start(a),r.end(a));if(a>0&&(s||n.node(a-1).canReplace(n.index(a-1),r.indexAfter(a-1))))return this.delete(n.before(a),r.after(a))}for(var c=1;c<=n.depth;c++)if(t-n.start(c)==n.depth-c&&e>n.end(c))return this.delete(n.before(c),e);return this.delete(t,e)},e.Transform=h,e.TransformError=p,e.Step=m,e.StepResult=v,e.joinPoint=function(t,e,n){void 0===n&&(n=-1);for(var r=t.resolve(e),o=r.depth;;o--){var i=void 0,a=void 0;if(o==r.depth?(i=r.nodeBefore,a=r.nodeAfter):n>0?(i=r.node(o+1),a=r.node(o).maybeChild(r.index(o)+1)):(i=r.node(o).maybeChild(r.index(o)-1),a=r.node(o+1)),i&&!i.isTextblock&&S(i,a))return e;if(0==o)break;e=n<0?r.before(o):r.after(o)}},e.canJoin=function(t,e){var n=t.resolve(e),r=n.index();return S(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)},e.canSplit=function(t,e,n,r){void 0===n&&(n=1);var o=t.resolve(e),i=o.depth-n,a=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!a.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var s=o.depth-1,c=n-2;s>i;s--,c--){var l=o.node(s),p=o.index(s);if(l.type.spec.isolating)return!1;var h=l.content.cutByIndex(p,l.childCount),u=r&&r[c]||l;if(u!=l&&(h=h.replaceChild(0,u.type.create(u.attrs))),!l.canReplace(p+1,l.childCount)||!u.type.validContent(h))return!1}var f=o.indexAfter(i),d=r&&r[0];return o.node(i).canReplaceWith(f,f,d?d.type:o.node(i+1).type)},e.insertPoint=x,e.liftTarget=function(t){for(var e=t.parent.content.cutByIndex(t.startIndex,t.endIndex),n=t.depth;;--n){var r=t.$from.node(n),o=t.$from.index(n),i=t.$to.indexAfter(n);if(n<t.depth&&r.canReplace(o,i,e))return n;if(0==n||r.type.spec.isolating||!b(r,o,i))break}},e.findWrapping=function(t,e,n,r){void 0===r&&(r=t);var o=function(t,e){var n=t.parent,r=t.startIndex,o=t.endIndex,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;var a=i.length?i[0]:e;return n.canReplaceWith(r,o,a)?i:null}(t,e),i=o&&function(t,e){var n=t.parent,r=t.startIndex,o=t.endIndex,i=n.child(r),a=e.contentMatch.findWrapping(i.type);if(!a)return null;for(var s=(a.length?a[a.length-1]:e).contentMatch,c=r;s&&c<o;c++)s=s.matchType(n.child(c).type);return s&&s.validEnd?a:null}(r,e);return i?o.map(k).concat({type:e,attrs:n}).concat(i.map(k)):null},e.StepMap=c,e.MapResult=s,e.Mapping=l,e.AddMarkStep=M,e.RemoveMarkStep=O,e.ReplaceStep=g,e.ReplaceAroundStep=y,e.replaceStep=T},function(t,e,n){var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=n(7).NodeForm,a=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"prosemirror-mediaform";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name="Image Configuration",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i),o(e,[{key:"setSource",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$form.find('[name="mediatarget"]').val(t)}},{key:"getSource",value:function(){return this.$form.find('[name="mediatarget"]').val()}},{key:"setCaption",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$form.find('[name="mediacaption"]').val(t)}},{key:"getCaption",value:function(){return this.$form.find('[name="mediacaption"]').val()}},{key:"setWidth",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$form.find('[name="width"]').val(t)}},{key:"getWidth",value:function(){return this.$form.find('[name="width"]').val()}},{key:"setHeight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$form.find('[name="height"]').val(t)}},{key:"getHeight",value:function(){return this.$form.find('[name="height"]').val()}},{key:"setAlignment",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$form.find('[name="alignment"]').prop("checked",""),this.$form.find('[name="alignment"][value="'+t+'"]').prop("checked","checked")}},{key:"getAlignment",value:function(){return this.$form.find('[name="alignment"]:checked').val()}},{key:"setLinking",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"details";this.$form.find('[name="linking"]').prop("checked",""),this.$form.find('[name="linking"][value="'+t+'"]').prop("checked","checked")}},{key:"getLinking",value:function(){return this.$form.find('[name="linking"]:checked').val()}},{key:"setCache",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$form.find('[name="caching"]').prop("checked",""),this.$form.find('[name="caching"][value="'+t+'"]').prop("checked","checked")}},{key:"getCache",value:function(){return this.$form.find('[name="caching"]:checked').val()}},{key:"resetForm",value:function(){this.setSource(),this.setCaption(),this.setWidth(),this.setHeight(),this.setAlignment(),this.setLinking(),this.setCache()}}],[{key:"resolveSubmittedLinkData",value:function(t,e,n){return function(o){o.preventDefault();var i=r({},t);i.id=e.getSource(),i.title=e.getCaption(),i.width=e.getWidth(),i.height=e.getHeight(),i.align=e.getAlignment(),i.linking=e.getLinking(),i.cache=e.getCache(),jQuery.get(DOKU_BASE+"/lib/exe/ajax.php",{call:"plugin_prosemirror",actions:["resolveMedia"],attrs:i,id:JSINFO.id}).done(function(t){var e=JSON.parse(t);i["data-resolvedHtml"]=e.resolveMedia["data-resolvedHtml"],console.log(i),n(i)})}}}]),e}();e.MediaForm=a},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(e,"__esModule",{value:!0});var o,i=(o=n(20))&&"object"===(void 0===o?"undefined":r(o))&&"default"in o?o.default:o,a=n(1),s="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function c(t){var e,n,r,o,i=t.split(/-(?!$)/),a=i[i.length-1];"Space"==a&&(a=" ");for(var c=0;c<i.length-1;c++){var l=i[c];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))e=!0;else if(/^(c|ctrl|control)$/i.test(l))n=!0;else if(/^s(hift)?$/i.test(l))r=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);s?o=!0:n=!0}}return e&&(a="Alt-"+a),n&&(a="Ctrl-"+a),o&&(a="Meta-"+a),r&&(a="Shift-"+a),a}function l(t,e,n){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==n&&e.shiftKey&&(t="Shift-"+t),t}function p(t){var e=function(t){var e=Object.create(null);for(var n in t)e[c(n)]=t[n];return e}(t);return function(t,n){var r,o=i(n),a=1==o.length&&" "!=o,s=e[l(o,n,!a)];if(s&&s(t.state,t.dispatch,t))return!0;if(a&&(n.shiftKey||n.altKey||n.metaKey)&&(r=i.base[n.keyCode])&&r!=o){var c=e[l(r,n,!0)];if(c&&c(t.state,t.dispatch,t))return!0}return!1}}e.keymap=function(t){return new a.Plugin({props:{handleKeyDown:p(t)}})},e.keydownHandler=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=n(0),i=n(1);function a(t,e){return!t.selection.empty&&(e&&e(t.tr.deleteSelection().scrollIntoView()),!0)}function s(t,e,n){var o=t.selection.$cursor;if(!o||(n?!n.endOfTextblock("backward",t):o.parentOffset>0))return!1;var a=p(o);if(!a){var s=o.blockRange(),l=s&&r.liftTarget(s);return null!=l&&(e&&e(t.tr.lift(s,l).scrollIntoView()),!0)}var h=a.nodeBefore;if(!h.type.spec.isolating&&b(t,a,e))return!0;if(0==o.parent.content.size&&(c(h,"end")||i.NodeSelection.isSelectable(h))){if(e){var u=t.tr.deleteRange(o.before(),o.after());u.setSelection(c(h,"end")?i.Selection.findFrom(u.doc.resolve(u.mapping.map(a.pos,-1)),-1):i.NodeSelection.create(u.doc,a.pos-h.nodeSize)),e(u.scrollIntoView())}return!0}return!(!h.isAtom||a.depth!=o.depth-1)&&(e&&e(t.tr.delete(a.pos-h.nodeSize,a.pos).scrollIntoView()),!0)}function c(t,e){for(;t;t="start"==e?t.firstChild:t.lastChild)if(t.isTextblock)return!0;return!1}function l(t,e,n){var r=t.selection.$cursor;if(!r||(n?!n.endOfTextblock("backward",t):r.parentOffset>0))return!1;var o=p(r),a=o&&o.nodeBefore;return!(!a||!i.NodeSelection.isSelectable(a))&&(e&&e(t.tr.setSelection(i.NodeSelection.create(t.doc,o.pos-a.nodeSize)).scrollIntoView()),!0)}function p(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function h(t,e,n){var r=t.selection.$cursor;if(!r||(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size))return!1;var o=f(r);if(!o)return!1;var a=o.nodeAfter;if(b(t,o,e))return!0;if(0==r.parent.content.size&&(c(a,"start")||i.NodeSelection.isSelectable(a))){if(e){var s=t.tr.deleteRange(r.before(),r.after());s.setSelection(c(a,"start")?i.Selection.findFrom(s.doc.resolve(s.mapping.map(o.pos)),1):i.NodeSelection.create(s.doc,s.mapping.map(o.pos))),e(s.scrollIntoView())}return!0}return!(!a.isAtom||o.depth!=r.depth-1)&&(e&&e(t.tr.delete(o.pos,o.pos+a.nodeSize).scrollIntoView()),!0)}function u(t,e,n){var r=t.selection.$cursor;if(!r||(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size))return!1;var o=f(r),a=o&&o.nodeAfter;return!(!a||!i.NodeSelection.isSelectable(a))&&(e&&e(t.tr.setSelection(i.NodeSelection.create(t.doc,o.pos)).scrollIntoView()),!0)}function f(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){var n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}function d(t,e){var n=t.selection,r=n.$head,o=n.$anchor;return!(!r.parent.type.spec.code||!r.sameParent(o))&&(e&&e(t.tr.insertText("\n").scrollIntoView()),!0)}function m(t,e){var n=t.selection,r=n.$head,o=n.$anchor;if(!r.parent.type.spec.code||!r.sameParent(o))return!1;var a=r.node(-1),s=r.indexAfter(-1),c=a.contentMatchAt(s).defaultType;if(!a.canReplaceWith(s,s,c))return!1;if(e){var l=r.after(),p=t.tr.replaceWith(l,l,c.createAndFill());p.setSelection(i.Selection.near(p.doc.resolve(l),1)),e(p.scrollIntoView())}return!0}function v(t,e){var n=t.selection,r=n.$from,o=n.$to;if(r.parent.inlineContent||o.parent.inlineContent)return!1;var a=r.parent.contentMatchAt(o.indexAfter()).defaultType;if(!a||!a.isTextblock)return!1;if(e){var s=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,c=t.tr.insert(s,a.createAndFill());c.setSelection(i.TextSelection.create(c.doc,s+1)),e(c.scrollIntoView())}return!0}function g(t,e){var n=t.selection.$cursor;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){var o=n.before();if(r.canSplit(t.doc,o))return e&&e(t.tr.split(o).scrollIntoView()),!0}var i=n.blockRange(),a=i&&r.liftTarget(i);return null!=a&&(e&&e(t.tr.lift(i,a).scrollIntoView()),!0)}function y(t,e){var n=t.selection,a=n.$from,s=n.$to;if(t.selection instanceof i.NodeSelection&&t.selection.node.isBlock)return!(!a.parentOffset||!r.canSplit(t.doc,a.pos))&&(e&&e(t.tr.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(e){var c=s.parentOffset==s.parent.content.size,l=t.tr;t.selection instanceof i.TextSelection&&l.deleteSelection();var p=0==a.depth?null:a.node(-1).contentMatchAt(a.indexAfter(-1)).defaultType,h=c&&p?[{type:p}]:null,u=r.canSplit(l.doc,a.pos,1,h);h||u||!r.canSplit(l.doc,l.mapping.map(a.pos),1,p&&[{type:p}])||(h=[{type:p}],u=!0),u&&(l.split(l.mapping.map(a.pos),1,h),c||a.parentOffset||a.parent.type==p||!a.node(-1).canReplace(a.index(-1),a.indexAfter(-1),o.Fragment.from(p.create(),a.parent))||l.setNodeMarkup(l.mapping.map(a.before()),p)),e(l.scrollIntoView())}return!0}function w(t,e){return e&&e(t.tr.setSelection(new i.AllSelection(t.doc))),!0}function b(t,e,n){var a,s,c=e.nodeBefore,l=e.nodeAfter;if(c.type.spec.isolating||l.type.spec.isolating)return!1;if(function(t,e,n){var o=e.nodeBefore,i=e.nodeAfter,a=e.index();return!(!(o&&i&&o.type.compatibleContent(i.type))||(!o.content.size&&e.parent.canReplace(a-1,a)?(n&&n(t.tr.delete(e.pos-o.nodeSize,e.pos).scrollIntoView()),0):!e.parent.canReplace(a,a+1)||!i.isTextblock&&!r.canJoin(t.doc,e.pos)||(n&&n(t.tr.clearIncompatible(e.pos,o.type,o.contentMatchAt(o.childCount)).join(e.pos).scrollIntoView()),0)))}(t,e,n))return!0;if(e.parent.canReplace(e.index(),e.index()+1)&&(a=(s=c.contentMatchAt(c.childCount)).findWrapping(l.type))&&s.matchType(a[0]||l.type).validEnd){if(n){for(var p=e.pos+l.nodeSize,h=o.Fragment.empty,u=a.length-1;u>=0;u--)h=o.Fragment.from(a[u].create(null,h));h=o.Fragment.from(c.copy(h));var f=t.tr.step(new r.ReplaceAroundStep(e.pos-1,p,e.pos,p,new o.Slice(h,1,0),a.length,!0)),d=p+2*a.length;r.canJoin(f.doc,d)&&f.join(d),n(f.scrollIntoView())}return!0}var m=i.Selection.findFrom(e,1),v=m&&m.$from.blockRange(m.$to),g=v&&r.liftTarget(v);return null!=g&&g>=e.depth&&(n&&n(t.tr.lift(v,g).scrollIntoView()),!0)}function k(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return function(e,n,r){for(var o=0;o<t.length;o++)if(t[o](e,n,r))return!0;return!1}}var S=k(a,s,l),x=k(a,h,u),C={Enter:k(d,v,g,y),"Mod-Enter":m,Backspace:S,"Mod-Backspace":S,Delete:x,"Mod-Delete":x,"Mod-a":w},M={"Ctrl-h":C.Backspace,"Alt-Backspace":C["Mod-Backspace"],"Ctrl-d":C.Delete,"Ctrl-Alt-Backspace":C["Mod-Delete"],"Alt-Delete":C["Mod-Delete"],"Alt-d":C["Mod-Delete"]};for(var O in C)M[O]=C[O];var T=("undefined"!=typeof navigator?/Mac/.test(navigator.platform):"undefined"!=typeof os&&"darwin"==os.platform())?M:C;e.deleteSelection=a,e.joinBackward=s,e.selectNodeBackward=l,e.joinForward=h,e.selectNodeForward=u,e.joinUp=function(t,e){var n,o=t.selection,a=o instanceof i.NodeSelection;if(a){if(o.node.isTextblock||!r.canJoin(t.doc,o.from))return!1;n=o.from}else if(null==(n=r.joinPoint(t.doc,o.from,-1)))return!1;if(e){var s=t.tr.join(n);a&&s.setSelection(i.NodeSelection.create(s.doc,n-t.doc.resolve(n).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},e.joinDown=function(t,e){var n,o=t.selection;if(o instanceof i.NodeSelection){if(o.node.isTextblock||!r.canJoin(t.doc,o.to))return!1;n=o.to}else if(null==(n=r.joinPoint(t.doc,o.to,1)))return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},e.lift=function(t,e){var n=t.selection,o=n.$from,i=n.$to,a=o.blockRange(i),s=a&&r.liftTarget(a);return null!=s&&(e&&e(t.tr.lift(a,s).scrollIntoView()),!0)},e.newlineInCode=d,e.exitCode=m,e.createParagraphNear=v,e.liftEmptyBlock=g,e.splitBlock=y,e.splitBlockKeepMarks=function(t,e){return y(t,e&&function(n){var r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();r&&n.ensureMarks(r),e(n)})},e.selectParentNode=function(t,e){var n,r=t.selection,o=r.$from,a=r.to,s=o.sharedDepth(a);return 0!=s&&(n=o.before(s),e&&e(t.tr.setSelection(i.NodeSelection.create(t.doc,n))),!0)},e.selectAll=w,e.wrapIn=function(t,e){return function(n,o){var i=n.selection,a=i.$from,s=i.$to,c=a.blockRange(s),l=c&&r.findWrapping(c,t,e);return!!l&&(o&&o(n.tr.wrap(c,l).scrollIntoView()),!0)}},e.setBlockType=function(t,e){return function(n,r){var o=n.selection,i=o.from,a=o.to,s=!1;return n.doc.nodesBetween(i,a,function(r,o){if(s)return!1;if(r.isTextblock&&!r.hasMarkup(t,e))if(r.type==t)s=!0;else{var i=n.doc.resolve(o),a=i.index();s=i.parent.canReplaceWith(a,a+1,t)}}),!!s&&(r&&r(n.tr.setBlockType(i,a,t,e).scrollIntoView()),!0)}},e.toggleMark=function(t,e){return function(n,r){var o=n.selection,i=o.empty,a=o.$cursor,s=o.ranges;if(i&&!a||!function(t,e,n){for(var r=function(r){var o=e[r],i=o.$from,a=o.$to,s=0==i.depth&&t.type.allowsMarkType(n);if(t.nodesBetween(i.pos,a.pos,function(t){if(s)return!1;s=t.inlineContent&&t.type.allowsMarkType(n)}),s)return{v:!0}},o=0;o<e.length;o++){var i=r(o);if(i)return i.v}return!1}(n.doc,s,t))return!1;if(r)if(a)t.isInSet(n.storedMarks||a.marks())?r(n.tr.removeStoredMark(t)):r(n.tr.addStoredMark(t.create(e)));else{for(var c=!1,l=n.tr,p=0;!c&&p<s.length;p++){var h=s[p],u=h.$from,f=h.$to;c=n.doc.rangeHasMark(u.pos,f.pos,t)}for(var d=0;d<s.length;d++){var m=s[d],v=m.$from,g=m.$to;c?l.removeMark(v.pos,g.pos,t):l.addMark(v.pos,g.pos,t.create(e))}r(l.scrollIntoView())}return!0}},e.autoJoin=function(t,e){if(Array.isArray(e)){var n=e;e=function(t){return n.indexOf(t.type.name)>-1}}return function(n,o){return t(n,o&&function(t,e){return function(n){if(!n.isGeneric)return t(n);for(var o=[],i=0;i<n.mapping.maps.length;i++){for(var a=n.mapping.maps[i],s=0;s<o.length;s++)o[s]=a.map(o[s]);a.forEach(function(t,e,n,r){return o.push(n,r)})}for(var c=[],l=0;l<o.length;l+=2)for(var p=o[l],h=o[l+1],u=n.doc.resolve(p),f=u.sharedDepth(h),d=u.node(f),m=u.indexAfter(f),v=u.after(f+1);v<=h;++m){var g=d.maybeChild(m);if(!g)break;if(m&&-1==c.indexOf(v)){var y=d.child(m-1);y.type==g.type&&e(y,g)&&c.push(v)}v+=g.nodeSize}c.sort(function(t,e){return t-e});for(var w=c.length-1;w>=0;w--)r.canJoin(n.doc,c[w])&&n.join(c[w]);t(n)}}(o,e))}},e.chainCommands=k,e.pcBaseKeymap=C,e.macBaseKeymap=M,e.baseKeymap=T},function(t,e){var n=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var r=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.node=e,this.outerView=n,this.getPos=r,this.renderNode(e.attrs)}return n(t,[{key:"renderNode",value:function(t){throw console.log(this.node,t),Error("renderNode must be implemented by child class!")}}],[{key:"unsetPrefixAttributes",value:function(t,e){var n={};return Object.keys(e).forEach(function(r){r.substr(0,t.length)!==t&&(n[r]=e[r])}),n}}]),t}();e.AbstractNodeView=r},function(t,e){var n=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$form=jQuery("#"+e)}return n(t,[{key:"show",value:function(){jQuery(this.$form).dialog({title:this.name})}},{key:"hide",value:function(){jQuery(this.$form).dialog("close")}},{key:"on",value:function(t,e){this.$form.on(t,e)}},{key:"off",value:function(t){this.$form.off(t)}}]),t}();e.NodeForm=r},function(t,e,n){var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var s=n(7).NodeForm,c=n(3).MediaForm,l=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"prosemirror-linkform"));return t.name="Link Configuration",jQuery("#prosemirror-linkform").length?(t.initializeLinkForm(),a(t)):(jQuery(t.initializeLinkForm.bind(t)),t)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s),i(e,[{key:"getLinkType",value:function(){return this.$form.find('[name="linktype"]:checked').val()}},{key:"setLinkType",value:function(t){var e=this.$form.find('[name="linktype"]').map(function(){return jQuery(this).val()}).get();e.includes(t)?this.$form.find('[name="linktype"][value="'+t+'"]').prop("checked",!0).trigger("change"):console.error("invalid link type "+t+". Only the following are valid: ",e)}},{key:"getLinkTarget",value:function(){return"interwikilink"===this.getLinkType()?this.$form.find('[name="iwshortcut"]').val()+">"+this.$form.find('[name="linktarget"]').val():this.$form.find('[name="linktarget"]').val()}},{key:"setLinkTarget",value:function(t,e){if("interwikilink"===t){var n=e.split(">",2),r=o(n,2),i=r[0],a=r[1];return a||(a=i,i="go"),this.$form.find('[name="iwshortcut"]').show().val(i),void this.$form.find('[name="linktarget"]').val(a)}this.$form.find('[name="linktarget"]').val(e)}},{key:"getLinkNameType",value:function(){return this.$form.find('[name="nametype"]:checked').val()}},{key:"setLinkNameType",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.$form.find('[name="nametype"]').map(function(){return jQuery(this).val()}).get();n.includes(t)?(this.$form.find('[name="nametype"][value="'+t+'"]').prop("checked",!0).trigger("change"),"custom"===t?this.$form.find('[name="linkname"]').val(e):"image"===t&&(this.MediaForm=new c("prosemirror-linkform"),this.MediaForm.setSource(e.id),this.MediaForm.setCaption(e.title),this.MediaForm.setWidth(e.width),this.MediaForm.setHeight(e.height),this.MediaForm.setAlignment(e.align),this.MediaForm.setCache(e.cache))):console.error("invalid link type "+t+". Only the following are valid: ",n)}},{key:"getLinkName",value:function(){return this.$form.find('[name="linkname"]').val()}},{key:"resetForm",value:function(){this.setLinkTarget(""),this.setLinkType("externallink"),this.setLinkNameType("automatic"),this.off()}},{key:"initializeLinkForm",value:function(){this.$form.find('[name="nametype"]').on("change",this.handleNameTypeChange.bind(this)),this.$form.find('[name="linktype"]').on("change",this.handleLinkTypeChange.bind(this)),this.resetForm()}},{key:"handleNameTypeChange",value:function(){var t=this.$form.find('[name="nametype"]:checked').val();switch(t){case"automatic":this.$form.find(".js-media-fieldset").remove(),this.$form.find('[name="linkname"]').val("").attr("type","hidden").closest("label").hide();break;case"custom":this.$form.find(".js-media-fieldset").remove(),this.$form.find('[name="linkname"]').val("").attr("type","text").closest("label").show();break;case"image":this.$form.find('[name="linkname"]').val("").attr("type","hidden").closest("label").hide();var e=jQuery("#prosemirror-mediaform").find(".js-media-fieldset").clone();this.$form.find(".js-media-wrapper").html(e),this.MediaForm=new c("prosemirror-linkform");break;default:console.log(t)}}},{key:"handleLinkTypeChange",value:function(){var t=this.$form.find('[name="linktype"]:checked').val(),e=this.$form.find('[name="linktarget"]');switch(this.$form.find('[name="iwshortcut"]').closest("label").hide(),t){case"externallink":e.attr("type","url").prop("placeholder","https://www.example.com");break;case"emaillink":e.attr("type","email").prop("placeholder","mail@example.com");break;case"internallink":e.attr("type","text").prop("placeholder","namespace:page");break;case"interwikilink":this.$form.find('[name="iwshortcut"]').closest("label").show(),e.attr("type","text").prop("placeholder","");break;case"other":e.attr("type","text").prop("placeholder","");break;default:console.warn("unknown / unhandled linktype "+t)}}}],[{key:"resolveSubmittedLinkData",value:function(t,e,n){return function(i){i.preventDefault(),i.stopPropagation();var a=e;a["data-inner"]=t.getLinkTarget(),a["data-type"]=t.getLinkType();var s=t.getLinkNameType();"custom"===s&&(a["data-name"]=t.getLinkName()),"automatic"===s&&delete a["data-name"];var c=[],l={},p={};"image"===s&&(delete a["data-name"],c.push("resolveImageTitle"),p.id=t.MediaForm.getSource(),p.title=t.MediaForm.getCaption(),p.width=t.MediaForm.getWidth(),p.height=t.MediaForm.getHeight(),p.align=t.MediaForm.getAlignment(),p.cache=t.MediaForm.getCache(),l.image=p,a=Object.entries(p).reduce(function(t,e){var n=o(e,2),i=n[0],a=n[1];return r({},t,function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},"image-"+i,a))},a)),"internallink"===a["data-type"]&&c.push("resolveInternalLink"),"interwikilink"===a["data-type"]&&c.push("resolveInterWikiLink"),c.length?jQuery.get(DOKU_BASE+"/lib/exe/ajax.php",r({call:"plugin_prosemirror",actions:c,inner:a["data-inner"],id:JSINFO.id},l)).done(function(t){var e=JSON.parse(t);if(e.resolveInternalLink){var r=e.resolveInternalLink,o=r.id,i=r.exists,c=r.heading;a["data-resolvedID"]=o,a["data-resolvedTitle"]=o,a["data-resolvedClass"]=i?"wikilink1":"wikilink2","automatic"===s&&(a["data-resolvedName"]=c)}if(e.resolveInterWikiLink){var l=e.resolveInterWikiLink,p=l.url,h=l.resolvedClass;a["data-resolvedUrl"]=p,a["data-resolvedClass"]=h}e.resolveImageTitle&&(a["data-resolvedImage"]=e.resolveImageTitle["data-resolvedImage"]),n(a)}):n(a)}}}]),e}();e.LinkForm=l},function(t,e,n){var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o=n(19).tableNodes,i=n(18),a=i.bulletList,s=i.listItem,c=i.orderedList,l=n(17).schema,p=n(0).Schema,h=l.spec,u=h.nodes,f=h.marks,d=u.get("doc");d.content="(block | listblock | tableblock)+";var m=(u=u.update("doc",d)).get("heading");m.content="text*",u.update("heading",m),c.group="listblock",c.content="listitem+",u=u.update("ordered_list",c),a.group="listblock",a.content="listitem+",u=u.update("bullet_list",a),s.group="listitem",s.content="block+ listblock?";var v=(u=(u=(u=u.update("list_item",s)).append(o({tableGroup:"tableblock",cellContent:"inline*",cellAttributes:{is_header:{}}}))).addToEnd("preformatted",{content:"text*",marks:"",group:"block",code:!0,toDOM:function(){return["pre",{class:"code"},0]}})).get("code_block");v.attrs={class:{default:"code"},"data-filename":{default:null},"data-language":{default:null}},v.toDOM=function(t){return["pre",t.attrs,0]};var g=(u=(u=(u=(u=(u=(u=(u=u.update("code_block",v)).addToEnd("file_block",{content:"text*",marks:"",group:"block",attrs:{class:{default:"code file"},"data-filename":{default:null},"data-language":{default:null}},code:!0,defining:!0,toDOM:function(t){return["pre",t.attrs,0]}})).addToEnd("html_block",{content:"text*",marks:"",group:"block",attrs:{class:{default:"html_block"}},code:!0,defining:!0,toDOM:function(t){return["pre",t.attrs,0]}})).addToEnd("html_inline",{content:"text*",marks:"",group:"inline",attrs:{class:{default:"html_inline"}},inline:!0,code:!0,defining:!0,toDOM:function(t){return["code",t.attrs,0]}})).addToEnd("php_block",{content:"text*",marks:"",group:"block",attrs:{class:{default:"php_block"}},code:!0,defining:!0,toDOM:function(t){return["pre",t.attrs,0]}})).addToEnd("php_inline",{content:"text*",marks:"",group:"inline",attrs:{class:{default:"php_inline"}},inline:!0,code:!0,defining:!0,toDOM:function(t){return["code",t.attrs,0]}})).addToEnd("quote",{content:"block",group:"block",inline:!1,toDOM:function(){return["blockquote",{},["div",{class:"no"},0]]}})).get("image");g.attrs.width={default:""},g.attrs.height={default:""},g.attrs.align={default:""},g.attrs.linking={default:""},g.attrs.cache={default:""},g.attrs["data-resolvedHtml"]={default:""},g.attrs.id={},delete g.attrs.src,u=u.update("image",g);var y={};Object.keys(g.attrs).forEach(function(t){y["image-"+t]={default:null}}),u=(u=(u=(u=u.addToEnd("link",{group:"inline",inline:!0,attrs:r({"data-type":{},"data-inner":{},"data-name":{default:null},"data-resolvedID":{default:null},"data-resolvedUrl":{default:null},"data-resolvedName":{default:null},"data-resolvedClass":{default:null},"data-resolvedTitle":{default:null},"data-resolvedImage":{default:""}},y),toDOM:function(t){return["a",t.attrs]}})).addToEnd("footnote",{content:"inline",group:"inline",inline:!0,toDOM:function(){return["footnote",{class:"footnote"},0]}})).addToEnd("rss",{group:"block",atom:!0,attrs:{class:{default:"rss"},"data-url":{default:null},"data-params":{default:null}},toDOM:function(t){var e=t.attrs["data-url"]||"";return["span",t.attrs,"RSS: "+e]}})).addToEnd("dwplugin",{content:"text*",marks:"_",attrs:{class:{default:"dwplugin"},"data-pluginname":{}},draggable:!0,inline:!0,group:"inline",defining:!0,isolating:!0,code:!0,toDOM:function(t){return["code",t.attrs,0]}}),f=(f=(f=(f=(f=(f=f.remove("link")).addToEnd("deleted",{parseDOM:[{tag:"del"},{style:"text-decoration",getAttrs:function(t){return"strikethrough"===t&&null}}],toDOM:function(){return["del"]}})).addToEnd("underline",{parseDOM:[{tag:"u"},{style:"text-decoration",getAttrs:function(t){return"underline"===t&&null}}],toDOM:function(){return["u"]}})).addToEnd("subscript",{parseDOM:[{tag:"sub"},{style:"vertical-align",getAttrs:function(t){return"sub"===t&&null}}],toDOM:function(){return["sub"]}})).addToEnd("superscript",{parseDOM:[{tag:"sup"},{style:"vertical-align",getAttrs:function(t){return"super"===t&&null}}],toDOM:function(){return["sup"]}})).addToEnd("unformatted",{parseDOM:[{tag:"span",class:"unformatted"}],toDOM:function(){return["span",{class:"unformatted"}]}}),e.schema=new p({nodes:u,marks:f})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),o=n(1),i=n(2),a={};if("undefined"!=typeof navigator){var s=/Edge\/(\d+)/.exec(navigator.userAgent),c=/MSIE \d/.test(navigator.userAgent),l=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);a.mac=/Mac/.test(navigator.platform);var p=a.ie=!!(c||l||s);a.ie_version=c?document.documentMode||6:l?+l[1]:s?+s[1]:null,a.gecko=!p&&/gecko\/(\d+)/i.test(navigator.userAgent),a.gecko_version=a.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var h=!p&&/Chrome\/(\d+)/.exec(navigator.userAgent);a.chrome=!!h,a.chrome_version=h&&+h[1],a.ios=!p&&/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),a.webkit=!p&&"WebkitAppearance"in document.documentElement.style,a.safari=/Apple Computer/.test(navigator.vendor)}var u=function(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e},f=function(t){var e=t.parentNode;return e&&11==e.nodeType?e.host:e},d=function(t,e,n){var r=document.createRange();return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},m=function(t,e,n,r){return n&&(g(t,e,n,r,-1)||g(t,e,n,r,1))},v=/^(img|br|input|textarea|hr)$/i;function g(t,e,n,r,o){for(;;){if(t==n&&e==r)return!0;if(e==(o<0?0:y(t))||3==t.nodeType&&"\ufeff"==t.nodeValue){var i=t.parentNode;if(1!=i.nodeType||(void 0,(a=t.pmViewDesc)&&a.node&&a.node.isBlock)||v.test(t.nodeName))return!1;e=u(t)+(o<0?0:1),t=i}else{if(1!=t.nodeType)return!1;t=t.childNodes[e+(o<0?-1:0)],e=o<0?y(t):0}}var a}function y(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}var w=function(t){var e=t.isCollapsed;return e&&a.chrome&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function b(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function k(t,e){var n=t.someProp("scrollThreshold")||0,r=t.someProp("scrollMargin"),o=t.dom.ownerDocument,i=o.defaultView;null==r&&(r=5);for(var a=t.dom;a;a=f(a)){var s=a==o.body,c=s?b(i):a.getBoundingClientRect(),l=0,p=0;if(e.top<c.top+n?p=-(c.top-e.top+r):e.bottom>c.bottom-n&&(p=e.bottom-c.bottom+r),e.left<c.left+n?l=-(c.left-e.left+r):e.right>c.right-n&&(l=e.right-c.right+r),(l||p)&&(s?i.scrollBy(l,p):(p&&(a.scrollTop+=p),l&&(a.scrollLeft+=l))),s)break}}function S(t,e){for(var n,r,o=2e8,i=0,a=e.top,s=e.top,c=t.firstChild,l=0;c;c=c.nextSibling,l++){var p=void 0;if(1==c.nodeType)p=c.getClientRects();else{if(3!=c.nodeType)continue;p=d(c).getClientRects()}for(var h=0;h<p.length;h++){var u=p[h];if(u.top<=a&&u.bottom>=s){a=Math.max(u.bottom,a),s=Math.min(u.top,s);var f=u.left>e.left?u.left-e.left:u.right<e.left?e.left-u.right:0;if(f<o){n=c,o=f,r=f&&3==n.nodeType?{left:u.right<e.left?u.right:u.left,top:e.top}:e,1==c.nodeType&&f&&(i=l+(e.left>=(u.left+u.right)/2?1:0));continue}}!n&&(e.left>=u.right&&e.top>=u.top||e.left>=u.left&&e.top>=u.bottom)&&(i=l+1)}}return n&&3==n.nodeType?function(t,e){for(var n=t.nodeValue.length,r=document.createRange(),o=0;o<n;o++){r.setEnd(t,o+1),r.setStart(t,o);var i=C(r,1);if(i.top!=i.bottom&&(i.left-1<=e.left&&i.right+1>=e.left&&i.top-1<=e.top&&i.bottom+1>=e.top))return{node:t,offset:o+(e.left>=(i.left+i.right)/2?1:0)}}return{node:t,offset:0}}(n,r):!n||o&&1==n.nodeType?{node:t,offset:i}:S(n,r)}function x(t,e){var n,r,o=t.root;if(o.caretPositionFromPoint){var i,a=o.caretPositionFromPoint(e.left,e.top);if(a)n=(i=a).offsetNode,r=i.offset}if(!n&&o.caretRangeFromPoint){var s,c=o.caretRangeFromPoint(e.left,e.top);if(c)n=(s=c).startContainer,r=s.startOffset}var l,p=o.elementFromPoint(e.left,e.top+1);if(!p)return null;if(p=function(t,e){var n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}(p,e),n&&(n==t.dom&&r==n.childNodes.length-1&&1==n.lastChild.nodeType&&e.top>n.lastChild.getBoundingClientRect().bottom?l=t.state.doc.content.size:0!=r&&1==n.nodeType&&"BR"==n.childNodes[r-1].nodeName||(l=function(t,e,n,r){for(var o=-1,i=e;i!=t.dom;){var a=t.docView.nearestDesc(i,!0);if(!a)return null;if(a.node.isBlock&&a.parent){var s=a.dom.getBoundingClientRect();if(s.left>r.left||s.top>r.top)o=a.posBefore;else{if(!(s.right<r.left||s.bottom<r.top))break;o=a.posAfter}}i=a.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n)}(t,n,r,e))),null==l&&null==(l=function(t,e,n){if(!t.dom.contains(1!=e.nodeType?e.parentNode:e))return null;var r=S(e,n),o=r.node,i=r.offset,a=-1;if(1==o.nodeType&&!o.firstChild){var s=o.getBoundingClientRect();a=s.left!=s.right&&n.left>(s.left+s.right)/2?1:-1}return t.docView.posFromDOM(o,i,a)}(t,p,e)))return null;var h=t.docView.nearestDesc(p,!0);return{pos:l,inside:h?h.posAtStart-h.border:-1}}function C(t,e){var n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}function M(t,e){var n,r,o=t.docView.domFromPos(e),i=o.node,a=o.offset;if(3==i.nodeType)a<i.nodeValue.length&&(r=C(d(i,a,a+1),-1),n="left"),r&&r.left!=r.right||!a||(r=C(d(i,a-1,a),1),n="right");else if(i.firstChild){if(a<i.childNodes.length){var s=i.childNodes[a];r=C(3==s.nodeType?d(s):s,-1),n="left"}if((!r||r.top==r.bottom)&&a){var c=i.childNodes[a-1];r=C(3==c.nodeType?d(c):c,1),n="right"}}else r=i.getBoundingClientRect(),n="left";var l=r[n];return{top:r.top,bottom:r.bottom,left:l,right:l}}function O(t,e,n){var r=t.state,o=t.root.activeElement;r==e&&t.inDOMChange||t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),o!=t.dom&&o.focus()}}var T=/[\u0590-\u08ac]/;var D=null,N=null,A=!1;function E(t,e,n){return D==e&&N==n?A:(D=e,N=n,A="up"==n||"down"==n?function(t,e,n){var r=e.selection,o="up"==n?r.$anchor.min(r.$head):r.$anchor.max(r.$head);return!!o.depth&&O(t,e,function(){for(var e=t.docView.domAfterPos(o.before()),r=M(t,o.pos),i=e.firstChild;i;i=i.nextSibling){var a=void 0;if(1==i.nodeType)a=i.getClientRects();else{if(3!=i.nodeType)continue;a=d(i,0,i.nodeValue.length).getClientRects()}for(var s=0;s<a.length;s++){var c=a[s];if(c.bottom>c.top&&("up"==n?c.bottom<r.top+1:c.top>r.bottom-1))return!1}}return!0})}(t,e,n):function(t,e,n){var r=e.selection.$head;if(!r.parent.isTextblock||!r.depth)return!1;var o=r.parentOffset,i=!o,a=o==r.parent.content.size,s=getSelection();return T.test(r.parent.textContent)&&s.modify?O(t,e,function(){var e=s.getRangeAt(0),o=s.focusNode,i=s.focusOffset;s.modify("move",n,"character");var a=!t.docView.domAfterPos(r.before()).contains(1==s.focusNode.nodeType?s.focusNode:s.focusNode.parentNode)||o==s.focusNode&&i==s.focusOffset;return s.removeAllRanges(),s.addRange(e),a}):"left"==n||"backward"==n?i:a}(t,e,n))}var R=function(t,e,n,r){this.parent=t,this.children=e,this.dom=n,n.pmViewDesc=this,this.contentDOM=r,this.dirty=0},F={beforePosition:{},size:{},border:{},posBefore:{},posAtStart:{},posAfter:{},posAtEnd:{},contentLost:{}};R.prototype.matchesWidget=function(){return!1},R.prototype.matchesMark=function(){return!1},R.prototype.matchesNode=function(){return!1},R.prototype.matchesHack=function(){return!1},F.beforePosition.get=function(){return!1},R.prototype.parseRule=function(){return null},R.prototype.stopEvent=function(){return!1},F.size.get=function(){for(var t=0,e=0;e<this.children.length;e++)t+=this.children[e].size;return t},F.border.get=function(){return 0},R.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var t=0;t<this.children.length;t++)this.children[t].destroy()},R.prototype.posBeforeChild=function(t){for(var e=0,n=this.posAtStart;e<this.children.length;e++){var r=this.children[e];if(r==t)return n;n+=r.size}},F.posBefore.get=function(){return this.parent.posBeforeChild(this)},F.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0},F.posAfter.get=function(){return this.posBefore+this.size},F.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border},R.prototype.localPosFromDOM=function(t,e,n){var r;if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){var o,i;if(t==this.contentDOM)o=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.previousSibling}for(;o&&(!(i=o.pmViewDesc)||i.parent!=this);)o=o.previousSibling;return o?this.posBeforeChild(i)+i.size:this.posAtStart}var a,s;if(t==this.contentDOM)a=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;a=t.nextSibling}for(;a&&(!(s=a.pmViewDesc)||s.parent!=this);)a=a.nextSibling;return a?this.posBeforeChild(s):this.posAtEnd}if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(var c=t;;c=c.parentNode){if(c==this.dom){r=!1;break}if(c.parentNode.firstChild!=c)break}if(null==r&&e==t.childNodes.length)for(var l=t;;l=l.parentNode){if(l==this.dom){r=!0;break}if(l.parentNode.lastChild!=l)break}}return(null==r?n>0:r)?this.posAtEnd:this.posAtStart},R.prototype.nearestDesc=function(t,e){for(var n=!0,r=t;r;r=r.parentNode){var o=this.getDesc(r);if(o&&(!e||o.node)){if(!n||!o.nodeDOM||(1==o.nodeDOM.nodeType?o.nodeDOM.contains(t):o.nodeDOM==t))return o;n=!1}}},R.prototype.getDesc=function(t){for(var e=t.pmViewDesc,n=e;n;n=n.parent)if(n==this)return e},R.prototype.posFromDOM=function(t,e,n){for(var r=t;;r=r.parentNode){var o=this.getDesc(r);if(o)return o.localPosFromDOM(t,e,n)}},R.prototype.descAt=function(t){for(var e=0,n=0;e<this.children.length;e++){var r=this.children[e],o=n+r.size;if(n==t&&o!=n){for(;!r.border&&r.children.length;)r=r.children[0];return r}if(t<o)return r.descAt(t-n-r.border);n=o}},R.prototype.domFromPos=function(t){if(!this.contentDOM)return{node:this.dom,offset:0};for(var e=0,n=0;;n++){if(e==t){for(;n<this.children.length&&this.children[n].beforePosition;)n++;return{node:this.contentDOM,offset:n}}if(n==this.children.length)throw new Error("Invalid position "+t);var r=this.children[n],o=e+r.size;if(t<o)return r.domFromPos(t-e-r.border);e=o}},R.prototype.parseRange=function(t,e,n){if(void 0===n&&(n=0),0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var r=-1,o=-1,i=0,a=0;;a++){var s=this.children[a],c=i+s.size;if(-1==r&&t<=c){var l=i+s.border;if(t>=l&&e<=c-s.border&&s.node&&s.contentDOM&&this.contentDOM.contains(s.contentDOM))return s.parseRange(t-l,e-l,n+l);t=n+i;for(var p=a;p>0;p--){var h=this.children[p-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){r=u(h.dom)+1;break}t-=h.size}-1==r&&(r=0)}if(r>-1&&e<=c){e=n+c;for(var f=a+1;f<this.children.length;f++){var d=this.children[f];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){o=u(d.dom);break}e+=d.size}-1==o&&(o=this.contentDOM.childNodes.length);break}i=c}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:o}},R.prototype.emptyChildAt=function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)},R.prototype.domAfterPos=function(t){var e=this.domFromPos(t),n=e.node,r=e.offset;if(1!=n.nodeType||r==n.childNodes.length)throw new RangeError("No node after pos "+t);return n.childNodes[r]},R.prototype.setSelection=function(t,e,n){for(var r=Math.min(t,e),o=Math.max(t,e),i=0,a=0;i<this.children.length;i++){var s=this.children[i],c=a+s.size;if(r>a&&o<c)return s.setSelection(t-a-s.border,e-a-s.border,n);a=c}var l=this.domFromPos(t),p=this.domFromPos(e),h=n.getSelection(),u=document.createRange();if(!m(l.node,l.offset,h.anchorNode,h.anchorOffset)||!m(p.node,p.offset,h.focusNode,h.focusOffset)){if(h.extend)u.setEnd(l.node,l.offset),u.collapse(!1);else{if(t>e){var f=l;l=p,p=f}u.setEnd(p.node,p.offset),u.setStart(l.node,l.offset)}h.removeAllRanges(),h.addRange(u),h.extend&&h.extend(p.node,p.offset)}},R.prototype.ignoreMutation=function(t){return!this.contentDOM},F.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)},R.prototype.markDirty=function(t,e){for(var n=0,r=0;r<this.children.length;r++){var o=this.children[r],i=n+o.size;if(n==i?t<=i&&e>=n:t<i&&e>n){var a=n+o.border,s=i-o.border;if(t>=a&&e<=s)return this.dirty=t==n||e==i?2:1,void(t==a&&e==s&&o.contentLost?o.dirty=3:o.markDirty(t-a,e-a));o.dirty=3}n=i}this.dirty=2},Object.defineProperties(R.prototype,F);var $=[],P=function(t){function e(e,n,r,o){var i,a=n.type.toDOM;if("function"==typeof a&&(a=a(r,function(){return i?i.parent?i.parent.posBeforeChild(i):void 0:o})),!n.type.spec.raw){if(1!=a.nodeType){var s=document.createElement("span");s.appendChild(a),a=s}a.contentEditable=!1,a.classList.add("ProseMirror-widget")}t.call(this,e,$,a,null),this.widget=n,i=this}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={beforePosition:{}};return n.beforePosition.get=function(){return this.widget.type.side<0},e.prototype.matchesWidget=function(t){return 0==this.dirty&&t.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(t){var e=this.widget.spec.stopEvent;return!!e&&e(t)},Object.defineProperties(e.prototype,n),e}(R),z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parseRule=function(){for(var e,n=this.dom.firstChild;n;n=n.nextSibling){var r=void 0;if(3==n.nodeType){var o=n.nodeValue.replace(/\ufeff/g,"");if(!o)continue;r=document.createTextNode(o)}else{if("\ufeff"==n.textContent)continue;r=n.cloneNode(!0)}e||(e=document.createDocumentFragment()),e.appendChild(r)}return e?{skip:e}:t.prototype.parseRule.call(this)},e.prototype.ignoreMutation=function(){return!1},e}(P),I=function(t){function e(e,n,r,o){t.call(this,e,[],r,o),this.mark=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.create=function(t,n,o,i){var a=et(i)[n.type.name],s=a&&a(n,i);return s&&s.dom||(s=r.DOMSerializer.renderSpec(document,n.type.spec.toDOM(n,o))),new e(t,n,s.dom,s.contentDOM||s.dom)},e.prototype.parseRule=function(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(t){return 3!=this.dirty&&this.mark.eq(t)},e.prototype.markDirty=function(e,n){if(t.prototype.markDirty.call(this,e,n),0!=this.dirty){for(var r=this.parent;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=0}},e}(R),_=function(t){function e(e,n,r,o,i,a,s,c,l){t.call(this,e,n.isLeaf?$:[],i,a),this.nodeDOM=s,this.node=n,this.outerDeco=r,this.innerDeco=o,a&&this.updateChildren(c,l)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={size:{},border:{}};return e.create=function(t,n,o,i,a,s){var c,l=et(a)[n.type.name],p=l&&l(n,a,function(){return c?c.parent?c.parent.posBeforeChild(c):void 0:s},o),h=p&&p.dom,u=p&&p.contentDOM;if(n.isText)if(h){if(3!=h.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else h=document.createTextNode(n.text);else if(!h){var f;h=(f=r.DOMSerializer.renderSpec(document,n.type.spec.toDOM(n))).dom,u=f.contentDOM}u||n.isText||"BR"==h.nodeName||(h.contentEditable=!1,n.type.spec.draggable&&(h.draggable=!0));var d=h;return h=U(h,o,n),p?c=new V(t,n,o,i,h,u,d,p,a):n.isText?new B(t,n,o,i,h,d,a):new e(t,n,o,i,h,u,d,a,s+1)},e.prototype.parseRule=function(){var t=this;return this.contentDOM&&!this.contentLost?{node:this.node.type.name,attrs:this.node.attrs,contentElement:this.contentDOM}:{node:this.node.type.name,attrs:this.node.attrs,getContent:function(){return t.contentDOM?r.Fragment.empty:t.node.content}}},e.prototype.matchesNode=function(t,e,n){return 0==this.dirty&&t.eq(this.node)&&Q(e,this.outerDeco)&&n.eq(this.innerDeco)},n.size.get=function(){return this.node.nodeSize},n.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(t,e){var n=this,o=new Z(this),i=this.node.inlineContent;!function(t,e,n,r){var o=e.locals(t),i=0;if(0==o.length){for(var a=0;a<t.childCount;a++){var s=t.child(a);r(s,o,e.forChild(i,s),a),i+=s.nodeSize}return}for(var c=0,l=[],p=null,h=0;;){if(c<o.length&&o[c].to==i){for(var u=o[c++],f=void 0;c<o.length&&o[c].to==i;)(f||(f=[u])).push(o[c++]);if(f){f.sort(tt);for(var d=0;d<f.length;d++)n(f[d],h)}else n(u,h)}var m=void 0;if(p)m=p,p=null;else{if(!(h<t.childCount))break;m=t.child(h++)}for(var v=0;v<l.length;v++)l[v].to<=i&&l.splice(v--,1);for(;c<o.length&&o[c].from==i;)l.push(o[c++]);var g=i+m.nodeSize;if(m.isText){var y=g;c<o.length&&o[c].from<y&&(y=o[c].from);for(var w=0;w<l.length;w++)l[w].to<y&&(y=l[w].to);y<g&&(p=m.cut(y-i),m=m.cut(0,y-i),g=y)}r(m,l.length?l.slice():$,e.forChild(i,m),h-1),i=g}}(this.node,this.innerDeco,function(a,s){a.spec.marks?o.syncToMarks(a.spec.marks,i,t):a.type.side>=0&&o.syncToMarks(s==n.node.childCount?r.Mark.none:n.node.child(s).marks,i,t),o.placeWidget(a,t,e)},function(n,r,a,s){o.syncToMarks(n.marks,i,t),o.findNodeMatch(n,r,a,s)||o.updateNextNode(n,r,a,t,s)||o.addNode(n,r,a,t,e),e+=n.nodeSize}),o.syncToMarks($,i,t),this.node.isTextblock&&o.addTextblockHacks(),o.destroyRest(),(o.changed||2==this.dirty)&&this.renderChildren()},e.prototype.renderChildren=function(){!function t(e,n){var r=e.firstChild;for(var o=0;o<n.length;o++){var i=n[o],a=i.dom;if(a.parentNode==e){for(;a!=r;)r=X(r);r=r.nextSibling}else e.insertBefore(a,r);if(i instanceof I){var s=r?r.previousSibling:e.lastChild;t(i.contentDOM,i.children),r=s?s.nextSibling:e.firstChild}}for(;r;)r=X(r)}(this.contentDOM,this.children,e.is),a.ios&&function(t){if("UL"==t.nodeName||"OL"==t.nodeName){var e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}(this.dom)},e.prototype.update=function(t,e,n,r){return!(3==this.dirty||!t.sameMarkup(this.node))&&(this.updateInner(t,e,n,r),!0)},e.prototype.updateInner=function(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=0},e.prototype.updateOuterDeco=function(t){if(!Q(t,this.outerDeco)){var e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=H(this.dom,this.nodeDOM,q(this.outerDeco,this.node,e),q(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=t}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode")},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode")},Object.defineProperties(e.prototype,n),e}(R);function j(t,e,n,r,o){return U(r,e,t),new _(null,t,e,n,r,r,r,o,0)}var B=function(t){function e(e,n,r,o,i,a,s){t.call(this,e,n,r,o,i,null,a,s)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parseRule=function(){var t=this.nodeDOM.parentNode;return t?{skip:t}:{ignore:!0}},e.prototype.update=function(t,e){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!t.sameMarkup(this.node))&&(this.updateOuterDeco(e),0==this.dirty&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text),this.node=t,this.dirty=0,!0)},e.prototype.inParent=function(){for(var t=this.parent.contentDOM,e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1},e.prototype.domFromPos=function(t){return{node:this.nodeDOM,offset:t}},e.prototype.localPosFromDOM=function(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):t.prototype.localPosFromDOM.call(this,e,n,r)},e.prototype.ignoreMutation=function(t){return"characterData"!=t.type},e}(_),L=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(){return 0==this.dirty},e}(R),V=function(t){function e(e,n,r,o,i,a,s,c,l){t.call(this,e,n,r,o,i,a,s,l),this.spec=c}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e,n,r,o){if(3==this.dirty)return!1;if(this.spec.update){var i=this.spec.update(e,n);return i&&this.updateInner(e,n,r,o),i}return!(!this.contentDOM&&!e.isLeaf)&&t.prototype.update.call(this,e,n,r,o)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():t.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():t.prototype.deselectNode.call(this)},e.prototype.setSelection=function(e,n,r){this.spec.setSelection?this.spec.setSelection(e,n,r):t.prototype.setSelection.call(this,e,n,r)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),t.prototype.destroy.call(this)},e.prototype.stopEvent=function(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)},e.prototype.ignoreMutation=function(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):t.prototype.ignoreMutation.call(this,e)},e}(_);function J(t){t&&(this.nodeName=t)}J.prototype=Object.create(null);var W=[new J];function q(t,e,n){if(0==t.length)return W;for(var r=n?W[0]:new J,o=[r],i=0;i<t.length;i++){var a=t[i].type.attrs,s=r;if(a)for(var c in a.nodeName&&o.push(s=new J(a.nodeName)),a){var l=a[c];null!=l&&(n&&1==o.length&&o.push(s=r=new J(e.isInline?"span":"div")),"class"==c?s.class=(s.class?s.class+" ":"")+l:"style"==c?s.style=(s.style?s.style+";":"")+l:"nodeName"!=c&&(s[c]=l))}}return o}function H(t,e,n,r){if(n==W&&r==W)return e;for(var o=e,i=0;i<r.length;i++){var a=r[i],s=n[i];if(i){var c=void 0;s&&s.nodeName==a.nodeName&&o!=t&&(c=e.parentNode)&&c.tagName.toLowerCase()==a.nodeName?o=c:((c=document.createElement(a.nodeName)).appendChild(o),o=c)}K(o,s||W[0],a)}return o}function K(t,e,n){for(var r in e)"class"==r||"style"==r||"nodeName"==r||r in n||t.removeAttribute(r);for(var o in n)"class"!=o&&"style"!=o&&"nodeName"!=o&&n[o]!=e[o]&&t.setAttribute(o,n[o]);if(e.class!=n.class){for(var i=e.class?e.class.split(" "):$,a=n.class?n.class.split(" "):$,s=0;s<i.length;s++)-1==a.indexOf(i[s])&&t.classList.remove(i[s]);for(var c=0;c<a.length;c++)-1==i.indexOf(a[c])&&t.classList.add(a[c])}if(e.style!=n.style){if(e.style)for(var l,p=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;l=p.exec(e.style);)t.style[l[1].toLowerCase()]="";n.style&&(t.style.cssText+=n.style)}}function U(t,e,n){return H(t,t,W,q(e,n,1!=t.nodeType))}function Q(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function X(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}var G,Y,Z=function(t){this.top=t,this.index=0,this.stack=[],this.changed=!1,this.preMatched=function(t,e){for(var n=[],r=t.childCount,o=e.length-1;r>0&&o>=0;o--){var i=e[o],a=i.node;if(a){if(a!=t.child(r-1))break;n[--r]=i}}return n}(t.node.content,t.children)};function tt(t,e){return t.type.side-e.type.side}function et(t){return Y==t._props?G:(Y=t._props,G=function(t){var e={};return t.someProp("nodeViews",function(t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])}),e}(t))}function nt(t,e){var n=t.selection,r=n.$anchor,i=n.$head,a=e>0?r.max(i):r.min(i),s=a.parent.inlineContent?a.depth?t.doc.resolve(e>0?a.after():a.before()):null:a;return s&&o.Selection.findFrom(s,e)}function rt(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function ot(t,e){var n=t.state.selection;if(n instanceof o.TextSelection){if(n.empty){if(t.endOfTextblock(e>0?"right":"left")){var r=nt(t.state,e);return!!(r&&r instanceof o.NodeSelection)&&rt(t,r)}var i,a=n.$head,s=a.textOffset?null:e<0?a.nodeBefore:a.nodeAfter;if(s&&o.NodeSelection.isSelectable(s)){var c=e<0?a.pos-s.nodeSize:a.pos;if(s.isAtom||(i=t.docView.descAt(c))&&!i.contentDOM)return rt(t,new o.NodeSelection(e<0?t.state.doc.resolve(a.pos-s.nodeSize):a))}return!1}return!1}if(n instanceof o.NodeSelection&&n.node.isInline)return rt(t,new o.TextSelection(e>0?n.$to:n.$from));var l=nt(t.state,e);return!!l&&rt(t,l)}function it(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function at(t){var e=t.pmViewDesc;return e&&0==e.size&&(t.nextSibling||"BR"!=t.nodeName)}function st(t){var e=t.root.getSelection(),n=e.anchorNode,r=e.anchorOffset;if(n){for(var o,i;;)if(r>0)if(1!=n.nodeType){if(3!=n.nodeType||"\ufeff"!=n.nodeValue.charAt(r-1))break;o=n,i=--r}else{var a=n.childNodes[r-1];if(at(a))o=n,i=--r;else{if(3!=a.nodeType)break;r=(n=a).nodeValue.length}}else{if(lt(n))break;for(var s=n.previousSibling;s&&at(s);)o=n.parentNode,i=u(s),s=s.previousSibling;if(s)r=it(n=s);else{if((n=n.parentNode)==t.dom)break;r=0}}o&&pt(t,e,o,i)}}function ct(t){var e=t.root.getSelection(),n=e.anchorNode,r=e.anchorOffset;if(n){for(var o,i,a=it(n);;)if(r<a){if(1!=n.nodeType)break;if(!at(n.childNodes[r]))break;o=n,i=++r}else{if(lt(n))break;for(var s=n.nextSibling;s&&at(s);)o=s.parentNode,i=u(s)+1,s=s.nextSibling;if(s)r=0,a=it(n=s);else{if((n=n.parentNode)==t.dom)break;r=a=0}}o&&pt(t,e,o,i)}}function lt(t){var e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function pt(t,e,n,r){var o=document.createRange();o.setEnd(n,r),o.setStart(n,r),e.removeAllRanges(),e.addRange(o),t.selectionReader.storeDOMState(t.selection)}function ht(t,e){var n=t.state.selection;if(n instanceof o.TextSelection&&!n.empty)return!1;var r=n.$from,i=n.$to;if(!r.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){var a=nt(t.state,e);if(a&&a instanceof o.NodeSelection)return rt(t,a)}if(!r.parent.inlineContent){var s=o.Selection.findFrom(e<0?r:i,e);return!s||rt(t,s)}return!1}function ut(t,e){if(!(t.state.selection instanceof o.TextSelection))return!0;var n=t.state.selection,r=n.$head,i=n.$anchor,a=n.empty;if(!r.sameParent(i))return!0;if(!a)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;var s=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){var c=t.state.tr;return e<0?c.delete(r.pos-s.nodeSize,r.pos):c.delete(r.pos,r.pos+s.nodeSize),t.dispatch(c),!0}return!1}Z.prototype.destroyBetween=function(t,e){if(t!=e){for(var n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}},Z.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)},Z.prototype.syncToMarks=function(t,e,n){for(var r,o=0,i=this.stack.length>>1,a=Math.min(i,t.length);o<a&&(o==i-1?this.top:this.stack[o+1<<1]).matchesMark(t[o]);)o++;for(;o<i;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<t.length;){if(this.stack.push(this.top,this.index+1),this.index<this.top.children.length&&(r=this.top.children[this.index]).matchesMark(t[i]))this.top=r;else{var s=I.create(this.top,t[i],e,n);this.top.children.splice(this.index,0,s),this.top=s,this.changed=!0}this.index=0,i++}},Z.prototype.findNodeMatch=function(t,e,n,r){for(var o=this.index,i=this.top.children,a=Math.min(i.length,o+5);o<a;o++){var s=i[o],c=void 0;if(s.matchesNode(t,e,n)&&(-1==(c=this.preMatched.indexOf(s))||c==r))return this.destroyBetween(this.index,o),this.index++,!0}return!1},Z.prototype.updateNextNode=function(t,e,n,r,o){if(this.index==this.top.children.length)return!1;var i=this.top.children[this.index];if(i instanceof _){var a=this.preMatched.indexOf(i);if(a>-1&&a!=o)return!1;var s=i.dom;if(i.update(t,e,n,r))return i.dom!=s&&(this.changed=!0),this.index++,!0}return!1},Z.prototype.addNode=function(t,e,n,r,o){this.top.children.splice(this.index++,0,_.create(this.top,t,e,n,r,o)),this.changed=!0},Z.prototype.placeWidget=function(t,e,n){if(this.index<this.top.children.length&&this.top.children[this.index].matchesWidget(t))this.index++;else{var r=new(t.spec.isCursorWrapper?z:P)(this.top,t,e,n);this.top.children.splice(this.index++,0,r),this.changed=!0}},Z.prototype.addTextblockHacks=function(){for(var t=this.top.children[this.index-1];t instanceof I;)t=t.children[t.children.length-1];if(!t||!(t instanceof B)||/\n$/.test(t.node.text))if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack())this.index++;else{var e=document.createElement("br");this.top.children.splice(this.index++,0,new L(this.top,$,e,null)),this.changed=!0}};var ft=function(t,e,n){this.prev=t,this.mapping=e,this.state=n},dt=function(t){this.seen=[new ft(null,null,t)],o.EditorState.addApplyListener(this.track=this.track.bind(this))};dt.prototype.destroy=function(){o.EditorState.removeApplyListener(this.track)},dt.prototype.find=function(t){for(var e=this.seen.length-1;e>=0;e--){var n=this.seen[e];if(n.state==t)return n}},dt.prototype.track=function(t,e,n){var r=this.seen.length<200?this.find(t):null;r&&this.seen.push(new ft(r,e.docChanged?e.mapping:null,n))},dt.prototype.getMapping=function(t,e){var n=this.find(t);if(!n)return null;for(var r=[],o=n;o;o=o.prev)o.mapping&&r.push(o.mapping);for(var a=e||new i.Mapping,s=r.length-1;s>=0;s--)a.appendMapping(r[s]);return a};var mt=function(t){var e=this;this.view=t,this.lastAnchorNode=this.lastHeadNode=this.lastAnchorOffset=this.lastHeadOffset=null,this.lastSelection=t.state.selection,this.ignoreUpdates=!1,this.poller=new("onselectionchange"in document?vt:gt)(this),t.dom.addEventListener("focus",function(){return e.poller.start(xt(e.view))}),t.dom.addEventListener("blur",function(){return e.poller.stop()}),t.editable||this.poller.start(!1)};mt.prototype.destroy=function(){this.poller.stop()},mt.prototype.poll=function(t){this.poller.poll(t)},mt.prototype.editableChanged=function(){this.view.editable?xt(this.view)||this.poller.stop():this.poller.start()},mt.prototype.domChanged=function(){var t=this.view.root.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastHeadNode||t.focusOffset!=this.lastHeadOffset},mt.prototype.storeDOMState=function(t){var e=this.view.root.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastHeadNode=e.focusNode,this.lastHeadOffset=e.focusOffset,this.lastSelection=t},mt.prototype.clearDOMState=function(){this.lastAnchorNode=this.lastSelection=null},mt.prototype.readFromDOM=function(t){if(!this.ignoreUpdates&&this.domChanged()&&xt(this.view)&&(this.view.inDOMChange||this.view.domObserver.flush(),!this.view.inDOMChange)){var e,n,r=this.view.root.getSelection(),i=this.view.state.doc,a=this.view.docView.nearestDesc(r.focusNode),s=0==a.size,c=this.view.docView.posFromDOM(r.focusNode,r.focusOffset),l=i.resolve(c);if(w(r)){for(e=l;a&&!a.node;)a=a.parent;if(a&&a.node.isAtom&&o.NodeSelection.isSelectable(a.node)&&a.parent){var p=a.posBefore;n=new o.NodeSelection(c==p?l:i.resolve(p))}}else e=i.resolve(this.view.docView.posFromDOM(r.anchorNode,r.anchorOffset));if(!n){var h="pointer"==t||this.view.state.selection.head<l.pos&&!s?1:-1;n=St(this.view,e,l,h)}var u=!s&&c==n.head&&e.pos==n.anchor&&(!this.view.cursorWrapper||r.isCollapsed&&"pointer"!=t);if(u&&this.storeDOMState(n),this.view.state.selection.eq(n))u||yt(this.view);else{var f=this.view.state.tr.setSelection(n);"pointer"==t&&f.setMeta("pointer",!0),this.view.dispatch(f)}}};var vt=function(t){var e=this;this.listening=!1,this.curOrigin=null,this.originTime=0,this.reader=t,this.readFunc=function(){return t.readFromDOM(e.originTime>Date.now()-50?e.curOrigin:null)}};vt.prototype.poll=function(t){this.curOrigin=t,this.originTime=Date.now()},vt.prototype.start=function(t){this.listening||(this.reader.view.dom.ownerDocument.addEventListener("selectionchange",this.readFunc),this.listening=!0,t&&this.readFunc())},vt.prototype.stop=function(){this.listening&&(this.reader.view.dom.ownerDocument.removeEventListener("selectionchange",this.readFunc),this.listening=!1)};var gt=function(t){this.polling=null,this.reader=t,this.pollFunc=this.doPoll.bind(this,null)};function yt(t,e){var n=t.state.selection;if(function(t,e){if(e instanceof o.NodeSelection){var n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(kt(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else kt(t)}(t,n),t.editable&&!t.hasFocus()){if(!e)return;a.gecko&&a.gecko_version<=55&&(t.selectionReader.ignoreUpdates=!0,t.dom.focus(),t.selectionReader.ignoreUpdates=!1)}else if(!t.editable&&!Ct(t)&&!e)return;var r=t.selectionReader;if(!r.lastSelection||!r.lastSelection.eq(n)||r.domChanged()){if(r.ignoreUpdates=!0,t.cursorWrapper)!function(t){var e=t.root.getSelection(),n=document.createRange(),r=t.cursorWrapper.dom;n.setEnd(r,r.childNodes.length),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!t.state.selection.visible&&a.ie&&a.ie_version<=11&&(r.disabled=!0,r.disabled=!1)}(t);else{var i,s,c=n.anchor,l=n.head;!wt||n instanceof o.TextSelection||(n.$from.parent.inlineContent||(i=bt(t,n.from)),n.empty||n.$from.parent.inlineContent||(s=bt(t,n.to))),t.docView.setSelection(c,l,t.root),wt&&(i&&(i.contentEditable="false"),s&&(s.contentEditable="false")),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):c!=l&&(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(t){var e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.hideSelectionGuard);var n=t.root.getSelection(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.hideSelectionGuard=function(){n.anchorNode==r&&n.anchorOffset==o||(e.removeEventListener("selectionchange",t.hideSelectionGuard),t.dom.classList.remove("ProseMirror-hideselection"))})}(t))}r.storeDOMState(n),r.ignoreUpdates=!1}}gt.prototype.doPoll=function(t){var e=this.reader.view;e.focused||!e.editable?(this.reader.readFromDOM(t),this.polling=setTimeout(this.pollFunc,100)):this.polling=null},gt.prototype.poll=function(t){clearTimeout(this.polling),this.polling=setTimeout(t?this.doPoll.bind(this,t):this.pollFunc,0)},gt.prototype.start=function(){null==this.polling&&this.poll()},gt.prototype.stop=function(){clearTimeout(this.polling),this.polling=null};var wt=a.safari||a.chrome&&a.chrome_version<63;function bt(t,e){var n=t.docView.domFromPos(e),r=n.node,o=n.offset,i=o<r.childNodes.length?r.childNodes[o]:null,a=o?r.childNodes[o-1]:null;if(!(i&&"false"!=i.contentEditable||a&&"false"!=a.contentEditable)){if(i)return i.contentEditable="true",i;if(a)return a.contentEditable="true",a}}function kt(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=null)}function St(t,e,n,r){return t.someProp("createSelectionBetween",function(r){return r(t,e,n)})||o.TextSelection.between(e,n,r)}function xt(t){return(!t.editable||t.root.activeElement==t.dom)&&Ct(t)}function Ct(t){var e=t.root.getSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)}catch(t){return!1}}function Mt(t){return!1===t.type.spec.inclusive}function Ot(t){var e=t.selection,n=e.$head,r=e.$anchor,o=e.visible,i=n.pos!=r.pos||o&&!n.parent.inlineContent?null:n;return i&&(!o||t.storedMarks||0==i.parent.content.length||i.parentOffset&&!i.textOffset&&i.nodeBefore.marks.some(Mt))?i:null}var Tt=function t(e,n){var r=this;this.view=e,this.state=e.state,this.composing=n,this.from=this.to=null,this.typeOver=!1,this.timeout=n?null:setTimeout(function(){return r.finish()},t.commitTimeout),this.trackMappings=new dt(e.state),this.mapping=new i.Mapping,this.mappingTo=e.state};function Dt(t,e){for(var n=e||0;n<t.depth;n++)if(t.index(n)+1<t.node(n).childCount)return!1;return t.parentOffset==t.parent.content.size}function Nt(t,e){for(var n=e||0;n<t.depth;n++)if(t.index(0)>0)return!1;return 0==t.parentOffset}function At(t,e){var n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function Et(t,e,n,r){return Math.max(r.anchor,r.head)>e.content.size?null:St(t,e.resolve(n.map(r.anchor)),e.resolve(n.map(r.head)))}function Rt(t,e,n){for(var r=t.depth,o=e?t.end():t.pos;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,o++,e=!1;if(n)for(var i=t.node(r).maybeChild(t.indexAfter(r));i&&!i.isLeaf;)i=i.firstChild,o++;return o}function Ft(t,e){for(var n=[],o=e.content,i=e.openStart,a=e.openEnd;i>1&&a>1&&1==o.childCount&&1==o.firstChild.childCount;){i--,a--;var s=o.firstChild;n.push(s.type.name,s.type.hasRequiredAttrs()?s.attrs:null),o=s.content}var c=t.someProp("clipboardSerializer")||r.DOMSerializer.fromSchema(t.state.schema),l=document.createElement("div");l.appendChild(c.serializeFragment(o));for(var p,h=l.firstChild;h&&1==h.nodeType&&(p=zt[h.nodeName.toLowerCase()]);){for(var u=p.length-1;u>=0;u--){for(var f=document.createElement(p[u]);l.firstChild;)f.appendChild(l.firstChild);l.appendChild(f)}h=l.firstChild}return h&&1==h.nodeType&&h.setAttribute("data-pm-slice",i+" "+a+" "+JSON.stringify(n)),{dom:l,text:t.someProp("clipboardTextSerializer",function(t){return t(e)})||e.content.textBetween(0,e.content.size,"\n\n")}}function $t(t,e,n,o,i){var a,s,c=i.parent.type.spec.code;if(!n&&!e)return null;if((o||c||!n)&&e){if(t.someProp("transformPastedText",function(t){e=t(e)}),c)return new r.Slice(r.Fragment.from(t.state.schema.text(e)),0,0);var l=t.someProp("clipboardTextParser",function(t){return t(e,i)});l?s=l:(a=document.createElement("div"),e.trim().split(/(?:\r\n?|\n)+/).forEach(function(t){a.appendChild(document.createElement("p")).textContent=t}))}else t.someProp("transformPastedHTML",function(t){return n=t(n)}),a=function(t){var e=/(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));var n,r=(It||(It=document.implementation.createHTMLDocument("title"))).createElement("div"),o=/(?:<meta [^>]*>)*<([a-z][^>\s]+)/i.exec(t),i=0;(n=o&&zt[o[1].toLowerCase()])&&(t=n.map(function(t){return"<"+t+">"}).join("")+t+n.map(function(t){return"</"+t+">"}).reverse().join(""),i=n.length);r.innerHTML=t;for(var a=0;a<i;a++)r=r.firstChild;return r}(n);if(!s){var p=t.someProp("clipboardParser")||t.someProp("domParser")||r.DOMParser.fromSchema(t.state.schema);s=p.parseSlice(a,{preserveWhitespace:!0,context:i})}var h=a&&a.querySelector("[data-pm-slice]"),u=h&&/^(\d+) (\d+) (.*)/.exec(h.getAttribute("data-pm-slice"));return s=u?function(t,e){if(!t.size)return t;var n,o=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(e){return t}for(var i=t.content,a=t.openStart,s=t.openEnd,c=n.length-2;c>=0;c-=2){var l=o.nodes[n[c]];if(!l||l.hasRequiredAttrs())break;i=r.Fragment.from(l.create(n[c+1],i)),a++,s++}return new r.Slice(i,a,s)}(new r.Slice(s.content,Math.min(s.openStart,+u[1]),Math.min(s.openEnd,+u[2])),u[3]):r.Slice.maxOpen(function(t,e){if(t.childCount<2)return t;for(var n=function(n){var o=e.node(n),i=o.contentMatchAt(e.index(n)),a=void 0,s=[];if(t.forEach(function(t){if(s){var e,n=i.findWrapping(t.type);if(!n)return s=null;if(e=s.length&&a.length&&function t(e,n,o,i,a){if(a<e.length&&a<n.length&&e[a]==n[a]){var s=t(e,n,o,i.lastChild,a+1);if(s)return i.copy(i.content.replaceChild(i.childCount-1,s));var c=i.contentMatchAt(i.childCount);if(c.matchType(a==e.length-1?o.type:e[a+1]))return i.copy(i.content.append(r.Fragment.from(Pt(o,e,a+1))))}}(n,a,t,s[s.length-1],0))s[s.length-1]=e;else{s.length&&(s[s.length-1]=function t(e,n){if(0==n)return e;var o=e.content.replaceChild(e.childCount-1,t(e.lastChild,n-1));var i=e.contentMatchAt(e.childCount).fillBefore(r.Fragment.empty,!0);return e.copy(o.append(i))}(s[s.length-1],a.length));var o=Pt(t,n);s.push(o),i=i.matchType(o.type,o.attrs),a=n}}}),s)return{v:r.Fragment.from(s)}},o=e.depth;o>=0;o--){var i=n(o);if(i)return i.v}return t}(s.content,i),!1),t.someProp("transformPasted",function(t){s=t(s)}),s}function Pt(t,e,n){void 0===n&&(n=0);for(var o=e.length-1;o>=n;o--)t=e[o].create(null,r.Fragment.from(t));return t}Tt.prototype.addRange=function(t,e){null==this.from?(this.from=t,this.to=e):(this.from=Math.min(t,this.from),this.to=Math.max(e,this.to))},Tt.prototype.changedRange=function(){if(null==this.from)return function(t){var e=t.$anchor.min(t.$head),n=t.$anchor.max(t.$head);if(e.sameParent(n)&&e.parent.inlineContent&&e.parentOffset&&n.parentOffset<n.parent.content.size){var r=Math.max(0,e.parentOffset),o=e.parent.content.size,i=Math.min(o,n.parentOffset);if(r>0&&(r=e.parent.childBefore(r).offset),i<o){var a=e.parent.childAfter(i);i=a.offset+a.node.nodeSize}var s=e.start();return{from:s+r,to:s+i}}for(var c=0;;c++){var l=Nt(e,c+1),p=Dt(n,c+1);if(l||p||e.index(c)!=n.index(c)||n.node(c).isTextblock){var h=e.before(c+1),u=n.after(c+1);return l&&e.index(c)>0&&(h-=e.node(c).child(e.index(c)-1).nodeSize),p&&n.index(c)+1<n.node(c).childCount&&(u+=n.node(c).child(n.index(c)+1).nodeSize),{from:h,to:u}}}}(this.state.selection);var t=this.state.doc.resolve(Math.min(this.from,this.state.selection.from)),e=this.state.doc.resolve(this.to),n=t.sharedDepth(this.to);return{from:t.before(n+1),to:e.after(n+1)}},Tt.prototype.markDirty=function(t){null==this.from?this.view.docView.markDirty((t=t||this.changedRange()).from,t.to):this.view.docView.markDirty(this.from,this.to)},Tt.prototype.stateUpdated=function(t){return this.trackMappings.getMapping(t,this.mapping)?(this.trackMappings.destroy(),this.trackMappings=new dt(t),this.mappingTo=t,!0):(this.markDirty(),this.destroy(),!1)},Tt.prototype.finish=function(t){if(clearTimeout(this.timeout),!this.composing||t){this.view.domObserver.flush();var e=this.changedRange();this.markDirty(e),this.destroy();var n=this.state.selection,i=this.typeOver&&n instanceof o.TextSelection&&!n.empty&&n.$head.sameParent(n.$anchor);!function(t,e,n,i,s){var c,l,p=function(t,e,n){var o=t.docView.parseRange(n.from,n.to),i=o.node,s=o.fromOffset,c=o.toOffset,l=o.from,p=o.to,h=t.root.getSelection(),u=null,f=h.anchorNode;f&&t.dom.contains(1==f.nodeType?f:f.parentNode)&&(u=[{node:f,offset:h.anchorOffset}],w(h)||u.push({node:h.focusNode,offset:h.focusOffset}));var d=e.doc,m=t.someProp("domParser")||r.DOMParser.fromSchema(t.state.schema),v=d.resolve(l),g=null,y=m.parse(i,{topNode:v.parent,topMatch:v.parent.contentMatchAt(v.index()),topOpen:!0,from:s,to:c,preserveWhitespace:!v.parent.type.spec.code||"full",editableContent:!0,findPositions:u,ruleFromNode:function(t,e){return function(n){var r=n.pmViewDesc;if(r)return r.parseRule();if("BR"==n.nodeName&&n.parentNode){if(a.safari&&/^(ul|ol)$/i.test(n.parentNode.nodeName))return t.matchTag(document.createElement("li"),e);if(n.parentNode.lastChild==n)return{ignore:!0}}}}(m,v),context:v});if(u&&null!=u[0].pos){var b=u[0].pos,k=u[1]&&u[1].pos;null==k&&(k=b),g={anchor:b+l,head:k+l}}return{doc:y,sel:g,from:l,to:p}}(t,n,i),h=n.doc,u=h.slice(p.from,p.to);8===t.lastKeyCode&&Date.now()-100<t.lastKeyCodeTime?(c=n.selection.to,l="end"):(c=n.selection.from,l="start");t.lastKeyCode=null;var f=function(t,e,n,r,o){var i=t.findDiffStart(e,n);if(null==i)return null;var a=t.findDiffEnd(e,n+t.size,n+e.size),s=a.a,c=a.b;if("end"==o){var l=Math.max(0,i-Math.min(s,c));r-=s+l-i}if(s<i&&t.size<e.size){var p=r<=i&&r>=s?i-r:0;c=(i-=p)+(c-s),s=i}else if(c<i){var h=r<=i&&r>=c?i-r:0;s=(i-=h)+(s-c),c=i}return{start:i,endA:s,endB:c}}(u.content,p.doc.content,p.from,c,l);if(!f){if(s){var d=t.state,m=d.selection;t.dispatch(d.tr.replaceSelectionWith(d.schema.text(d.doc.textBetween(m.from,m.to)),!0).scrollIntoView())}else if(p.sel){var v=Et(t,t.state.doc,e,p.sel);v&&!v.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(v))}return}var g,y=p.doc.resolveNoCache(f.start-p.from),b=p.doc.resolveNoCache(f.endB-p.from);if(!y.sameParent(b)&&y.pos<p.doc.content.size&&(g=o.Selection.findFrom(p.doc.resolve(y.pos+1),1,!0))&&g.head==b.pos&&t.someProp("handleKeyDown",function(e){return e(t,At(13,"Enter"))}))return;if(n.selection.anchor>f.start&&function(t,e,n,r,o){if(!r.parent.isTextblock||n-e<=o.pos-r.pos||Rt(r,!0,!1)<o.pos)return!1;var i=t.resolve(e);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var a=t.resolve(Rt(i,!0,!0));if(!a.parent.isTextblock||a.pos>n||Rt(a,!0,!1)<n)return!1;return r.parent.content.cut(r.parentOffset).eq(a.parent.content)}(h,f.start,f.endA,y,b)&&t.someProp("handleKeyDown",function(e){return e(t,At(8,"Backspace"))}))return;var k,S,x,C,M=e.map(f.start),O=e.map(f.endA,-1);if(y.sameParent(b)&&y.parent.inlineContent)if(y.pos==b.pos)k=t.state.tr.delete(M,O),S=h.resolve(f.start).marksAcross(h.resolve(f.endA));else if(f.endA==f.endB&&(C=h.resolve(f.start))&&(x=function(t,e){for(var n,o,i,a=t.firstChild.marks,s=e.firstChild.marks,c=a,l=s,p=0;p<s.length;p++)c=s[p].removeFromSet(c);for(var h=0;h<a.length;h++)l=a[h].removeFromSet(l);if(1==c.length&&0==l.length)o=c[0],n="add",i=function(t){return t.mark(o.addToSet(t.marks))};else{if(0!=c.length||1!=l.length)return null;o=l[0],n="remove",i=function(t){return t.mark(o.removeFromSet(t.marks))}}for(var u=[],f=0;f<e.childCount;f++)u.push(i(e.child(f)));if(r.Fragment.from(u).eq(t))return{mark:o,type:n}}(y.parent.content.cut(y.parentOffset,b.parentOffset),C.parent.content.cut(C.parentOffset,f.endA-C.start()))))k=t.state.tr,"add"==x.type?k.addMark(M,O,x.mark):k.removeMark(M,O,x.mark);else if(y.parent.child(y.index()).isText&&y.index()==b.index()-(b.textOffset?0:1)){var T=y.parent.textBetween(y.parentOffset,b.parentOffset);if(t.someProp("handleTextInput",function(e){return e(t,M,O,T)}))return;k=t.state.tr.insertText(T,M,O)}k||(k=t.state.tr.replace(M,O,p.doc.slice(f.start-p.from,f.endB-p.from)));if(p.sel){var D=Et(t,k.doc,e,p.sel);D&&k.setSelection(D)}S&&k.ensureMarks(S);t.dispatch(k.scrollIntoView())}(this.view,this.mapping,this.state,e,i),this.view.docView.dirty&&this.view.updateState(this.view.state)}},Tt.prototype.destroy=function(){clearTimeout(this.timeout),this.trackMappings.destroy(),this.view.inDOMChange=null},Tt.prototype.compositionEnd=function(){var t=this;this.composing&&(this.composing=!1,this.timeout=setTimeout(function(){return t.finish()},50))},Tt.start=function(t,e){return t.inDOMChange?e&&(clearTimeout(t.inDOMChange.timeout),t.inDOMChange.composing=!0):t.inDOMChange=new Tt(t,e),t.inDOMChange},Tt.commitTimeout=20;var zt={thead:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},It=null;var _t={childList:!0,characterData:!0,attributes:!0,subtree:!0,characterDataOldValue:!0},jt=a.ie&&a.ie_version<=11,Bt=function(t){var e=this;this.view=t,this.observer=window.MutationObserver&&new window.MutationObserver(function(t){return e.registerMutations(t)}),jt&&(this.onCharData=function(t){return e.registerMutation({target:t.target,type:"characterData",oldValue:t.prevValue})})};Bt.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,_t),jt&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData)},Bt.prototype.stop=function(){this.observer&&(this.flush(),this.observer.disconnect()),jt&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData)},Bt.prototype.flush=function(){this.observer&&this.registerMutations(this.observer.takeRecords())},Bt.prototype.registerMutations=function(t){for(var e=0;e<t.length;e++)this.registerMutation(t[e])},Bt.prototype.registerMutation=function(t){if(this.view.editable){var e=this.view.docView.nearestDesc(t.target);if(("attributes"!=t.type||e!=this.view.docView&&"contenteditable"!=t.attributeName)&&e&&!e.ignoreMutation(t)){var n,r;if("childList"==t.type){var o=t.previousSibling&&t.previousSibling.parentNode==t.target?u(t.previousSibling)+1:0;if(-1==o)return;n=e.localPosFromDOM(t.target,o,-1);var i=t.nextSibling&&t.nextSibling.parentNode==t.target?u(t.nextSibling):t.target.childNodes.length;if(-1==i)return;r=e.localPosFromDOM(t.target,i,1)}else"attributes"==t.type?(n=e.posAtStart-e.border,r=e.posAtEnd+e.border):(n=e.posAtStart,r=e.posAtEnd,t.target.nodeValue==t.oldValue&&(Tt.start(this.view).typeOver=!0));Tt.start(this.view).addRange(n,r)}}};var Lt={},Vt={};function Jt(t){t.someProp("handleDOMEvents",function(e){for(var n in e)t.eventHandlers[n]||t.dom.addEventListener(n,t.eventHandlers[n]=function(e){return Wt(t,e)})})}function Wt(t,e){return t.someProp("handleDOMEvents",function(n){var r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)})}function qt(t){return{left:t.clientX,top:t.clientY}}Vt.keydown=function(t,e){16==e.keyCode&&(t.shiftKey=!0),t.inDOMChange||(t.lastKeyCode=e.keyCode,t.lastKeyCodeTime=Date.now(),t.someProp("handleKeyDown",function(n){return n(t,e)})||function(t,e){var n=e.keyCode,r=function(t){var e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}(e);return 8==n||a.mac&&72==n&&"c"==r?ut(t,-1)||st(t):46==n||a.mac&&68==n&&"c"==r?ut(t,1)||ct(t):13==n||27==n||(37==n?ot(t,-1)||st(t):39==n?ot(t,1)||ct(t):38==n?ht(t,-1)||st(t):40==n?ht(t,1)||ct(t):r==(a.mac?"m":"c")&&(66==n||73==n||89==n||90==n))}(t,e)?e.preventDefault():t.selectionReader.poll())},Vt.keyup=function(t,e){16==e.keyCode&&(t.shiftKey=!1)},Vt.keypress=function(t,e){if(!(t.inDOMChange||!e.charCode||e.ctrlKey&&!e.altKey||a.mac&&e.metaKey))if(t.someProp("handleKeyPress",function(n){return n(t,e)}))e.preventDefault();else{var n=t.state.selection;if(!(n instanceof o.TextSelection&&n.$from.sameParent(n.$to))){var r=String.fromCharCode(e.charCode);t.someProp("handleTextInput",function(e){return e(t,n.$from.pos,n.$to.pos,r)})||t.dispatch(t.state.tr.insertText(r).scrollIntoView()),e.preventDefault()}}};var Ht={time:0,x:0,y:0},Kt=Ht;function Ut(t,e){var n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function Qt(t,e,n,r,o){if(-1==r)return!1;for(var i=t.state.doc.resolve(r),a=function(r){if(t.someProp(e,function(e){return r>i.depth?e(t,n,i.nodeAfter,i.before(r),o,!0):e(t,n,i.node(r),i.before(r),o,!1)}))return{v:!0}},s=i.depth+1;s>0;s--){var c=a(s);if(c)return c.v}return!1}function Xt(t,e,n){t.focused||t.focus();var r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}function Gt(t,e,n,r,i){return Qt(t,"handleClickOn",e,n,r)||t.someProp("handleClick",function(n){return n(t,e,r)})||(i?function(t,e){if(-1==e)return!1;var n,r,i=t.state.selection;i instanceof o.NodeSelection&&(n=i.node);for(var a=t.state.doc.resolve(e),s=a.depth+1;s>0;s--){var c=s>a.depth?a.nodeAfter:a.node(s);if(o.NodeSelection.isSelectable(c)){r=n&&i.$from.depth>0&&s>=i.$from.depth&&a.before(i.$from.depth+1)==i.$from.pos?a.before(i.$from.depth):a.before(s);break}}return null!=r&&(Xt(t,o.NodeSelection.create(t.state.doc,r),"pointer"),!0)}(t,n):function(t,e){if(-1==e)return!1;var n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&o.NodeSelection.isSelectable(r))&&(Xt(t,new o.NodeSelection(n),"pointer"),!0)}(t,n))}function Yt(t,e,n,r){return Qt(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",function(n){return n(t,e,r)})||function(t,e){var n=t.state.doc;if(-1==e)return!!n.inlineContent&&(Xt(t,o.TextSelection.create(n,0,n.content.size),"pointer"),!0);for(var r=n.resolve(e),i=r.depth+1;i>0;i--){var a=i>r.depth?r.nodeAfter:r.node(i),s=r.before(i);if(a.inlineContent)Xt(t,o.TextSelection.create(n,s+1,s+1+a.content.size),"pointer");else{if(!o.NodeSelection.isSelectable(a))continue;Xt(t,o.NodeSelection.create(n,s),"pointer")}return!0}}(t,n)}function Zt(t){return!!t.inDOMChange&&(t.inDOMChange.finish(!0),!0)}var te=a.mac?"metaKey":"ctrlKey";Lt.mousedown=function(t,e){var n,r=Zt(t),o=Date.now();n=o-Ht.time>=500||!Ut(e,Ht)||e[te]?"singleClick":o-Kt.time>=600||!Ut(e,Kt)?"doubleClick":"tripleClick",Kt=Ht,Ht={time:o,x:e.clientX,y:e.clientY};var i=t.posAtCoords(qt(e));i&&("singleClick"==n?t.mouseDown=new ee(t,i,e,r):("doubleClick"==n?function(t,e,n,r){return Qt(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",function(n){return n(t,e,r)})}:Yt)(t,i.pos,i.inside,e)?e.preventDefault():t.selectionReader.poll("pointer"))};var ee=function(t,e,n,r){var i,s,c=this;if(this.view=t,this.pos=e,this.event=n,this.flushed=r,this.selectNode=n[te],this.allowDefault=n.shiftKey,e.inside>-1)i=t.state.doc.nodeAt(e.inside),s=e.inside;else{var l=t.state.doc.resolve(e.pos);i=l.parent,s=l.depth?l.before():0}this.mightDrag=null,this.target=r?null:n.target,(i.type.spec.draggable&&!1!==i.type.spec.selectable||t.state.selection instanceof o.NodeSelection&&s==t.state.selection.from)&&(this.mightDrag={node:i,pos:s,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&a.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){return c.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),t.selectionReader.poll("pointer")};ee.prototype.done=function(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!1),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.view.mouseDown=null},ee.prototype.up=function(t){this.done(),this.view.dom.contains(3==t.target.nodeType?t.target.parentNode:t.target)&&(this.allowDefault?(a.ie&&Ot(this.view.state)&&this.view.updateState(this.view.state),this.view.selectionReader.poll("pointer")):Gt(this.view,this.pos.pos,this.pos.inside,t,this.selectNode)?t.preventDefault():this.flushed?(Xt(this.view,o.Selection.near(this.view.state.doc.resolve(this.pos.pos)),"pointer"),t.preventDefault()):this.view.selectionReader.poll("pointer"))},ee.prototype.move=function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0),this.view.selectionReader.poll("pointer")},Lt.touchdown=function(t){Zt(t),t.selectionReader.poll("pointer")},Lt.contextmenu=function(t){return Zt(t)},Vt.compositionstart=Vt.compositionupdate=function(t){Tt.start(t,!0)},Vt.compositionend=function(t,e){if(!t.inDOMChange){if(!e.data)return;Tt.start(t,!0)}t.inDOMChange.compositionEnd()},Vt.input=function(t){var e=Tt.start(t);e.composing||e.finish()};var ne=a.ie&&a.ie_version<15||a.ios;function re(t,e,n,r){var o=$t(t,e,n,t.shiftKey,t.state.selection.$from);if(!o)return!1;if(t.someProp("handlePaste",function(e){return e(t,r,o)}))return!0;var i=function(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}(o),a=i?t.state.tr.replaceSelectionWith(i,t.shiftKey):t.state.tr.replaceSelection(o);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Lt.copy=Vt.cut=function(t,e){var n=t.state.selection,r="cut"==e.type;if(!n.empty){var o=ne?null:e.clipboardData,i=Ft(t,n.content()),a=i.dom,s=i.text;o?(e.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",s)):function(t,e){var n=e.ownerDocument,r=n.body.appendChild(n.createElement("div"));r.appendChild(e),r.style.cssText="position: fixed; left: -10000px; top: 10px";var o=getSelection(),i=n.createRange();i.selectNodeContents(e),t.dom.blur(),o.removeAllRanges(),o.addRange(i),setTimeout(function(){n.body.removeChild(r),t.focus()},50)}(t,a),r&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}},Vt.paste=function(t,e){var n=ne?null:e.clipboardData;n&&re(t,n.getData("text/plain"),n.getData("text/html"),e)?e.preventDefault():function(t,e){var n=t.dom.ownerDocument,r=t.shiftKey||t.state.selection.$from.parent.type.spec.code,o=n.body.appendChild(n.createElement(r?"textarea":"div"));r||(o.contentEditable="true"),o.style.cssText="position: fixed; left: -10000px; top: 10px",o.focus(),setTimeout(function(){t.focus(),n.body.removeChild(o),r?re(t,o.value,null,e):re(t,o.textContent,o.innerHTML,e)},50)}(t,e)};var oe=a.mac?"altKey":"ctrlKey";for(var ie in Lt.dragstart=function(t,e){var n=t.mouseDown;if(n&&n.done(),e.dataTransfer){var r=t.state.selection,i=r.empty?null:t.posAtCoords(qt(e));if(i&&i.pos>=r.from&&i.pos<=(r instanceof o.NodeSelection?r.to-1:r.to));else if(n&&n.mightDrag)t.dispatch(t.state.tr.setSelection(o.NodeSelection.create(t.state.doc,n.mightDrag.pos)));else if(e.target&&1==e.target.nodeType){var a=t.docView.nearestDesc(e.target,!0);if(!a||!a.node.type.spec.draggable||a==t.docView)return;t.dispatch(t.state.tr.setSelection(o.NodeSelection.create(t.state.doc,a.posBefore)))}var s=t.state.selection.content(),c=Ft(t,s),l=c.dom,p=c.text;e.dataTransfer.clearData(),e.dataTransfer.setData(ne?"Text":"text/html",l.innerHTML),ne||e.dataTransfer.setData("text/plain",p),t.dragging=new function(t,e){this.slice=t,this.move=e}(s,!e[oe])}},Lt.dragend=function(t){window.setTimeout(function(){return t.dragging=null},50)},Vt.dragover=Vt.dragenter=function(t,e){return e.preventDefault()},Vt.drop=function(t,e){var n=t.dragging;if(t.dragging=null,e.dataTransfer){var r=t.posAtCoords(qt(e));if(r){var i=t.state.doc.resolve(r.pos);if(i){var a=n&&n.slice||$t(t,e.dataTransfer.getData(ne?"Text":"text/plain"),ne?null:e.dataTransfer.getData("text/html"),!1,i);if(a&&(e.preventDefault(),!t.someProp("handleDrop",function(r){return r(t,e,a,n&&n.move)}))){var s=function(t,e){if(!t||!t.content.size)return e.pos;for(var n=t.content,r=0;r<t.openStart;r++)n=n.firstChild.content;for(var o=e.depth;o>=0;o--){var i=o==e.depth?0:e.pos<=(e.start(o+1)+e.end(o+1))/2?-1:1,a=e.index(o)+(i>0?1:0);if(e.node(o).canReplace(a,a,n))return 0==i?e.pos:i<0?e.before(o+1):e.after(o+1)}return e.pos}(a,t.state.doc.resolve(i.pos)),c=t.state.tr;n&&n.move&&c.deleteSelection();var l=c.mapping.map(s),p=0==a.openStart&&0==a.openEnd&&1==a.content.childCount,h=c.doc;if(p?c.replaceRangeWith(l,l,a.content.firstChild):c.replaceRange(l,l,a),!c.doc.eq(h)){var u=c.doc.resolve(l);p&&o.NodeSelection.isSelectable(a.content.firstChild)&&u.nodeAfter&&u.nodeAfter.sameMarkup(a.content.firstChild)?c.setSelection(new o.NodeSelection(u)):c.setSelection(St(t,u,c.doc.resolve(c.mapping.map(s)))),t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))}}}}}},Lt.focus=function(t){t.focused||(t.dom.classList.add("ProseMirror-focused"),t.focused=!0)},Lt.blur=function(t){t.focused&&(t.dom.classList.remove("ProseMirror-focused"),t.focused=!1)},Vt)Lt[ie]=Vt[ie];function ae(t,e){if(t==e)return!0;for(var n in t)if(t[n]!==e[n])return!1;for(var r in e)if(!(r in t))return!1;return!0}var se=function(t,e){this.spec=e||fe,this.side=this.spec.side||0,this.toDOM=t};se.prototype.map=function(t,e,n,r){var o=t.mapResult(e.from+r,this.side<0?-1:1),i=o.pos;return o.deleted?null:new pe(i-n,i-n,this)},se.prototype.valid=function(){return!0},se.prototype.eq=function(t){return this==t||t instanceof se&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&ae(this.spec,t.spec))};var ce=function(t,e){this.spec=e||fe,this.attrs=t};ce.prototype.map=function(t,e,n,r){var o=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,i=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return o>=i?null:new pe(o,i,this)},ce.prototype.valid=function(t,e){return e.from<e.to},ce.prototype.eq=function(t){return this==t||t instanceof ce&&ae(this.attrs,t.attrs)&&ae(this.spec,t.spec)},ce.is=function(t){return t.type instanceof ce};var le=function(t,e){this.spec=e||fe,this.attrs=t};le.prototype.map=function(t,e,n,r){var o=t.mapResult(e.from+r,1);if(o.deleted)return null;var i=t.mapResult(e.to+r,-1);return i.deleted||i.pos<=o.pos?null:new pe(o.pos-n,i.pos-n,this)},le.prototype.valid=function(t,e){var n=t.content.findIndex(e.from),r=n.index,o=n.offset;return o==e.from&&o+t.child(r).nodeSize==e.to},le.prototype.eq=function(t){return this==t||t instanceof le&&ae(this.attrs,t.attrs)&&ae(this.spec,t.spec)};var pe=function(t,e,n){this.from=t,this.to=e,this.type=n},he={spec:{}};pe.prototype.copy=function(t,e){return new pe(t,e,this.type)},pe.prototype.eq=function(t){return this.type.eq(t.type)&&this.from==t.from&&this.to==t.to},pe.prototype.map=function(t,e,n){return this.type.map(t,this,e,n)},pe.widget=function(t,e,n){return new pe(t,t,new se(e,n))},pe.inline=function(t,e,n,r){return new pe(t,e,new ce(n,r))},pe.node=function(t,e,n,r){return new pe(t,e,new le(n,r))},he.spec.get=function(){return this.type.spec},Object.defineProperties(pe.prototype,he);var ue=[],fe={},de=function(t,e){this.local=t&&t.length?t:ue,this.children=e&&e.length?e:ue};de.create=function(t,e){return e.length?be(e,t,0,fe):me},de.prototype.find=function(t,e,n){var r=[];return this.findInner(null==t?0:t,null==e?1e9:e,r,0,n),r},de.prototype.findInner=function(t,e,n,r,o){for(var i=0;i<this.local.length;i++){var a=this.local[i];a.from<=e&&a.to>=t&&(!o||o(a.spec))&&n.push(a.copy(a.from+r,a.to+r))}for(var s=0;s<this.children.length;s+=3)if(this.children[s]<e&&this.children[s+1]>t){var c=this.children[s]+1;this.children[s+2].findInner(t-c,e-c,n,r+c,o)}},de.prototype.map=function(t,e,n){return this==me||0==t.maps.length?this:this.mapInner(t,e,0,0,n||fe)},de.prototype.mapInner=function(t,e,n,r,o){for(var i,a=0;a<this.local.length;a++){var s=this.local[a].map(t,n,r);s&&s.type.valid(e,s)?(i||(i=[])).push(s):o.onRemove&&o.onRemove(this.local[a].spec)}return this.children.length?function(t,e,n,r,o,i,a){for(var s=t.slice(),c=function(t,e,n,r){for(var a=0;a<s.length;a+=3){var c=s[a+1],l=void 0;-1==c||t>c+i||(e>=s[a]+i?s[a+1]=-1:(l=r-n-(e-t)+(i-o))&&(s[a]+=l,s[a+1]+=l))}},l=0;l<n.maps.length;l++)n.maps[l].forEach(c);for(var p=!1,h=0;h<s.length;h+=3)if(-1==s[h+1]){var u=n.map(s[h]+i),f=u-o;if(f<0||f>=r.content.size){p=!0;continue}var d=n.map(t[h+1]+i,-1),m=d-o,v=r.content.findIndex(f),g=v.index,y=v.offset,w=r.maybeChild(g);if(w&&y==f&&y+w.nodeSize==m){var b=s[h+2].mapInner(n,w,u+1,s[h]+i+1,a);b!=me?(s[h]=f,s[h+1]=m,s[h+2]=b):(s.splice(h,3),h-=3)}else p=!0}if(p){var k=function(t,e,n,r,o,i){function a(t,o){for(var s=0;s<t.local.length;s++){var c=t.local[s].map(n,r,o);c?e.push(c):i.onRemove&&i.onRemove(t.local[s].spec)}for(var l=0;l<t.children.length;l+=3)a(t.children[l+2],t.children[l]+o+1)}for(var s=0;s<t.length;s+=3)-1==t[s+1]&&a(t[s+2],t[s]+o+1);return e}(s,e?ge(e,o):[],n,o,i,a),S=be(k,r,0,a);e=S.local;for(var x=0;x<s.length;x+=3)-1==s[x+1]&&(s.splice(x,3),x-=3);for(var C=0,M=0;C<S.children.length;C+=3){for(var O=S.children[C];M<s.length&&s[M]<O;)M+=3;s.splice(M,0,S.children[C],S.children[C+1],S.children[C+2])}}return new de(e&&e.sort(ke),s)}(this.children,i,t,e,n,r,o):i?new de(i.sort(ke)):me},de.prototype.add=function(t,e){return e.length?this==me?de.create(t,e):this.addInner(t,e,0):this},de.prototype.addInner=function(t,e,n){var r,o=this,i=0;t.forEach(function(t,a){var s,c=a+n;if(s=ye(e,t,c)){for(r||(r=o.children.slice());i<r.length&&r[i]<a;)i+=3;r[i]==a?r[i+2]=r[i+2].addInner(t,s,c+1):r.splice(i,0,a,a+t.nodeSize,be(s,t,c+1,fe)),i+=3}});var a=ge(i?we(e):e,-n);return new de(a.length?this.local.concat(a).sort(ke):this.local,r||this.children)},de.prototype.remove=function(t){return 0==t.length||this==me?this:this.removeInner(t,0)},de.prototype.removeInner=function(t,e){for(var n=this.children,r=this.local,o=0;o<n.length;o+=3){for(var i=void 0,a=n[o]+e,s=n[o+1]+e,c=0,l=void 0;c<t.length;c++)(l=t[c])&&l.from>a&&l.to<s&&(t[c]=null,(i||(i=[])).push(l));if(i){n==this.children&&(n=this.children.slice());var p=n[o+2].removeInner(i,a+1);p!=me?n[o+2]=p:(n.splice(o,3),o-=3)}}if(r.length)for(var h=0,u=void 0;h<t.length;h++)if(u=t[h])for(var f=0;f<r.length;f++)r[f].type.eq(u.type)&&(r==this.local&&(r=this.local.slice()),r.splice(f--,1));return n==this.children&&r==this.local?this:r.length||n.length?new de(r,n):me},de.prototype.forChild=function(t,e){var n,r;if(this==me)return this;if(e.isLeaf)return de.empty;for(var o=0;o<this.children.length;o+=3)if(this.children[o]>=t){this.children[o]==t&&(n=this.children[o+2]);break}for(var i=t+1,a=i+e.content.size,s=0;s<this.local.length;s++){var c=this.local[s];if(c.from<a&&c.to>i&&c.type instanceof ce){var l=Math.max(i,c.from)-i,p=Math.min(a,c.to)-i;l<p&&(r||(r=[])).push(c.copy(l,p))}}if(r){var h=new de(r.sort(ke));return n?new ve([h,n]):h}return n||me},de.prototype.eq=function(t){if(this==t)return!0;if(!(t instanceof de)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(var e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(var n=0;n<this.children.length;n+=3)if(this.children[n]!=t.children[n]||this.children[n+1]!=t.children[n+1]||!this.children[n+2].eq(t.children[n+2]))return!1;return!1},de.prototype.locals=function(t){return Se(this.localsInner(t))},de.prototype.localsInner=function(t){if(this==me)return ue;if(t.inlineContent||!this.local.some(ce.is))return this.local;for(var e=[],n=0;n<this.local.length;n++)this.local[n].type instanceof ce||e.push(this.local[n]);return e};var me=new de;de.empty=me,de.removeOverlap=Se;var ve=function(t){this.members=t};function ge(t,e){if(!e||!t.length)return t;for(var n=[],r=0;r<t.length;r++){var o=t[r];n.push(new pe(o.from+e,o.to+e,o.type))}return n}function ye(t,e,n){if(e.isLeaf)return null;for(var r=n+e.nodeSize,o=null,i=0,a=void 0;i<t.length;i++)(a=t[i])&&a.from>n&&a.to<r&&((o||(o=[])).push(a),t[i]=null);return o}function we(t){for(var e=[],n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function be(t,e,n,r){var o=[],i=!1;e.forEach(function(e,a){var s=ye(t,e,a+n);if(s){i=!0;var c=be(s,e,n+a+1,r);c!=me&&o.push(a,a+e.nodeSize,c)}});for(var a=ge(i?we(t):t,-n).sort(ke),s=0;s<a.length;s++)a[s].type.valid(e,a[s])||(r.onRemove&&r.onRemove(a[s].spec),a.splice(s--,1));return a.length||o.length?new de(a,o):me}function ke(t,e){return t.from-e.from||t.to-e.to}function Se(t){for(var e=t,n=0;n<e.length-1;n++){var r=e[n];if(r.from!=r.to)for(var o=n+1;o<e.length;o++){var i=e[o];if(i.from!=r.from){i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),xe(e,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,r.to),xe(e,o+1,i.copy(r.to,i.to)))}}return e}function xe(t,e,n){for(;e<t.length&&ke(n,t[e])>0;)e++;t.splice(e,0,n)}function Ce(t){var e=[];return t.someProp("decorations",function(n){var r=n(t.state);r&&r!=me&&e.push(r)}),t.cursorWrapper&&e.push(de.create(t.state.doc,[t.cursorWrapper.deco])),ve.from(e)}ve.prototype.forChild=function(t,e){if(e.isLeaf)return de.empty;for(var n=[],r=0;r<this.members.length;r++){var o=this.members[r].forChild(t,e);o!=me&&(o instanceof ve?n=n.concat(o.members):n.push(o))}return ve.from(n)},ve.prototype.eq=function(t){if(!(t instanceof ve)||t.members.length!=this.members.length)return!1;for(var e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0},ve.prototype.locals=function(t){for(var e,n=!0,r=0;r<this.members.length;r++){var o=this.members[r].localsInner(t);if(o.length)if(e){n&&(e=e.slice(),n=!1);for(var i=0;i<o.length;i++)e.push(o[i])}else e=o}return e?Se(n?e:e.sort(ke)):ue},ve.from=function(t){switch(t.length){case 0:return me;case 1:return t[0];default:return new ve(t)}};var Me=function(t,e){this._props=e,this.state=e.state,this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):t.apply?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=Ne(this),this.cursorWrapper=null,De(this),this.docView=j(this.state.doc,Te(this),Ce(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,function(t){t.shiftKey=!1,t.mouseDown=null,t.inDOMChange=null,t.lastKeyCode=null,t.lastKeyCodeTime=0,t.domObserver=new Bt(t),t.domObserver.start(),t.eventHandlers=Object.create(null);var e=function(e){var n=Lt[e];t.dom.addEventListener(e,t.eventHandlers[e]=function(e){!function(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}(t,e)||Wt(t,e)||!t.editable&&e.type in Vt||n(t,e)})};for(var n in Lt)e(n);Jt(t)}(this),this.selectionReader=new mt(this),this.pluginViews=[],this.updatePluginViews()},Oe={props:{},root:{}};function Te(t){var e=Object.create(null);return e.class="ProseMirror"+(t.focused?" ProseMirror-focused":""),e.contenteditable=String(t.editable),t.someProp("attributes",function(n){if("function"==typeof n&&(n=n(t.state)),n)for(var r in n)"class"==r?e.class+=" "+n[r]:e[r]||"contenteditable"==r||"nodeName"==r||(e[r]=String(n[r]))}),[pe.node(0,t.state.doc.content.size,e)]}function De(t){var e=Ot(t.state);if(!e||a.ie&&t.mouseDown)t.cursorWrapper=null;else{var n,o=t.state.selection.visible,i=t.state.storedMarks||e.marks();t.cursorWrapper&&r.Mark.sameSet(t.cursorWrapper.deco.spec.marks,i)&&"\ufeff"==t.cursorWrapper.dom.textContent&&t.cursorWrapper.deco.spec.visible==o?t.cursorWrapper.deco.pos!=e.pos&&(n=t.cursorWrapper.dom):n=function(t){var e=document.createElement("span");return e.textContent="\ufeff",t||(e.style.position="absolute",e.style.left="-100000px"),e}(o),n&&(t.cursorWrapper={dom:n,deco:pe.widget(e.pos,n,{isCursorWrapper:!0,marks:i,raw:!0,visible:o})})}}function Ne(t){return!t.someProp("editable",function(e){return!1===e(t.state)})}Oe.props.get=function(){if(this._props.state!=this.state){var t=this._props;for(var e in this._props={},t)this._props[e]=t[e];this._props.state=this.state}return this._props},Me.prototype.update=function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&Jt(this),this._props=t,this.updateState(t.state)},Me.prototype.setProps=function(t){var e={};for(var n in this._props)e[n]=this._props[n];for(var r in e.state=this.state,t)e[r]=t[r];this.update(e)},Me.prototype.updateState=function(t){var e=this,n=this.state;if(this.state=t,n.plugins!=t.plugins&&Jt(this),this.domObserver.flush(),!this.inDOMChange||!this.inDOMChange.stateUpdated(t)){var r=this.editable;this.editable=Ne(this),De(this);var i=Ce(this),a=Te(this),s=n.config!=t.config?"reset":t.scrollToSelection>n.scrollToSelection?"to selection":"preserve",c=!this.docView.matchesNode(t.doc,a,i),l=c||!t.selection.eq(n.selection)||this.selectionReader.domChanged(),p="preserve"==s&&l&&function(t){for(var e,n,r=t.dom.getBoundingClientRect(),o=Math.max(0,r.top),i=t.dom.ownerDocument,a=(r.left+r.right)/2,s=o+1;s<Math.min(innerHeight,r.bottom);s+=5){var c=t.root.elementFromPoint(a,s);if(c!=t.dom&&t.dom.contains(c)){var l=c.getBoundingClientRect();if(l.top>=o-20){e=c,n=l.top;break}}}for(var p=[],h=t.dom;h&&(p.push({dom:h,top:h.scrollTop,left:h.scrollLeft}),h!=i.body);h=f(h));return{refDOM:e,refTop:n,stack:p}}(this);l&&(this.domObserver.stop(),c&&(this.docView.update(t.doc,a,i,this)||(this.docView.destroy(),this.docView=j(t.doc,a,i,this.dom,this)),this.selectionReader.clearDOMState()),yt(this),this.domObserver.start()),r!=this.editable&&this.selectionReader.editableChanged(),this.updatePluginViews(n),"reset"==s?this.dom.scrollTop=0:"to selection"==s?this.someProp("handleScrollToSelection",function(t){return t(e)})||(t.selection instanceof o.NodeSelection?k(this,this.docView.domAfterPos(t.selection.from).getBoundingClientRect()):k(this,this.coordsAtPos(t.selection.head))):p&&function(t){for(var e=t.refDOM,n=t.refTop,r=t.stack,o=e?e.getBoundingClientRect().top:0,i=0==o?0:o-n,a=0;a<r.length;a++){var s=r[a],c=s.dom,l=s.top,p=s.left;c.scrollTop!=l+i&&(c.scrollTop=l+i),c.scrollLeft!=p&&(c.scrollLeft=p)}}(p)}},Me.prototype.destroyPluginViews=function(){for(var t;t=this.pluginViews.pop();)t.destroy&&t.destroy()},Me.prototype.updatePluginViews=function(t){var e=this.state.plugins;if(t&&t.plugins==e)for(var n=0;n<this.pluginViews.length;n++){var r=this.pluginViews[n];r.update&&r.update(this,t)}else{this.destroyPluginViews();for(var o=0;o<e.length;o++){var i=e[o];i.spec.view&&this.pluginViews.push(i.spec.view(this))}}},Me.prototype.someProp=function(t,e){var n,r=this._props&&this._props[t];if(null!=r&&(n=e?e(r):r))return n;var o=this.state.plugins;if(o)for(var i=0;i<o.length;i++){var a=o[i].props[t];if(null!=a&&(n=e?e(a):a))return n}},Me.prototype.hasFocus=function(){return this.root.activeElement==this.dom},Me.prototype.focus=function(){this.domObserver.stop(),yt(this,!0),this.domObserver.start(),this.editable&&this.dom.focus()},Oe.root.get=function(){var t=this._root;if(null==t)for(var e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return this._root=e;return t||document},Me.prototype.posAtCoords=function(t){var e=x(this,t);return this.inDOMChange&&e&&(e.pos=this.inDOMChange.mapping.map(e.pos),-1!=e.inside&&(e.inside=this.inDOMChange.mapping.map(e.inside))),e},Me.prototype.coordsAtPos=function(t){return this.inDOMChange&&(t=this.inDOMChange.mapping.invert().map(t)),M(this,t)},Me.prototype.domAtPos=function(t){return this.inDOMChange&&(t=this.inDOMChange.mapping.invert().map(t)),this.docView.domFromPos(t)},Me.prototype.nodeDOM=function(t){this.inDOMChange&&(t=this.inDOMChange.mapping.invert().map(t));var e=this.docView.descAt(t);return e?e.nodeDOM:null},Me.prototype.posAtDOM=function(t,e,n){void 0===n&&(n=-1);var r=this.docView.posFromDOM(t,e,n);if(null==r)throw new RangeError("DOM position not inside the editor");return this.inDOMChange&&(r=this.inDOMChange.mapping.map(r)),r},Me.prototype.endOfTextblock=function(t,e){return E(this,e||this.state,t)},Me.prototype.destroy=function(){this.docView&&(!function(t){for(var e in t.domObserver.stop(),t.inDOMChange&&t.inDOMChange.destroy(),t.eventHandlers)t.dom.removeEventListener(e,t.eventHandlers[e])}(this),this.destroyPluginViews(),this.selectionReader.destroy(),this.mounted?(this.docView.update(this.state.doc,[],Ce(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)},Me.prototype.dispatchEvent=function(t){return function(t,e){Wt(t,e)||!Lt[e.type]||!t.editable&&e.type in Vt||Lt[e.type](t,e)}(this,t)},Me.prototype.dispatch=function(t){var e=this._props.dispatchTransaction;e?e(t):this.updateState(this.state.apply(t))},Object.defineProperties(Me.prototype,Oe),e.EditorView=Me,e.Decoration=pe,e.DecorationSet=de,e.__serializeForClipboard=Ft,e.__parseFromClipboard=$t},function(t,e){e.MenuItem=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"function"!=typeof e.command)throw new Error("command is not a function!");if(this.command=e.command,!(e.dom instanceof Element))throw new Error("dom must be a DOM node!");this.dom=e.dom}},function(t,e){var n=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var r=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.items=e,this.editorView=n,this.dom=document.createElement("div"),this.dom.className="menubar",e.forEach(function(t){var e=t.dom;return r.dom.appendChild(e)}),this.update(),this.dom.addEventListener("mousedown",function(t){t.preventDefault(),n.focus(),e.forEach(function(e){var r=e.command;e.dom.contains(t.target)&&r(n.state,n.dispatch,n)})})}return n(t,[{key:"update",value:function(){var t=this;this.items.forEach(function(e){var n=e.command,r=e.dom,o=n(t.editorView.state,null,t.editorView);r.style.display=o?"":"none"})}},{key:"destroy",value:function(){this.dom.remove()}}]),t}();e.MenuView=r},function(t,e,n){var r=n(1).Plugin,o=n(12).MenuView;e.MenuPlugin=function(t){return new r({view:function(e){var n=new o(t,e);return e.dom.parentNode.insertBefore(n.dom,e.dom),n}})}},function(t,e,n){var r=n(5),o=r.toggleMark,i=r.setBlockType,a=r.wrapIn,s=n(13).MenuPlugin,c=n(11).MenuItem,l=n(9).schema,p=n(3).MediaForm,h=n(8).LinkForm;function u(t,e){var n=document.createElement("span");return n.className="menuicon "+e,n.title=e,n.textContent=t,n}function f(t){return{command:i(l.nodes.heading,{level:t}),dom:u("H"+t,"heading")}}var d=new c({command:o(l.marks.underline),dom:u("u","underline")}),m=new c({command:function(t,e){var n=t.selection.$from,r=n.index();if(!n.parent.canReplaceWith(r,r,l.nodes.link))return!1;if(e){var o="";t.selection.content().content.descendants(function(t){return o+=t.textContent,!1});var i=new h;i.setLinkType("internallink"),o&&(i.setLinkTarget(!1,o),i.setLinkNameType("custom",o)),i.on("submit",h.resolveSubmittedLinkData(i,{},function(n){var r=l.nodes.link.create(n);e(t.tr.replaceSelectionWith(r)),i.off("submit"),i.hide(),i.resetForm()})),i.show()}return!0},dom:u("L","Link")}),v=new c({command:function(t,e){var n=t.selection.$from,r=n.index();if(!n.parent.canReplaceWith(r,r,l.nodes.image))return!1;if(e){var o="";t.selection.content().content.descendants(function(t){return o+=t.textContent,!1});var i=new p;o&&(i.setCaption(o),i.setSource(o)),i.show(),i.on("submit",p.resolveSubmittedLinkData({},i,function(n){e(t.tr.replaceSelectionWith(l.nodes.image.create(n))),i.off("submit"),i.hide(),i.resetForm()}))}return!0},dom:u("🖼️","Insert Image")}),g=s([{command:o(l.marks.strong),dom:u("B","strong")},{command:o(l.marks.em),dom:u("i","em")},d,m,v,{command:i(l.nodes.paragraph),dom:u("p","paragraph")},f(1),f(2),f(3),{command:a(l.nodes.blockquote),dom:u(">","blockquote")}]);e.menu=g},function(t,e,n){var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=n(3).MediaForm,a=n(6).AbstractNodeView,s=function(t){function e(t,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return o.MediaForm=new i,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a),o(e,[{key:"renderNode",value:function(t){if(t["data-resolvedHtml"]){var e=jQuery(t["data-resolvedHtml"]);return e.removeAttr("controls"),this.dom=e.get(0),void jQuery(this.dom).on("click",function(t){void 0!==t.ctrlKey&&t.ctrlKey||t.preventDefault()})}this.dom=jQuery("<span>⌚</span>").get(0)}},{key:"selectNode",value:function(){var t=this;this.dom.classList.add("ProseMirror-selectednode"),this.MediaForm.setSource(this.node.attrs.id),this.MediaForm.setCaption(this.node.attrs.title),this.MediaForm.setWidth(this.node.attrs.width),this.MediaForm.setHeight(this.node.attrs.height),this.MediaForm.setCache(this.node.attrs.cache),this.MediaForm.setAlignment(this.node.attrs.align),this.MediaForm.setLinking(this.node.attrs.linking),this.MediaForm.show();var e=a.unsetPrefixAttributes("data-resolved",r({},this.node.attrs));this.MediaForm.on("submit",i.resolveSubmittedLinkData(e,this.MediaForm,function(e){t.renderNode(e);var n=t.getPos();t.outerView.dispatch(t.outerView.state.tr.setNodeMarkup(n,null,e,t.node.marks))}))}},{key:"deselectNode",value:function(){this.dom.classList.remove("ProseMirror-selectednode"),this.MediaForm.hide(),this.MediaForm.off("submit"),this.MediaForm.resetForm()}}]),e}();e.MediaView=s},function(t,e,n){var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=n(8).LinkForm,s=n(6).AbstractNodeView,c=function(t){function e(t,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return o.linkForm=new a,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s),i(e,[{key:"renderNode",value:function(t){var n=this;this.dom||(this.dom=document.createElement("a"),jQuery(this.dom).on("click",function(t){void 0!==t.ctrlKey&&t.ctrlKey||t.preventDefault()})),t["data-resolvedUrl"]?this.dom.setAttribute("href",t["data-resolvedUrl"]):this.dom.setAttribute("href",e.transformInnerToHref(t["data-type"],t["data-resolvedID"]||t["data-inner"])),t["data-resolvedTitle"]?this.dom.setAttribute("title",t["data-resolvedTitle"]):this.dom.setAttribute("title",e.getTitleFromInner(t["data-type"],t["data-inner"])),Object.entries(t).forEach(function(t){var e=o(t,2),r=e[0],i=e[1];"image-"!==r.substr(0,"image-".length)&&n.dom.setAttribute(r,i)}),this.dom.setAttribute("style","cursor: text;");var r=t["image-id"]&&t["image-id"].length>0;console.log("isImage: "+r),t["data-name"]?this.dom.textContent=t["data-name"]:r?this.dom.innerHTML=t["data-resolvedImage"]:t["data-resolvedName"]?this.dom.textContent=t["data-resolvedName"]:this.dom.textContent=e.getDefaultNameFromInner(t["data-type"],t["data-inner"]),r?this.dom.setAttribute("class","media"):t["data-resolvedClass"]?this.dom.setAttribute("class",t["data-resolvedClass"]):this.dom.setAttribute("class",e.getClassFromType(t["data-type"]))}},{key:"selectNode",value:function(){var t=this;this.dom.classList.add("ProseMirror-selectednode"),this.linkForm.setLinkType(this.node.attrs["data-type"]),this.linkForm.setLinkTarget(this.node.attrs["data-type"],this.node.attrs["data-inner"]),this.node.attrs["data-name"]?this.linkForm.setLinkNameType("custom",this.node.attrs["data-name"]):this.node.attrs["image-id"]&&this.linkForm.setLinkNameType("image",Object.entries(this.node.attrs).filter(function(t){var e=o(t,2),n=e[0],r=e[1];return"image-"===n.substr(0,"image-".length)&&r}).reduce(function(t,e){var n=o(e,2),i=n[0],a=n[1];return r({},t,function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},i.substr("image-".length),a))},{})),this.linkForm.show();var n=this.node.copy().attrs;n=e.unsetPrefixAttributes("data-resolved",n),n=e.unsetPrefixAttributes("image-",n),this.linkForm.on("submit",a.resolveSubmittedLinkData(this.linkForm,n,function(e){t.renderNode(e);var n=t.getPos();t.outerView.dispatch(t.outerView.state.tr.setNodeMarkup(n,null,e,t.node.marks))}))}},{key:"deselectNode",value:function(){this.dom.classList.remove("ProseMirror-selectednode"),this.linkForm.off("submit"),this.linkForm.hide(),this.linkForm.resetForm()}},{key:"destroy",value:function(){}}],[{key:"unsetPrefixAttributes",value:function(t,e){var n={};return Object.keys(e).forEach(function(r){r.substr(0,t.length)!==t&&(n[r]=e[r])}),n}},{key:"transformInnerToHref",value:function(t,e){switch(t){case"externallink":return e;case"emaillink":return"mailto:"+e;case"internallink":return DOKU_BASE+"doku.php?id="+e.replace("?","&");case"other":return"\\\\"===e.substr(0,"\\\\".length)?"file:///"+e.replace("\\","/"):e;default:return console.log("unknown linktype: "+t),!1}}},{key:"getDefaultNameFromInner",value:function(t,e){switch(t){case"externallink":case"other":case"emaillink":return e;case"interwikilink":return e.split(/>/)[1];case"internallink":return e.split(/[?|#]/)[0].split(":").pop();default:return console.warn("unknown linktype: "+t),!1}}},{key:"getTitleFromInner",value:function(t,e){switch(t){case"externallink":case"other":case"emaillink":case"interwikilink":return e;case"internallink":return e.split(/[?|#]/)[0];default:return console.warn("unknown linktype: "+t),!1}}},{key:"getClassFromType",value:function(t){switch(t){case"externallink":return"urlextern";case"emaillink":return"mail";case"interwikilink":case"internallink":return"";case"other":return"windows";default:return console.log("unknown linktype to return class from: "+t),!1}}}]),e}();e.LinkView=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function(){return["p",0]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function(){return["hr"]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return["pre",["code",0]]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:function(t){return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM:function(t){return["img",t.attrs]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}}},o={link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(t){return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM:function(t){return["a",t.attrs]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(t){return"normal"!=t.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(t){return/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}}],toDOM:function(){return["strong"]}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return["code"]}}},i=new(n(0).Schema)({nodes:r,marks:o});e.nodes=r,e.marks=o,e.schema=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=n(0),i=["ol",0],a=["ul",0],s=["li",0],c={attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:function(t){return{order:t.hasAttribute("start")?+t.getAttribute("start"):1}}}],toDOM:function(t){return 1==t.attrs.order?i:["ol",{start:t.attrs.order},0]}},l={parseDOM:[{tag:"ul"}],toDOM:function(){return a}},p={parseDOM:[{tag:"li"}],toDOM:function(){return s},defining:!0};function h(t,e){var n={};for(var r in t)n[r]=t[r];for(var o in e)n[o]=e[o];return n}e.orderedList=c,e.bulletList=l,e.listItem=p,e.addListNodes=function(t,e,n){return t.append({ordered_list:h(c,{content:"list_item+",group:n}),bullet_list:h(l,{content:"list_item+",group:n}),list_item:h(p,{content:e})})},e.wrapInList=function(t,e){return function(n,i){var a=n.selection,s=a.$from,c=a.$to,l=s.blockRange(c),p=!1,h=l;if(!l)return!1;if(l.depth>=2&&s.node(l.depth-1).type.compatibleContent(t)&&0==l.startIndex){if(0==s.index(l.depth-1))return!1;var u=n.doc.resolve(l.start-2);h=new o.NodeRange(u,u,l.depth),l.endIndex<l.parent.childCount&&(l=new o.NodeRange(s,n.doc.resolve(c.end(l.depth)),l.depth)),p=!0}var f=r.findWrapping(h,t,e,l);return!!f&&(i&&i(function(t,e,n,i,a){for(var s=o.Fragment.empty,c=n.length-1;c>=0;c--)s=o.Fragment.from(n[c].type.create(n[c].attrs,s));t.step(new r.ReplaceAroundStep(e.start-(i?2:0),e.end,e.start,e.end,new o.Slice(s,0,0),n.length,!0));for(var l=0,p=0;p<n.length;p++)n[p].type==a&&(l=p+1);for(var h=n.length-l,u=e.start+n.length-(i?2:0),f=e.parent,d=e.startIndex,m=e.endIndex,v=!0;d<m;d++,v=!1)!v&&r.canSplit(t.doc,u,h)&&(t.split(u,h),u+=2*h),u+=f.child(d).nodeSize;return t}(n.tr,l,f,p,t).scrollIntoView()),!0)}},e.splitListItem=function(t){return function(e,n){var i=e.selection,a=i.$from,s=i.$to,c=i.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(s))return!1;var l=a.node(-1);if(l.type!=t)return!1;if(0==a.parent.content.size){if(2==a.depth||a.node(-3).type!=t||a.index(-2)!=a.node(-2).childCount-1)return!1;if(n){for(var p=o.Fragment.empty,h=a.index(-1)>0,u=a.depth-(h?1:2);u>=a.depth-3;u--)p=o.Fragment.from(a.node(u).copy(p));p=p.append(o.Fragment.from(t.createAndFill()));var f=e.tr.replace(a.before(h?null:-1),a.after(-3),new o.Slice(p,h?3:2,2));f.setSelection(e.selection.constructor.near(f.doc.resolve(a.pos+(h?3:2)))),n(f.scrollIntoView())}return!0}var d=s.pos==a.end()?l.defaultContentType(0):null,m=e.tr.delete(a.pos,s.pos),v=d&&[null,{type:d}];return!!r.canSplit(m.doc,a.pos,2,v)&&(n&&n(m.split(a.pos,2,v).scrollIntoView()),!0)}},e.liftListItem=function(t){return function(e,n){var i=e.selection,a=i.$from,s=i.$to,c=a.blockRange(s,function(e){return e.childCount&&e.firstChild.type==t});return!!c&&(!n||(a.node(c.depth-1).type==t?function(t,e,n,i){var a=t.tr,s=i.end,c=i.$to.end(i.depth);return s<c&&(a.step(new r.ReplaceAroundStep(s-1,c,s,c,new o.Slice(o.Fragment.from(n.create(null,i.parent.copy())),1,0),1,!0)),i=new o.NodeRange(a.doc.resolve(i.$from.pos),a.doc.resolve(c),i.depth)),e(a.lift(i,r.liftTarget(i)).scrollIntoView()),!0}(e,n,t,c):function(t,e,n){for(var i=t.tr,a=n.parent,s=n.end,c=n.endIndex-1,l=n.startIndex;c>l;c--)s-=a.child(c).nodeSize,i.delete(s-1,s+1);var p=i.doc.resolve(n.start),h=p.nodeAfter,u=0==n.startIndex,f=n.endIndex==a.childCount,d=p.node(-1),m=p.index(-1);if(!d.canReplace(m+(u?0:1),m+1,h.content.append(f?o.Fragment.empty:o.Fragment.from(a))))return!1;var v=p.pos,g=v+h.nodeSize;return i.step(new r.ReplaceAroundStep(v-(u?1:0),g+(f?1:0),v+1,g-1,new o.Slice((u?o.Fragment.empty:o.Fragment.from(a.copy(o.Fragment.empty))).append(f?o.Fragment.empty:o.Fragment.from(a.copy(o.Fragment.empty))),u?0:1,f?0:1),u?0:1)),e(i.scrollIntoView()),!0}(e,n,c)))}},e.sinkListItem=function(t){return function(e,n){var i=e.selection,a=i.$from,s=i.$to,c=a.blockRange(s,function(e){return e.childCount&&e.firstChild.type==t});if(!c)return!1;var l=c.startIndex;if(0==l)return!1;var p=c.parent,h=p.child(l-1);if(h.type!=t)return!1;if(n){var u=h.lastChild&&h.lastChild.type==p.type,f=o.Fragment.from(u?t.create():null),d=new o.Slice(o.Fragment.from(t.create(null,o.Fragment.from(p.copy(f)))),u?3:1,0),m=c.start,v=c.end;n(e.tr.step(new r.ReplaceAroundStep(m-(u?3:1),v,m,v,d,1,!0)).scrollIntoView())}return!0}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o,i=n(1),a=n(10),s=n(0),c=n(2),l=n(4);if("undefined"!=typeof WeakMap){var p=new WeakMap;r=function(t){return p.get(t)},o=function(t,e){return p.set(t,e),e}}else{var h=[],u=0;r=function(t){for(var e=0;e<h.length;e+=2)if(h[e]==t)return h[e+1]},o=function(t,e){return 10==u&&(u=0),h[u++]=t,h[u++]=e}}var f=function(t,e,n,r){this.left=t,this.top=e,this.right=n,this.bottom=r},d=function(t,e,n,r){this.width=t,this.height=e,this.map=n,this.problems=r};function m(t){if(t.colwidth)return t.colwidth.slice();for(var e=[],n=0;n<t.colspan;n++)e.push(0);return e}d.prototype.findCell=function(t){for(var e=0;e<this.map.length;e++){var n=this.map[e];if(n==t){for(var r=e%this.width,o=e/this.width|0,i=r+1,a=o+1,s=1;i<this.width&&this.map[e+s]==n;s++)i++;for(var c=1;a<this.height&&this.map[e+this.width*c]==n;c++)a++;return new f(r,o,i,a)}}throw new RangeError("No cell with offset "+t+" found")},d.prototype.colCount=function(t){for(var e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError("No cell with offset "+t+" found")},d.prototype.nextCell=function(t,e,n){var r=this.findCell(t),o=r.left,i=r.right,a=r.top,s=r.bottom;return"horiz"==e?(n<0?0==o:i==this.width)?null:this.map[a*this.width+(n<0?o-1:i)]:(n<0?0==a:s==this.height)?null:this.map[o+this.width*(n<0?a-1:s)]},d.prototype.rectBetween=function(t,e){var n=this.findCell(t),r=n.left,o=n.right,i=n.top,a=n.bottom,s=this.findCell(e),c=s.left,l=s.right,p=s.top,h=s.bottom;return new f(Math.min(r,c),Math.min(i,p),Math.max(o,l),Math.max(a,h))},d.prototype.cellsInRect=function(t){for(var e=[],n=[],r=t.top;r<t.bottom;r++)for(var o=t.left;o<t.right;o++){var i=r*this.width+o,a=this.map[i];n.indexOf(a)>-1||(n.push(a),o==t.left&&o&&this.map[i-1]==a||r==t.top&&r&&this.map[i-this.width]==a||e.push(a))}return e},d.prototype.positionAt=function(t,e,n){for(var r=0,o=0;;r++){var i=o+n.child(r).nodeSize;if(r==t){for(var a=e+t*this.width,s=(t+1)*this.width;a<s&&this.map[a]<o;)a++;return a==s?i-1:this.map[a]}o=i}},d.get=function(t){return r(t)||o(t,function(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);for(var e=function(t){for(var e=-1,n=!1,r=0;r<t.childCount;r++){var o=t.child(r),i=0;if(n)for(var a=0;a<r;a++)for(var s=t.child(a),c=0;c<s.childCount;c++){var l=s.child(c);a+l.attrs.rowspan>r&&(i+=l.attrs.colspan)}for(var p=0;p<o.childCount;p++){var h=o.child(p);i+=h.attrs.colspan,h.attrs.rowspan>1&&(n=!0)}-1==e?e=i:e!=i&&(e=Math.max(e,i))}return e}(t),n=t.childCount,r=[],o=0,i=null,a=[],s=0,c=e*n;s<c;s++)r[s]=0;for(var l=0,p=0;l<n;l++){var h=t.child(l);p++;for(var u=0;;u++){for(;o<r.length&&0!=r[o];)o++;if(u==h.childCount)break;for(var f=h.child(u),v=f.attrs,g=v.colspan,y=v.rowspan,w=v.colwidth,b=0;b<y;b++){if(b+l>=n){(i||(i=[])).push({type:"overlong_rowspan",pos:p,n:y-b});break}for(var k=o+b*e,S=0;S<g;S++){0==r[k+S]?r[k+S]=p:(i||(i=[])).push({type:"collision",row:l,pos:p,n:g-S});var x=w&&w[S];if(x){var C=(k+S)%e*2,M=a[C];null==M||M!=x&&1==a[C+1]?(a[C]=x,a[C+1]=1):M==x&&a[C+1]++}}}o+=g,p+=f.nodeSize}for(var O=(l+1)*e,T=0;o<O;)0==r[o++]&&T++;T&&(i||(i=[])).push({type:"missing",row:l,n:T}),p++}for(var D=new d(e,n,r,i),N=!1,A=0;!N&&A<a.length;A+=2)null!=a[A]&&a[A+1]<n&&(N=!0);N&&function(t,e,n){t.problems||(t.problems=[]);for(var r=0,o=[];r<t.map.length;r++){var i=t.map[r];if(!(o.indexOf(i)>-1)){o.push(i);for(var a=n.nodeAt(i),s=null,c=0;c<a.attrs.colspan;c++){var l=(r+c)%t.width,p=e[2*l];null==p||a.attrs.colwidth&&a.attrs.colwidth[c]==p||((s||(s=m(a.attrs)))[c]=p)}s&&t.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:s})}}}(D,a,t);return D}(t))};var v=new i.PluginKey("selectingCells");function g(t){for(var e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function y(t){for(var e=t.selection.$head,n=e.depth;n>0;n--)if("row"==e.node(n).type.spec.tableRole)return!0;return!1}function w(t){var e=t.selection;return e.$anchorCell?e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell:e.node&&"cell"==e.node.type.spec.tableRole?e.$anchor:g(e.$head)||function(t){for(var e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){var r=e.type.spec.tableRole;if("cell"==r||"header_cell"==r)return t.doc.resolve(n)}for(var o=t.nodeBefore,i=t.pos;o;o=o.lastChild,i--){var a=o.type.spec.tableRole;if("cell"==a||"header_cell"==a)return t.doc.resolve(i-o.nodeSize)}}(e.$head)}function b(t){return"row"==t.parent.type.spec.tableRole&&t.nodeAfter}function k(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function S(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function x(t,e,n){var r=t.start(-1),o=d.get(t.node(-1)).nextCell(t.pos-r,e,n);return null==o?null:t.node(0).resolve(r+o)}function C(t,e,n){var r={};for(var o in t)r[o]=t[o];return r[e]=n,r}function M(t,e,n){void 0===n&&(n=1);var r=C(t,"colspan",t.colspan-n);return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(function(t){return t>0})||(r.colwidth=null)),r}function O(t,e,n){void 0===n&&(n=1);var r=C(t,"colspan",t.colspan+n);if(r.colwidth){r.colwidth=r.colwidth.slice();for(var o=0;o<n;o++)r.colwidth.splice(e,0,0)}return r}var T=function(t){function e(e,n){void 0===n&&(n=e);var r=e.node(-1),o=d.get(r),a=e.start(-1),s=o.rectBetween(e.pos-a,n.pos-a),c=e.node(0),l=o.cellsInRect(s).filter(function(t){return t!=n.pos-a});l.unshift(n.pos-a);var p=l.map(function(t){var e=r.nodeAt(t),n=t+a+1;return new i.SelectionRange(c.resolve(n),c.resolve(n+e.content.size))});t.call(this,p[0].$from,p[0].$to,p),this.$anchorCell=e,this.$headCell=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(t,n){var r=t.resolve(n.map(this.$anchorCell.pos)),o=t.resolve(n.map(this.$headCell.pos));if(b(r)&&b(o)&&S(r,o)){var a=this.$anchorCell.node(-1)!=r.node(-1);return a&&this.isRowSelection()?e.rowSelection(r,o):a&&this.isColSelection()?e.colSelection(r,o):new e(r,o)}return i.TextSelection.between(r,o)},e.prototype.content=function(){for(var t=this.$anchorCell.node(-1),e=d.get(t),n=this.$anchorCell.start(-1),r=e.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),o=[],i=[],a=r.top;a<r.bottom;a++){for(var c=[],l=a*e.width+r.left,p=r.left;p<r.right;p++,l++){var h=e.map[l];if(-1==o.indexOf(h)){o.push(h);var u=e.findCell(h),f=t.nodeAt(h),m=r.left-u.left,v=u.right-r.right;if(m>0||v>0){var g=f.attrs;m>0&&(g=M(g,0,m)),v>0&&(g=M(g,g.colspan-v,v)),f=u.left<r.left?f.type.createAndFill(g):f.type.create(g,f.content)}if(u.top<r.top||u.bottom>r.bottom){var y=C(f.attrs,"rowspan",Math.min(u.bottom,r.bottom)-Math.max(u.top,r.top));f=u.top<r.top?f.type.createAndFill(y):f.type.create(y,f.content)}c.push(f)}}i.push(t.child(a).copy(s.Fragment.from(c)))}return new s.Slice(s.Fragment.from(i),1,1)},e.prototype.replace=function(e,n){void 0===n&&(n=s.Slice.empty);for(var r=e.steps.length,o=this.ranges,i=0;i<o.length;i++){var a=o[i],c=a.$from,l=a.$to,p=e.mapping.slice(r);e.replace(p.map(c.pos),p.map(l.pos),i?s.Slice.empty:n)}var h=t.findFrom(e.doc.resolve(e.mapping.slice(r).map(this.to)),-1);h&&e.setSelection(h)},e.prototype.replaceWith=function(t,e){this.replace(t,new s.Slice(s.Fragment.from(e),0,0))},e.prototype.forEachCell=function(t){for(var e=this.$anchorCell.node(-1),n=d.get(e),r=this.$anchorCell.start(-1),o=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r)),i=0;i<o.length;i++)t(e.nodeAt(o[i]),r+o[i])},e.prototype.isColSelection=function(){var t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;var n=t+this.$anchorCell.nodeAfter.attrs.rowspan,r=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,r)==this.$headCell.node(-1).childCount},e.colSelection=function(t,n){void 0===n&&(n=t);var r=d.get(t.node(-1)),o=t.start(-1),i=r.findCell(t.pos-o),a=r.findCell(n.pos-o),s=t.node(0);return i.top<=a.top?(i.top>0&&(t=s.resolve(o+r.map[i.left])),a.bottom<r.height&&(n=s.resolve(o+r.map[r.width*(r.height-1)+a.right-1]))):(a.top>0&&(n=s.resolve(o+r.map[a.left])),i.bottom<r.height&&(t=s.resolve(o+r.map[r.width*(r.height-1)+i.right-1]))),new e(t,n)},e.prototype.isRowSelection=function(){var t=d.get(this.$anchorCell.node(-1)),e=this.$anchorCell.start(-1),n=t.colCount(this.$anchorCell.pos-e),r=t.colCount(this.$headCell.pos-e);if(Math.min(n,r)>0)return!1;var o=n+this.$anchorCell.nodeAfter.attrs.colspan,i=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,i)==t.width},e.prototype.eq=function(t){return t instanceof e&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos},e.rowSelection=function(t,n){void 0===n&&(n=t);var r=d.get(t.node(-1)),o=t.start(-1),i=r.findCell(t.pos-o),a=r.findCell(n.pos-o),s=t.node(0);return i.left<=a.left?(i.left>0&&(t=s.resolve(o+r.map[i.top*r.width])),a.right<r.width&&(n=s.resolve(o+r.map[r.width*(a.top+1)-1]))):(a.left>0&&(n=s.resolve(o+r.map[a.top*r.width])),i.right<r.width&&(t=s.resolve(o+r.map[r.width*(i.top+1)-1]))),new e(t,n)},e.prototype.toJSON=function(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}},e.fromJSON=function(t,n){return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,n,r){return void 0===r&&(r=n),new e(t.resolve(n),t.resolve(r))},e.prototype.getBookmark=function(){return new D(this.$anchorCell.pos,this.$headCell.pos)},e}(i.Selection);T.prototype.visible=!1,i.Selection.jsonID("cell",T);var D=function(t,e){this.anchor=t,this.head=e};function N(t){if(!(t.selection instanceof T))return null;var e=[];return t.selection.forEachCell(function(t,n){e.push(a.Decoration.node(n,n+t.nodeSize,{class:"selectedCell"}))}),a.DecorationSet.create(t.doc,e)}function A(t,e){var n=t.getAttribute("data-colwidth"),r=n&&/^\d+(,\d+)*$/.test(n)?n.split(",").map(function(t){return Number(t)}):null,o=Number(t.getAttribute("colspan")||1),i={colspan:o,rowspan:Number(t.getAttribute("rowspan")||1),colwidth:r&&r.length==o?r:null};for(var a in e){var s=e[a].getFromDOM,c=s&&s(t);null!=c&&(i[a]=c)}return i}function E(t,e){var n={};for(var r in 1!=t.attrs.colspan&&(n.colspan=t.attrs.colspan),1!=t.attrs.rowspan&&(n.rowspan=t.attrs.rowspan),t.attrs.colwidth&&(n["data-colwidth"]=t.attrs.colwidth.join(",")),e){var o=e[r].setDOMAttr;o&&o(t.attrs[r],n)}return n}function R(t){var e=t.cached.tableNodeTypes;if(!e)for(var n in e=t.cached.tableNodeTypes={},t.nodes){var r=t.nodes[n],o=r.spec.tableRole;o&&(e[o]=r)}return e}function F(t){if(!t.size)return null;for(var e=t.content,n=t.openStart,r=t.openEnd;1==e.childCount&&(n>0&&r>0||"table"==e.firstChild.type.spec.tableRole);)n--,r--,e=e.firstChild.content;var o=e.firstChild,i=o.type.spec.tableRole,a=o.type.schema,c=[];if("row"==i)for(var l=0;l<e.childCount;l++){var p=e.child(l).content,h=l?0:Math.max(0,n-1),u=l<e.childCount-1?0:Math.max(0,r-1);(h||u)&&(p=$(R(a).row,new s.Slice(p,h,u)).content),c.push(p)}else{if("cell"!=i&&"header_cell"!=i)return null;c.push(n||r?$(R(a).row,new s.Slice(e,n,r)).content:e)}return function(t,e){for(var n=[],r=0;r<e.length;r++)for(var o=e[r],i=o.childCount-1;i>=0;i--)for(var a=o.child(i).attrs,c=a.rowspan,l=a.colspan,p=r;p<r+c;p++)n[p]=(n[p]||0)+l;for(var h=0,u=0;u<n.length;u++)h=Math.max(h,n[u]);for(var f=0;f<n.length;f++)if(f>=e.length&&e.push(s.Fragment.empty),n[f]<h){for(var d=R(t).cell.createAndFill(),m=[],v=n[f];v<h;v++)m.push(d);e[f]=e[f].append(s.Fragment.from(m))}return{height:e.length,width:h,rows:e}}(a,c)}function $(t,e){var n=t.createAndFill();return new c.Transform(n).replace(0,n.content.size,e).doc}function P(t,e,n){var r=t.width,o=t.height,i=t.rows;if(r!=e){for(var a=[],c=[],l=0;l<i.length;l++){for(var p=i[l],h=[],u=a[l]||0,f=0;u<e;f++){var d=p.child(f%p.childCount);u+d.attrs.colspan>e&&(d=d.type.create(M(d.attrs,d.attrs.colspan,u+d.attrs.colspan-e),d.content)),h.push(d),u+=d.attrs.colspan;for(var m=1;m<d.attrs.rowspan;m++)a[l+m]=(a[l+m]||0)+d.attrs.colspan}c.push(s.Fragment.from(h))}i=c,r=e}if(o!=n){for(var v=[],g=0,y=0;g<n;g++,y++){for(var w=[],b=i[y%o],k=0;k<b.childCount;k++){var S=b.child(k);g+S.attrs.rowspan>n&&(S=S.type.create(C(S.attrs,"rowspan",n-S.attrs.rowspan),S.content)),w.push(S)}v.push(s.Fragment.from(w))}i=v,o=n}return{width:r,height:o,rows:i}}function z(t,e,n,r,o,i,a,s){if(0==a||a==e.height)return!1;for(var c=!1,l=o;l<i;l++){var p=a*e.width+l,h=e.map[p];if(e.map[p-e.width]==h){c=!0;var u=n.nodeAt(h),f=e.findCell(h),d=f.top,m=f.left;t.setNodeMarkup(t.mapping.slice(s).map(h+r),null,C(u.attrs,"rowspan",a-d)),t.insert(t.mapping.slice(s).map(e.positionAt(a,m,n)),u.type.createAndFill(C(u.attrs,"rowspan",d+u.attrs.rowspan-a))),l+=u.attrs.colspan-1}}return c}function I(t,e,n,r,o,i,a,s){if(0==a||a==e.width)return!1;for(var c=!1,l=o;l<i;l++){var p=l*e.width+a,h=e.map[p];if(e.map[p-1]==h){c=!0;var u=n.nodeAt(h),f=e.colCount(h),d=t.mapping.slice(s).map(h+r);t.setNodeMarkup(d,null,M(u.attrs,a-f,u.attrs.colspan-(a-f))),t.insert(d+u.nodeSize,u.type.createAndFill(M(u.attrs,0,a-f))),l+=u.attrs.rowspan-1}}return c}function _(t,e,n,r,o){var i=n?t.doc.nodeAt(n-1):t.doc,a=d.get(i),c=r.top,l=r.left,p=l+o.width,h=c+o.height,u=t.tr,f=0;function m(){i=n?u.doc.nodeAt(n-1):u.doc,a=d.get(i),f=u.mapping.maps.length}(function(t,e,n,r,o,i,a){var c,l,p=R(t.doc.type.schema);if(o>e.width)for(var h=0,u=0;h<e.height;h++){var f=n.child(h);u+=f.nodeSize;var d=[],m=void 0;m=null==f.lastChild||f.lastChild.type==p.cell?c||(c=p.cell.createAndFill()):l||(l=p.header_cell.createAndFill());for(var v=e.width;v<o;v++)d.push(m);t.insert(t.mapping.slice(a).map(u-1+r),d)}if(i>e.height){for(var g=[],y=0,w=(e.height-1)*e.width;y<Math.max(e.width,o);y++){var b=!(y>=e.width)&&n.nodeAt(e.map[w+y]).type==p.header_cell;g.push(b?l||(l=p.header_cell.createAndFill()):c||(c=p.cell.createAndFill()))}for(var k=p.row.create(null,s.Fragment.from(g)),S=[],x=e.height;x<i;x++)S.push(k);t.insert(t.mapping.slice(a).map(r+n.nodeSize-2),S)}return!(!c&&!l)})(u,a,i,n,p,h,f)&&m(),z(u,a,i,n,l,p,c,f)&&m(),z(u,a,i,n,l,p,h,f)&&m(),I(u,a,i,n,c,h,l,f)&&m(),I(u,a,i,n,c,h,p,f)&&m();for(var v=c;v<h;v++){var g=a.positionAt(v,l,i),y=a.positionAt(v,p,i);u.replace(u.mapping.slice(f).map(g+n),u.mapping.slice(f).map(y+n),new s.Slice(o.rows[v-c],0,0))}m(),u.setSelection(new T(u.doc.resolve(n+a.positionAt(c,l,i)),u.doc.resolve(n+a.positionAt(h-1,p-1,i)))),e(u)}D.prototype.map=function(t){return new D(t.map(this.anchor),t.map(this.head))},D.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==n.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&n.index()<n.parent.childCount&&S(e,n)?new T(e,n):i.Selection.near(n,1)};var j=l.keydownHandler({ArrowLeft:L("horiz",-1),ArrowRight:L("horiz",1),ArrowUp:L("vert",-1),ArrowDown:L("vert",1),"Shift-ArrowLeft":V("horiz",-1),"Shift-ArrowRight":V("horiz",1),"Shift-ArrowUp":V("vert",-1),"Shift-ArrowDown":V("vert",1),Backspace:J,"Mod-Backspace":J,Delete:J,"Mod-Delete":J});function B(t,e,n){return!n.eq(t.selection)&&(e&&e(t.tr.setSelection(n)),!0)}function L(t,e){return function(n,r,o){var a=n.selection;if(a instanceof T)return B(n,r,i.Selection.near(a.$headCell,e));if("horiz"!=t&&!a.empty)return!1;var s=K(o,t,e);if(null==s)return!1;if("horiz"==t)return B(n,r,i.Selection.near(n.doc.resolve(a.head+e),e));var c=n.doc.resolve(s),l=x(c,t,e);return B(n,r,l?i.Selection.near(l,1):e<0?i.Selection.near(n.doc.resolve(c.before(-1)),-1):i.Selection.near(n.doc.resolve(c.after(-1)),1))}}function V(t,e){return function(n,r,o){var i=n.selection;if(!(i instanceof T)){var a=K(o,t,e);if(null==a)return!1;i=new T(n.doc.resolve(a))}var s=x(i.$headCell,t,e);return!!s&&B(n,r,new T(i.$anchorCell,s))}}function J(t,e){var n=t.selection;if(!(n instanceof T))return!1;if(e){var r=t.tr,o=R(t.schema).cell.createAndFill().content;n.forEachCell(function(t,e){t.content.eq(o)||r.replace(r.mapping.map(e+1),r.mapping.map(e+t.nodeSize-1),new s.Slice(o,0,0))}),r.docChanged&&e(r)}return!0}function W(t,e){var n=g(t.state.doc.resolve(e));return!!n&&(t.dispatch(t.state.tr.setSelection(new T(n))),!0)}function q(t,e,n){if(!y(t.state))return!1;var r=F(n),o=t.state.selection;if(o instanceof T){r||(r={width:1,height:1,rows:[s.Fragment.from($(R(t.state.schema).cell,n))]});var i=o.$anchorCell.node(-1),a=o.$anchorCell.start(-1),c=d.get(i).rectBetween(o.$anchorCell.pos-a,o.$headCell.pos-a);return r=P(r,c.right-c.left,c.bottom-c.top),_(t.state,t.dispatch,a,c,r),!0}if(r){var l=w(t.state),p=l.start(-1);return _(t.state,t.dispatch,p,d.get(l.node(-1)).findCell(l.pos-p),r),!0}return!1}function H(t,e){if(!e.ctrlKey&&!e.metaKey){var n,r=U(t,e.target);if(e.shiftKey&&t.state.selection instanceof T)o(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&r&&null!=(n=g(t.state.selection.$anchor))&&Q(t,e).pos!=n.pos)o(n,e),e.preventDefault();else if(!r)return;t.root.addEventListener("mouseup",i),t.root.addEventListener("dragstart",i),t.root.addEventListener("mousemove",a)}function o(e,n){var r=Q(t,n),o=null==v.getState(t.state);if(!r||!S(e,r)){if(!o)return;r=e}var i=new T(e,r);if(o||!t.state.selection.eq(i)){var a=t.state.tr.setSelection(i);o&&a.setMeta(v,e.pos),t.dispatch(a)}}function i(){t.root.removeEventListener("mouseup",i),t.root.removeEventListener("dragstart",i),t.root.removeEventListener("mousemove",a),null!=v.getState(t.state)&&t.dispatch(t.state.tr.setMeta(v,-1))}function a(n){var a,s=v.getState(t.state);if(null!=s)a=t.state.doc.resolve(s);else if(U(t,n.target)!=r&&!(a=Q(t,e)))return i();a&&o(a,n)}}function K(t,e,n){if(!(t.state.selection instanceof i.TextSelection))return null;for(var r=t.state.selection.$head,o=r.depth-1;o>=0;o--){var a=r.node(o);if((n<0?r.index(o):r.indexAfter(o))!=(n<0?0:a.childCount))return null;if("cell"==a.type.spec.tableRole||"header_cell"==a.type.spec.tableRole){var s=r.before(o),c="vert"==e?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(c)?s:null}}return null}function U(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e}function Q(t,e){var n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?g(t.state.doc.resolve(n.pos)):null}function X(t,e){var n,r=function(e,r){"table"==e.type.spec.tableRole&&(n=function(t,e,n,r){var o=d.get(e);if(!o.problems)return r;r||(r=t.tr);for(var i,a,s=[],c=0;c<o.height;c++)s.push(0);for(var l=0;l<o.problems.length;l++){var p=o.problems[l];if("collision"==p.type){for(var h=e.nodeAt(p.pos),u=0;u<h.attrs.rowspan;u++)s[p.row+u]+=p.n;r.setNodeMarkup(r.mapping.map(n+1+p.pos),null,M(h.attrs,h.attrs.colspan-p.n,p.n))}else if("missing"==p.type)s[p.row]+=p.n;else if("overlong_rowspan"==p.type){var f=e.nodeAt(p.pos);r.setNodeMarkup(r.mapping.map(n+1+p.pos),null,C(f.attrs,"rowspan",f.attrs.rowspan-p.n))}else if("colwidth mismatch"==p.type){var m=e.nodeAt(p.pos);r.setNodeMarkup(r.mapping.map(n+1+p.pos),null,C(m.attrs,"colwidth",p.colwidth))}}for(var v=0;v<s.length;v++)s[v]&&(null==i&&(i=v),a=v);for(var g=0,y=n+1;g<o.height;g++){var w=y+e.child(g).nodeSize,b=s[g];if(b>0){for(var k=[],S=0;S<b;S++)k.push(R(t.schema).cell.createAndFill());var x=0!=g&&i!=g-1||a!=g?w-1:y+1;r.insert(r.mapping.map(x),k)}y=w}return r}(t,e,r,n))};return e?e.doc!=t.doc&&function t(e,n,r,o){var i=e.childCount,a=n.childCount;t:for(var s=0,c=0;s<a;s++){for(var l=n.child(s),p=c,h=Math.min(i,s+3);p<h;p++)if(e.child(p)==l){c=p+1,r+=l.nodeSize;continue t}o(l,r),c<i&&e.child(c).sameMarkup(l)?t(e.child(c),l,r+1,o):l.nodesBetween(0,l.content.size,o,r+1),r+=l.nodeSize}}(e.doc,t.doc,0,r):t.doc.descendants(r),n}function G(t){var e,n=t.selection,r=w(t),o=r.node(-1),i=r.start(-1),a=d.get(o);return(e=n instanceof T?a.rectBetween(n.$anchorCell.pos-i,n.$headCell.pos-i):a.findCell(r.pos-i)).tableStart=i,e.map=a,e.table=o,e}function Y(t,e,n){var r=e.map,o=e.tableStart,i=e.table,a=n>0?-1:0;(function(t,e,n){for(var r=R(e.type.schema).header_cell,o=0;o<t.height;o++)if(e.nodeAt(t.map[n+o*t.width]).type!=r)return!1;return!0})(r,i,n+a)&&(a=0==n||n==r.width?null:0);for(var s=0;s<r.height;s++){var c=s*r.width+n;if(n>0&&n<r.width&&r.map[c-1]==r.map[c]){var l=r.map[c],p=i.nodeAt(l);t.setNodeMarkup(t.mapping.map(o+l),null,O(p.attrs,n-r.colCount(l))),s+=p.attrs.rowspan-1}else{var h=null==a?R(i.type.schema).cell:i.nodeAt(r.map[c+a]).type,u=r.positionAt(s,n,i);t.insert(t.mapping.map(o+u),h.createAndFill())}}return t}function Z(t,e,n){for(var r=e.map,o=e.table,i=e.tableStart,a=t.mapping.maps.length,s=0;s<r.height;){var c=s*r.width+n,l=r.map[c],p=o.nodeAt(l);if(n>0&&r.map[c-1]==l||n<r.width-1&&r.map[c+1]==l)t.setNodeMarkup(t.mapping.slice(a).map(i+l),null,M(p.attrs,n-r.colCount(l)));else{var h=t.mapping.slice(a).map(i+l);t.delete(h,h+p.nodeSize)}s+=p.attrs.rowspan}}function tt(t,e,n){for(var r=e.map,o=e.tableStart,i=e.table,a=o,s=0;s<n;s++)a+=i.child(s).nodeSize;var c=[],l=n>0?-1:0;(function(t,e,n){for(var r=R(e.type.schema).header_cell,o=0;o<t.width;o++)if(e.nodeAt(t.map[o+n*t.width]).type!=r)return!1;return!0})(r,i,n+l)&&(l=0==n||n==r.height?null:0);for(var p=0,h=r.width*n;p<r.width;p++,h++)if(n>0&&n<r.height&&r.map[h]==r.map[h-r.width]){var u=r.map[h],f=i.nodeAt(u).attrs;t.setNodeMarkup(o+u,null,C(f,"rowspan",f.rowspan+1)),p+=f.colspan-1}else{var d=null==l?R(i.type.schema).cell:i.nodeAt(r.map[h+l*r.width]).type;c.push(d.createAndFill())}return t.insert(a,R(i.type.schema).row.create(null,c)),t}function et(t,e,n){for(var r=e.map,o=e.table,i=e.tableStart,a=0,s=0;s<n;s++)a+=o.child(s).nodeSize;var c=a+o.child(n).nodeSize,l=t.mapping.maps.length;t.delete(a+i,c+i);for(var p=0,h=n*r.width;p<r.width;p++,h++){var u=r.map[h];if(n>0&&u==r.map[h-r.width]){var f=o.nodeAt(u).attrs;t.setNodeMarkup(t.mapping.slice(l).map(u+i),null,C(f,"rowspan",f.rowspan-1)),p+=f.colspan-1}else if(n<r.width&&u==r.map[h+r.width]){var d=o.nodeAt(u),m=d.type.create(C(d.attrs,"rowspan",d.attrs.rowspan-1),d.content),v=r.positionAt(n+1,p,o);t.insert(t.mapping.slice(l).map(i+v),m),p+=d.attrs.colspan-1}}}function nt(t){var e=t.content;return 1==e.childCount&&e.firstChild.isTextblock&&0==e.firstChild.childCount}function rt(t){return function(e,n){if(!y(e))return!1;if(n){for(var r=R(e.schema),o=G(e),i=e.tr,a=o.map.cellsInRect("column"==t?new f(o.left,0,o.right,o.map.height):"row"==t?new f(0,o.top,o.map.width,o.bottom):o),s=a.map(function(t){return o.table.nodeAt(t)}),c=0;c<a.length;c++)s[c].type==r.header_cell&&i.setNodeMarkup(o.tableStart+a[c],r.cell,s[c].attrs);if(0==i.steps.length)for(var l=0;l<a.length;l++)i.setNodeMarkup(o.tableStart+a[l],r.header_cell,s[l].attrs);n(i)}return!0}}var ot=rt("row"),it=rt("column"),at=rt("cell");var st=function(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ct(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))};function ct(t,e,n,r,o,i){for(var a=0,s=!0,c=e.firstChild,l=t.firstChild,p=0,h=0;p<l.childCount;p++)for(var u=l.child(p).attrs,f=u.colspan,d=u.colwidth,m=0;m<f;m++,h++){var v=o==h?i:d&&d[m],g=v?v+"px":"";a+=v||r,v||(s=!1),c?(c.style.width!=g&&(c.style.width=g),c=c.nextSibling):e.appendChild(document.createElement("col")).style.width=g}for(;c;){var y=c.nextSibling;c.parentNode.removeChild(c),c=y}s?(n.style.width=a+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=a+"px")}st.prototype.update=function(t){return t.type==this.node.type&&(this.node=t,ct(t,this.colgroup,this.table,this.cellMinWidth),!0)},st.prototype.ignoreMutation=function(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))};var lt=new i.PluginKey("tableColumnResizing");var pt=function(t,e){this.activeHandle=t,this.dragging=e};function ht(t,e,n){var r=t.posAtCoords({left:e.clientX,top:e.clientY}).pos,o=g(t.state.doc.resolve(r));if(!o)return-1;if("right"==n)return o.pos;var i=d.get(o.node(-1)),a=o.start(-1),s=i.map.indexOf(o.pos-a);return s%i.width==0?-1:a+i.map[s-1]}function ut(t,e,n){var r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function ft(t,e){t.dispatch(t.state.tr.setMeta(lt,{setHandle:e}))}function dt(t){for(var e=[],n=0;n<t;n++)e.push(0);return e}pt.prototype.apply=function(t){var e=this,n=t.getMeta(lt);if(n&&null!=n.setHandle)return new pt(n.setHandle,null);if(n&&void 0!==n.setDragging)return new pt(e.activeHandle,n.setDragging);if(e.activeHandle>-1&&t.docChanged){var r=t.mapping.map(e.activeHandle,-1);b(t.doc.resolve(r))||(r=null),e=new pt(r,e.dragging)}return e},e.tableEditing=function(){return new i.Plugin({key:v,state:{init:function(){return null},apply:function(t,e){var n=t.getMeta(v);if(null!=n)return-1==n?null:n;if(null==e||!t.docChanged)return e;var r=t.mapping.mapResult(e),o=r.deleted,i=r.pos;return o?null:i}},props:{decorations:N,handleDOMEvents:{mousedown:H},createSelectionBetween:function(t){if(null!=v.getState(t.state))return t.state.selection},handleTripleClick:W,handleKeyDown:j,handlePaste:q},appendTransaction:function(t,e,n){return function(t,e){var n,r,o=(e||t).selection,a=(e||t).doc;if(o instanceof i.NodeSelection&&(r=o.node.type.spec.tableRole))if("cell"==r||"header_cell"==r)n=T.create(a,o.from);else if("row"==r){var s=a.resolve(o.from+1);n=T.rowSelection(s,s)}else{var c=d.get(o.node),l=o.from+1,p=l+c.map[c.width*c.height-1];n=T.create(a,l+1,p)}else o instanceof i.TextSelection&&function(t){var e=t.$from,n=t.$to;if(e.pos==n.pos||e.pos<e.pos-6)return!1;for(var r=e.pos,o=n.pos,i=e.depth;i>=0&&!(e.after(i+1)<e.end(i));i--,r++);for(var a=n.depth;a>=0&&!(n.before(a+1)>n.start(a));a--,o--);return r==o&&/row|table/.test(e.node(i).type.spec.tableRole)}(o)&&(n=i.TextSelection.create(a,o.from));return n&&(e||(e=t.tr)).setSelection(n),e}(n,X(n,e))}})},e.fixTables=X,e.handlePaste=q,e.cellAround=g,e.isInTable=y,e.selectionCell=w,e.moveCellForward=k,e.inSameTable=S,e.findCell=function(t){return d.get(t.node(-1)).findCell(t.pos-t.start(-1))},e.colCount=function(t){return d.get(t.node(-1)).colCount(t.pos-t.start(-1))},e.nextCell=x,e.tableNodes=function(t){var e=t.cellAttributes||{},n={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(var r in e)n[r]={default:e[r].default};return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:t.tableGroup,parseDOM:[{tag:"table"}],toDOM:function(){return["table",["tbody",0]]}},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:function(){return["tr",0]}},table_cell:{content:t.cellContent,attrs:n,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:function(t){return A(t,e)}}],toDOM:function(t){return["td",E(t,e),0]}},table_header:{content:t.cellContent,attrs:n,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:function(t){return A(t,e)}}],toDOM:function(t){return["th",E(t,e),0]}}}},e.CellSelection=T,e.TableMap=d,e.columnResizing=function(t){void 0===t&&(t={});var e=t.handleWidth;void 0===e&&(e=5);var n=t.cellMinWidth;void 0===n&&(n=25);var r=t.View;return void 0===r&&(r=st),new i.Plugin({key:lt,state:{init:function(t,e){return this.spec.props.nodeViews[R(e.schema).table.name]=function(t,e){return new r(t,n,e)},new pt(-1,!1)},apply:function(t,e){return e.apply(t)}},props:{attributes:function(t){return lt.getState(t).activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove:function(t,n){!function(t,e,n,r){var o=lt.getState(t.state);if(!o.dragging){var i=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target),a=-1;if(i){var s=i.getBoundingClientRect(),c=s.left,l=s.right;e.clientX-c<=n?a=ht(t,e,"left"):l-e.clientX<=n&&(a=ht(t,e,"right"))}a!=o.activeHandle&&ft(t,a)}}(t,n,e)},mouseleave:function(t){!function(t){var e=lt.getState(t.state);e.activeHandle>-1&&!e.dragging&&ft(t,-1)}(t)},mousedown:function(t,e){!function(t,e,n){var r=lt.getState(t.state);if(-1==r.activeHandle||r.dragging)return!1;var o=t.state.doc.nodeAt(r.activeHandle),i=function(t,e,n){var r=n.colspan,o=n.colwidth,i=o&&o[o.length-1];if(i)return i;var a=t.domAtPos(e+1).node.offsetWidth,s=r;if(o)for(var c=0;c<r;c++)o[c]&&(a-=o[c],s--);return a/s}(t,r.activeHandle,o.attrs);function a(e){window.removeEventListener("mouseup",a),window.removeEventListener("mousemove",s);var r=lt.getState(t.state);r.dragging&&(function(t,e,n){for(var r=t.state.doc.resolve(e),o=r.node(-1),i=d.get(o),a=r.start(-1),s=i.colCount(r.pos-a)+r.nodeAfter.attrs.colspan-1,c=t.state.tr,l=0;l<i.height;l++){var p=l*i.width+s;if(!l||i.map[p]!=i.map[p-i.width]){var h=i.map[p],u=o.nodeAt(h),f=u.attrs,m=1==f.colspan?0:s-i.colCount(h);if(!f.colwidth||f.colwidth[m]!=n){var v=f.colwidth?f.colwidth.slice():dt(f.colspan);v[m]=n,c.setNodeMarkup(a+h,null,C(f,"colwidth",v))}}}c.docChanged&&t.dispatch(c)}(t,r.activeHandle,ut(r.dragging,e,n)),t.dispatch(t.state.tr.setMeta(lt,{setDragging:null})))}function s(e){if(!e.which)return a(e);var r=lt.getState(t.state),o=ut(r.dragging,e,n);!function(t,e,n,r){for(var o=t.state.doc.resolve(e),i=o.node(-1),a=o.start(-1),s=d.get(i).colCount(o.pos-a)+o.nodeAfter.attrs.colspan-1,c=t.domAtPos(o.start(-1)).node;"TABLE"!=c.nodeName;)c=c.parentNode;ct(i,c.firstChild,c,r,s,n)}(t,r.activeHandle,o,n)}t.dispatch(t.state.tr.setMeta(lt,{setDragging:{startX:e.clientX,startWidth:i}})),window.addEventListener("mouseup",a),window.addEventListener("mousemove",s),e.preventDefault()}(t,e,n)}},decorations:function(t){var e=lt.getState(t);if(e.activeHandle>-1)return function(t,e){for(var n=[],r=t.doc.resolve(e),o=r.node(-1),i=d.get(o),s=r.start(-1),c=i.colCount(r.pos-s)+r.nodeAfter.attrs.colspan,l=0;l<i.height;l++){var p=c+l*i.width-1;if(!(c!=i.width&&i.map[p]==i.map[p+1]||0!=l&&i.map[p-1]==i.map[p-1-i.width])){var h=i.map[p],u=s+h+o.nodeAt(h).nodeSize-1,f=document.createElement("div");f.className="column-resize-handle",n.push(a.Decoration.widget(u,f))}}return a.DecorationSet.create(t.doc,n)}(t,e.activeHandle)},nodeViews:{}}})},e.columnResizingPluginKey=lt,e.updateColumnsOnResize=ct,e.__pastedCells=F,e.__insertCells=_,e.__clipCells=P,e.addColumn=Y,e.addColumnBefore=function(t,e){if(!y(t))return!1;if(e){var n=G(t);e(Y(t.tr,n,n.left))}return!0},e.addColumnAfter=function(t,e){if(!y(t))return!1;if(e){var n=G(t);e(Y(t.tr,n,n.right))}return!0},e.removeColumn=Z,e.deleteColumn=function(t,e){if(!y(t))return!1;if(e){var n=G(t),r=t.tr;if(0==n.left&&n.right==n.map.width)return!1;for(var o=n.right-1;Z(r,n,o),o!=n.left;o--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=d.get(n.table);e(r)}return!0},e.addRow=tt,e.addRowBefore=function(t,e){if(!y(t))return!1;if(e){var n=G(t);e(tt(t.tr,n,n.top))}return!0},e.addRowAfter=function(t,e){if(!y(t))return!1;if(e){var n=G(t);e(tt(t.tr,n,n.bottom))}return!0},e.removeRow=et,e.deleteRow=function(t,e){if(!y(t))return!1;if(e){var n=G(t),r=t.tr;if(0==n.top&&n.bottom==n.map.height)return!1;for(var o=n.bottom-1;et(r,n,o),o!=n.top;o--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=d.get(n.table);e(r)}return!0},e.mergeCells=function(t,e){var n=t.selection;if(!(n instanceof T)||n.$anchorCell.pos==n.$headCell.pos)return!1;var r=G(t),o=r.map;if(function(t,e){for(var n=t.width,r=t.height,o=t.map,i=e.top*n+e.left,a=i,s=(e.bottom-1)*n+e.left,c=i+(e.right-e.left-1),l=e.top;l<e.bottom;l++){if(e.left>0&&o[a]==o[a-1]||e.right<n&&o[c]==o[c+1])return!0;a+=n,c+=n}for(var p=e.left;p<e.right;p++){if(e.top>0&&o[i]==o[i-n]||e.bottom<r&&o[s]==o[s+n])return!0;i++,s++}return!1}(o,r))return!1;if(e){for(var i,a,c=t.tr,l=[],p=s.Fragment.empty,h=r.top;h<r.bottom;h++)for(var u=r.left;u<r.right;u++){var f=o.map[h*o.width+u],d=r.table.nodeAt(f);if(!(l.indexOf(f)>-1))if(l.push(f),null==i)i=f,a=d;else{nt(d)||(p=p.append(d.content));var m=c.mapping.map(f+r.tableStart);c.delete(m,m+d.nodeSize)}}if(c.setNodeMarkup(i+r.tableStart,null,C(O(a.attrs,a.attrs.colspan,r.right-r.left-a.attrs.colspan),"rowspan",r.bottom-r.top)),p.size){var v=i+1+a.content.size,g=nt(a)?i+1:v;c.replaceWith(g+r.tableStart,v+r.tableStart,p)}c.setSelection(new T(c.doc.resolve(i+r.tableStart))),e(c)}return!0},e.splitCell=function(t,e){var n=t.selection;if(!(n instanceof T)||n.$anchorCell.pos!=n.$headCell.pos)return!1;var r=n.$anchorCell.nodeAfter;if(1==r.attrs.colspan&&1==r.attrs.rowspan)return!1;if(e){var o=r.attrs,i=[],a=o.colwidth;o.rowspan>1&&(o=C(o,"rowspan",1)),o.colspan>1&&(o=C(o,"colspan",1));for(var s=G(t),c=t.tr,l=0;l<s.right-s.left;l++)i.push(a?C(o,"colwidth",a&&a[l]?[a[l]]:null):o);for(var p,h=R(t.schema).cell,u=0;u<s.bottom;u++)if(u>=s.top){var f=s.map.positionAt(u,s.left,s.table);u==s.top&&(f+=r.nodeSize);for(var d=s.left,m=0;d<s.right;d++,m++)d==s.left&&u==s.top||c.insert(p=c.mapping.map(f+s.tableStart,1),h.createAndFill(i[m]))}c.setNodeMarkup(n.$anchorCell.pos,null,i[0]),c.setSelection(new T(c.doc.resolve(n.$anchorCell.pos),p&&c.doc.resolve(p))),e(c)}return!0},e.setCellAttr=function(t,e){return function(n,r){if(!y(n))return!1;var o=w(n);if(o.nodeAfter.attrs[t]===e)return!1;if(r){var i=n.tr;n.selection instanceof T?n.selection.forEachCell(function(n,r){n.attrs[t]!==e&&i.setNodeMarkup(r,null,C(n.attrs,t,e))}):i.setNodeMarkup(o.pos,null,C(o.nodeAfter.attrs,t,e)),r(i)}return!0}},e.toggleHeaderRow=ot,e.toggleHeaderColumn=it,e.toggleHeaderCell=at,e.goToNextCell=function(t){return function(e,n){if(!y(e))return!1;var r=function(t,e){if(e<0){var n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(var r=t.index(-1)-1,o=t.before();r>=0;r--){var i=t.node(-1).child(r);if(i.childCount)return o-1-i.lastChild.nodeSize;o-=i.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;for(var a=t.node(-1),s=t.indexAfter(-1),c=t.after();s<a.childCount;s++){var l=a.child(s);if(l.childCount)return c+1;c+=l.nodeSize}}}(w(e),t);if(null!=r){if(n){var o=e.doc.resolve(r);n(e.tr.setSelection(i.TextSelection.between(o,k(o))).scrollIntoView())}return!0}}},e.deleteTable=function(t,e){for(var n=t.selection.$anchor,r=n.depth;r>0;r--)if("table"==n.node(r).type.spec.tableRole)return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}},function(t,e){for(var n={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},r={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:";",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},o="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),i="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),a="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),s="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),c=o&&(s||+o[1]<57)||a&&s,l=0;l<10;l++)n[48+l]=n[96+l]=String(l);for(l=1;l<=24;l++)n[l+111]="F"+l;for(l=65;l<=90;l++)n[l]=String.fromCharCode(l+32),r[l]=String.fromCharCode(l);for(var p in n)r.hasOwnProperty(p)||(r[p]=n[p]);function h(t){var e=!(c&&(t.ctrlKey||t.altKey||t.metaKey)||i&&t.shiftKey&&t.key&&1==t.key.length)&&t.key||(t.shiftKey?r:n)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}t.exports=h,h.base=n,h.shift=r},function(t,e){function n(t){this.content=t}n.prototype={constructor:n,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,r){var o=r&&r!=t?this.remove(r):this,i=o.find(t),a=o.content.slice();return-1==i?a.push(r||t,e):(a[i+1]=e,r&&(a[i]=r)),new n(a)},remove:function(t){var e=this.find(t);if(-1==e)return this;var r=this.content.slice();return r.splice(e,2),new n(r)},addToStart:function(t,e){return new n([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var r=this.remove(t).content.slice();return r.push(t,e),new n(r)},addBefore:function(t,e,r){var o=this.remove(e),i=o.content.slice(),a=o.find(t);return i.splice(-1==a?i.length:a,0,e,r),new n(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return(t=n.from(t)).size?new n(t.content.concat(this.subtract(t).content)):this},append:function(t){return(t=n.from(t)).size?new n(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=n.from(t);for(var r=0;r<t.content.length;r+=2)e=e.remove(t.content[r]);return e},get size(){return this.content.length>>1}},n.from=function(t){if(t instanceof n)return t;var e=[];if(t)for(var r in t)e.push(r,t[r]);return new n(e)},t.exports=n},function(t,e,n){"use strict";n.r(e);var r=n(5),o=n(4),i=n(1).EditorState,a=n(10).EditorView,s=n(0).Node,c=n(9).schema,l=n(16).LinkView,p=n(15).MediaView,h=[n(14).menu,Object(o.keymap)(r.baseKeymap)],u=document.getElementById("prosemirror_json"),f=new a(document.querySelector("#prosemirror__editor"),{state:i.create({doc:s.fromJSON(c,JSON.parse(u.value)),schema:c,plugins:h}),dispatchTransaction:function(t){console.log("run"),f.updateState(f.state.apply(t));u.value=JSON.stringify(f.state.doc.toJSON(),null,4)},nodeViews:{link:function(t,e,n){return new l(t,e,n)},image:function(t,e,n){return new p(t,e,n)}}});window.view=f.editor}]);